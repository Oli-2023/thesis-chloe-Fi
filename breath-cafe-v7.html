<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Breath Caf√©</title>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;600;700&family=Inter:wght@300;400;500;600;700&family=Caveat:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --coffee-dark: #2d1b13;
            --coffee-medium: #5d4037;
            --coffee-light: #8d6e63;
            --cream: #f5f0e8;
            --latte: #e8dcc7;
            --bg: #faf8f5;
            --text: #2d1b13;
            --text-light: #8d6e63;
            --border: #e8dcc7;
        }
        
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: 'Inter', sans-serif;
            background: var(--bg);
            color: var(--text);
            -webkit-font-smoothing: antialiased;
            overflow-x: hidden;
        }
        
        /* HEADER */
        .header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: 70px;
            background: rgba(250, 248, 245, 0.95);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid var(--border);
            z-index: 1000;
            display: flex;
            align-items: center;
            padding: 0 32px;
        }
        .header-left { display: flex; align-items: center; gap: 20px; }
        .hamburger {
            width: 44px; height: 44px;
            background: none; border: none; cursor: pointer;
            display: flex; flex-direction: column; justify-content: center; align-items: center; gap: 6px;
            border-radius: 12px; transition: all 0.3s;
        }
        .hamburger:hover { background: var(--cream); }
        .hamburger span { display: block; width: 24px; height: 3px; background: var(--coffee-dark); border-radius: 2px; transition: all 0.3s; }
        .hamburger.active span:nth-child(1) { transform: rotate(45deg) translate(6px, 6px); }
        .hamburger.active span:nth-child(2) { opacity: 0; }
        .hamburger.active span:nth-child(3) { transform: rotate(-45deg) translate(6px, -6px); }
        .logo { display: flex; align-items: center; gap: 12px; text-decoration: none; color: var(--text); }
        .logo-icon { font-size: 32px; }
        .logo-text { font-family: 'Caveat', cursive; font-size: 32px; font-weight: 700; }
        .header-center { flex: 1; display: flex; justify-content: center; }
        .header-nav { display: flex; gap: 8px; }
        .header-nav-item {
            padding: 10px 20px; background: none; border: none; cursor: pointer;
            font-size: 14px; font-weight: 500; color: var(--text-light);
            border-radius: 24px; transition: all 0.3s; display: flex; align-items: center; gap: 8px;
        }
        .header-nav-item:hover { background: var(--cream); color: var(--coffee-dark); }
        .header-nav-item.active { background: var(--coffee-medium); color: white; }
        .header-right { display: flex; align-items: center; gap: 16px; }
        .streak-badge { display: flex; align-items: center; gap: 8px; padding: 8px 16px; background: linear-gradient(135deg, #fff5e6, #ffe4cc); border-radius: 24px; font-weight: 600; font-size: 14px; }
        .user-avatar { width: 40px; height: 40px; background: linear-gradient(135deg, var(--coffee-medium), var(--coffee-dark)); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-size: 18px; cursor: pointer; }

        /* SIDEBAR */
        .sidebar-overlay { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(45, 27, 19, 0.3); opacity: 0; visibility: hidden; transition: all 0.3s; z-index: 1001; }
        .sidebar-overlay.active { opacity: 1; visibility: visible; }
        .sidebar { position: fixed; top: 0; left: 0; width: 280px; height: 100vh; background: white; transform: translateX(-100%); transition: transform 0.3s ease; z-index: 1002; display: flex; flex-direction: column; box-shadow: 4px 0 24px rgba(0, 0, 0, 0.1); }
        .sidebar.active { transform: translateX(0); }
        .sidebar-header { padding: 24px; border-bottom: 1px solid var(--border); display: flex; align-items: center; gap: 16px; }
        .sidebar-logo { font-family: 'Caveat', cursive; font-size: 28px; font-weight: 700; }
        .sidebar-close { margin-left: auto; width: 36px; height: 36px; background: var(--cream); border: none; border-radius: 50%; cursor: pointer; font-size: 20px; display: flex; align-items: center; justify-content: center; transition: all 0.3s; }
        .sidebar-close:hover { background: var(--coffee-light); color: white; }
        .sidebar-content { flex: 1; overflow-y: auto; padding: 16px; }
        .sidebar-section { margin-bottom: 24px; }
        .sidebar-section-title { font-size: 11px; font-weight: 700; color: var(--text-light); text-transform: uppercase; letter-spacing: 1.5px; margin-bottom: 12px; padding: 0 12px; }
        .sidebar-menu { list-style: none; }
        .sidebar-menu-item { margin-bottom: 4px; }
        .sidebar-menu-link { display: flex; align-items: center; gap: 14px; padding: 14px 16px; border-radius: 12px; cursor: pointer; transition: all 0.2s; text-decoration: none; color: var(--text); font-size: 15px; font-weight: 500; }
        .sidebar-menu-link:hover { background: var(--cream); }
        .sidebar-menu-link.active { background: linear-gradient(135deg, rgba(93, 64, 55, 0.1), rgba(141, 110, 99, 0.1)); color: var(--coffee-dark); font-weight: 600; }
        .sidebar-menu-icon { font-size: 20px; width: 28px; text-align: center; }
        .sidebar-menu-badge { margin-left: auto; padding: 2px 8px; background: var(--coffee-medium); color: white; border-radius: 10px; font-size: 11px; font-weight: 600; }
        .sidebar-footer { padding: 20px; border-top: 1px solid var(--border); }
        .sidebar-user { display: flex; align-items: center; gap: 12px; padding: 12px; background: var(--cream); border-radius: 12px; }
        .sidebar-user-avatar { width: 44px; height: 44px; background: linear-gradient(135deg, var(--coffee-medium), var(--coffee-dark)); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-size: 20px; }
        .sidebar-user-name { font-weight: 600; font-size: 14px; }
        .sidebar-user-level { font-size: 12px; color: var(--text-light); }

        .app {
            max-width: 1200px;
            min-height: 100vh;
            margin: 0 auto;
            background: var(--bg);
            position: relative;
            padding-top: 70px;
        }
        
        .page {
            display: none;
            min-height: calc(100vh - 70px);
            padding: 40px;
        }
        
        @media (max-width: 768px) {
            .header-nav { display: none; }
            .page { padding: 24px 16px 100px; }
        }

        /* ONBOARDING STYLES */
        .onboarding-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: var(--bg);
            z-index: 9999;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            transition: opacity 0.5s, visibility 0.5s;
        }
        .onboarding-overlay.hidden {
            opacity: 0;
            visibility: hidden;
            pointer-events: none;
        }
        .onboarding-slide {
            display: none;
            flex-direction: column;
            align-items: center;
            text-align: center;
            padding: 40px;
            max-width: 500px;
            animation: fadeSlide 0.5s ease;
        }
        .onboarding-slide.active {
            display: flex;
        }
        @keyframes fadeSlide {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .onboarding-icon {
            font-size: 120px;
            margin-bottom: 32px;
            animation: float 3s ease-in-out infinite;
        }
        .onboarding-title {
            font-family: 'Caveat', cursive;
            font-size: 42px;
            font-weight: 700;
            margin-bottom: 16px;
            color: var(--coffee-dark);
        }
        .onboarding-desc {
            font-size: 18px;
            color: var(--text-light);
            line-height: 1.7;
            margin-bottom: 40px;
        }
        .onboarding-dots {
            display: flex;
            gap: 12px;
            margin-bottom: 32px;
        }
        .onboarding-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: var(--border);
            transition: all 0.3s;
            cursor: pointer;
        }
        .onboarding-dot.active {
            background: var(--coffee-medium);
            transform: scale(1.3);
        }
        .onboarding-buttons {
            display: flex;
            gap: 16px;
            width: 100%;
            max-width: 400px;
        }
        .onboarding-btn {
            flex: 1;
            padding: 16px 32px;
            border-radius: 50px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }
        .onboarding-btn.secondary {
            background: transparent;
            border: 2px solid var(--border);
            color: var(--text-light);
        }
        .onboarding-btn.secondary:hover {
            border-color: var(--coffee-light);
            color: var(--coffee-dark);
        }
        .onboarding-btn.primary {
            background: linear-gradient(135deg, var(--coffee-medium), var(--coffee-dark));
            border: none;
            color: white;
            box-shadow: 0 4px 20px rgba(45, 27, 19, 0.3);
        }
        .onboarding-btn.primary:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 30px rgba(45, 27, 19, 0.4);
        }
        .onboarding-skip {
            position: absolute;
            top: 24px;
            right: 24px;
            background: none;
            border: none;
            color: var(--text-light);
            font-size: 14px;
            cursor: pointer;
            padding: 8px 16px;
            border-radius: 20px;
            transition: all 0.3s;
        }
        .onboarding-skip:hover {
            background: var(--cream);
            color: var(--coffee-dark);
        }
        .onboarding-feature {
            display: flex;
            align-items: center;
            gap: 16px;
            background: white;
            padding: 16px 24px;
            border-radius: 16px;
            margin: 8px 0;
            width: 100%;
            max-width: 400px;
            box-shadow: 0 2px 12px rgba(0,0,0,0.06);
            text-align: left;
        }
        .onboarding-feature-icon {
            font-size: 32px;
        }
        .onboarding-feature-text {
            font-size: 15px;
            color: var(--text);
        }
        
        .page.active { display: block; animation: fadeIn 0.4s ease; }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .drip-line {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 24px;
            height: 40px;
        }
        
        .drip-line::before { content: '‚òï'; font-size: 24px; }
        .drip-line::after { content: 'üíß'; font-size: 20px; animation: drip 2s ease infinite; }
        
        .drip-line .line {
            flex: 1;
            height: 2px;
            background: repeating-linear-gradient(to right, var(--coffee-light) 0, var(--coffee-light) 4px, transparent 4px, transparent 8px);
            margin: 0 12px;
            opacity: 0.3;
        }
        
        @keyframes drip {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(8px); }
        }
        
        h1, h2, h3 { font-family: 'Playfair Display', serif; }
        
        .brand-title { 
            font-family: 'Caveat', cursive;
            font-size: 64px; 
            font-weight: 700;
            transform: rotate(-2deg);
            display: inline-block;
            position: relative;
            letter-spacing: 0.02em;
            text-shadow: 3px 3px 0px rgba(141, 110, 99, 0.15);
            animation: breathe 4s ease-in-out infinite;
        }
        
        @keyframes breathe {
            0%, 100% { transform: rotate(-2deg) translateY(0); }
            50% { transform: rotate(-1deg) translateY(-4px); }
        }
        .page-title { 
            font-family: 'Caveat', cursive;
            font-size: 38px; 
            font-weight: 700; 
            margin-bottom: 8px;
            transform: rotate(-1deg);
            display: inline-block;
        }
        .page-subtitle { font-size: 15px; color: var(--text-light); }
        .handwriting { font-family: 'Caveat', cursive; font-size: 18px; line-height: 1.6; }
        
        .btn {
            width: 100%;
            padding: 16px;
            border: none;
            border-radius: 50px;
            font-weight: 600;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, var(--coffee-medium), var(--coffee-dark));
            color: white;
            box-shadow: 0 4px 16px rgba(45,27,19,0.2);
        }
        
        .btn-primary:hover { transform: translateY(-2px); box-shadow: 0 6px 24px rgba(45,27,19,0.3); }
        .btn-primary:active { transform: scale(0.98); }
        
        .card {
            background: white;
            border-radius: 16px;
            padding: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.06);
            border: 1px solid var(--border);
            margin-bottom: 16px;
        }
        
        .text-center { text-align: center; }
        
        .emotion-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin-top: 24px;
        }
        
        .emotion-card {
            background: white;
            border-radius: 16px;
            padding: 24px 16px;
            text-align: center;
            cursor: pointer;
            border: 3px solid transparent;
            transition: all 0.3s;
            box-shadow: 0 2px 8px rgba(0,0,0,0.06);
        }
        
        .emotion-card:hover {
            transform: translateY(-8px) scale(1.02);
            box-shadow: 0 8px 24px rgba(0,0,0,0.12);
        }
        
        .emotion-card.selected {
            border-color: var(--coffee-medium);
            background: linear-gradient(135deg, rgba(93,64,55,0.05), rgba(141,110,99,0.05));
        }
        
        .emotion-icon {
            font-size: 56px;
            margin-bottom: 12px;
            display: block;
        }
        
        .emotion-name {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 4px;
        }
        
        .emotion-desc {
            font-size: 12px;
            color: var(--text-light);
        }
        
        .recommendation-card {
            background: linear-gradient(135deg, rgba(245,240,232,0.8), white);
            border-radius: 16px;
            padding: 32px 24px;
            margin: 24px 0;
            text-align: center;
            border: 3px solid var(--coffee-light);
            box-shadow: 0 4px 16px rgba(0,0,0,0.08);
        }
        
        .coffee-icon-large { font-size: 80px; margin-bottom: 16px; }
        .coffee-name { font-size: 32px; font-weight: 700; margin-bottom: 8px; }
        .coffee-tagline { font-family: 'Caveat', cursive; font-size: 18px; color: var(--text-light); }
        
        .breath-pattern {
            display: flex;
            gap: 12px;
            justify-content: center;
            margin: 24px 0;
            padding: 16px;
            background: rgba(255,255,255,0.8);
            border-radius: 12px;
        }
        
        .breath-bar {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
        }
        
        .breath-visual {
            width: 36px;
            height: 60px;
            background: linear-gradient(to top, var(--coffee-medium), var(--coffee-light));
            border-radius: 6px;
        }
        
        .breath-label { font-size: 13px; font-weight: 600; }
        .breath-time { font-size: 11px; color: var(--text-light); }
        
        .why-box {
            background: rgba(245,240,232,0.6);
            border-radius: 12px;
            padding: 16px;
            margin-top: 16px;
            border-left: 4px solid var(--coffee-medium);
            text-align: left;
        }
        
        .why-title {
            font-weight: 600;
            font-size: 15px;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .step {
            margin: 8px 0;
            padding-left: 16px;
            position: relative;
            font-size: 13px;
            line-height: 1.5;
        }
        
        .step::before {
            content: '‚Ä¢';
            position: absolute;
            left: 0;
            color: var(--coffee-medium);
            font-size: 20px;
        }
        
        .step-name { font-weight: 600; }
        
        .alternatives {
            margin-top: 32px;
        }
        
        .alternatives-title {
            text-align: center;
            font-size: 14px;
            color: var(--text-light);
            margin-bottom: 16px;
        }
        
        .alternatives-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 12px;
        }
        
        .alt-card {
            background: white;
            border-radius: 12px;
            padding: 12px;
            text-align: center;
            cursor: pointer;
            border: 2px solid var(--border);
            transition: all 0.3s;
        }
        
        .alt-card:hover {
            border-color: var(--coffee-light);
            transform: translateY(-4px);
        }
        
        .alt-icon { font-size: 32px; margin-bottom: 4px; }
        .alt-name { font-size: 12px; font-weight: 600; margin-bottom: 2px; }
        .alt-pattern { font-size: 10px; color: var(--text-light); }
        
        .brewing-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
        }
        
        .back-btn {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            padding: 8px;
        }
        
        .timer {
            font-family: 'Playfair Display', serif;
            font-size: 24px;
            font-weight: 600;
        }
        
        .coffee-maker {
            position: relative;
            width: 240px;
            height: 360px;
            margin: 0 auto 32px;
        }
        
        .filter {
            position: absolute;
            top: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 80px;
            height: 50px;
            background: linear-gradient(to bottom, var(--latte), var(--cream));
            border-radius: 0 0 40px 40px;
            border: 3px solid var(--coffee-light);
        }
        
        .drops {
            position: absolute;
            top: 50px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        
        .drop {
            width: 10px;
            height: 10px;
            background: var(--coffee-medium);
            border-radius: 50%;
            opacity: 0;
            animation: fall 2s ease infinite;
        }
        
        .drop:nth-child(2) { animation-delay: 0.7s; }
        .drop:nth-child(3) { animation-delay: 1.4s; }
        
        @keyframes fall {
            0% { opacity: 0; transform: translateY(0); }
            30% { opacity: 1; }
            100% { opacity: 0; transform: translateY(120px); }
        }
        
        .server {
            position: absolute;
            bottom: 40px;
            left: 50%;
            transform: translateX(-50%);
            width: 140px;
            height: 160px;
            background: linear-gradient(to bottom, transparent 25%, var(--coffee-dark) 25%);
            border-radius: 16px;
            border: 4px solid var(--coffee-dark);
            overflow: hidden;
        }
        
        .coffee-level {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 0%;
            background: linear-gradient(to top, var(--coffee-dark), var(--coffee-medium));
            transition: height 1s ease;
        }
        
        .steam {
            position: absolute;
            top: 16px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 12px;
        }
        
        .steam-line {
            width: 3px;
            height: 24px;
            background: linear-gradient(to top, var(--coffee-light), transparent);
            border-radius: 50px;
            animation: steam 3s ease infinite;
        }
        
        .steam-line:nth-child(2) { animation-delay: 1s; }
        .steam-line:nth-child(3) { animation-delay: 2s; }
        
        @keyframes steam {
            0% { opacity: 0; transform: translateY(0); }
            50% { opacity: 0.6; }
            100% { opacity: 0; transform: translateY(-16px); }
        }
        
        .phase-box {
            background: white;
            border-radius: 16px;
            padding: 24px;
            margin-bottom: 16px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.06);
            border-left: 4px solid var(--coffee-medium);
        }
        
        .phase-title {
            font-family: 'Playfair Display', serif;
            font-size: 22px;
            font-weight: 700;
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .phase-action {
            font-size: 16px;
            color: var(--text-light);
            margin-bottom: 12px;
            font-weight: 500;
        }
        
        .phase-desc {
            font-family: 'Caveat', cursive;
            font-size: 16px;
            color: var(--text-light);
            margin-bottom: 8px;
        }
        
        .phase-timer {
            font-family: 'Playfair Display', serif;
            font-size: 18px;
            color: var(--coffee-medium);
            font-weight: 600;
        }
        
        .hold-btn {
            width: 100%;
            padding: 24px;
            background: linear-gradient(135deg, var(--coffee-medium), var(--coffee-dark));
            color: white;
            border: none;
            border-radius: 50px;
            font-size: 18px;
            font-weight: 700;
            cursor: pointer;
            box-shadow: 0 4px 16px rgba(0,0,0,0.2);
            position: relative;
            overflow: hidden;
        }
        
        .hold-btn:active { transform: scale(0.98); }
        .hold-btn.holding { background: linear-gradient(135deg, var(--coffee-dark), #1a0f0a); }
        
        .hold-progress {
            position: absolute;
            bottom: 0;
            left: 0;
            height: 4px;
            width: 0%;
            background: rgba(255, 255, 255, 0.5);
            transition: width 0.1s linear;
        }
        
        .cycle-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: var(--border);
            transition: all 0.3s;
        }
        
        .cycle-dot.active {
            background: var(--coffee-medium);
            transform: scale(1.3);
            box-shadow: 0 0 12px rgba(93, 64, 55, 0.5);
        }
        
        .cycle-dot.completed {
            background: var(--coffee-dark);
        }
        
        .emotion-compare {
            background: white;
            border-radius: 16px;
            padding: 24px;
            margin: 24px 0;
            box-shadow: 0 2px 8px rgba(0,0,0,0.06);
        }
        
        .emotion-flow {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 24px;
        }
        
        .emotion-state { text-align: center; }
        .emotion-label { font-size: 11px; color: var(--text-light); text-transform: uppercase; letter-spacing: 1px; margin-bottom: 8px; font-weight: 600; }
        .emotion-display { font-size: 40px; margin-bottom: 4px; }
        .emotion-text { font-size: 14px; font-weight: 500; }
        .emotion-arrow { font-size: 28px; color: var(--coffee-light); }
        
        .emotion-selector {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
        }
        
        .emotion-option {
            padding: 12px;
            background: var(--cream);
            border: 2px solid transparent;
            border-radius: 12px;
            cursor: pointer;
            text-align: center;
            transition: all 0.3s;
        }
        
        .emotion-option:hover {
            border-color: var(--coffee-light);
            transform: scale(1.05);
        }
        
        .emotion-option.selected {
            border-color: var(--coffee-medium);
            background: white;
        }
        
        .emotion-option-icon { font-size: 28px; margin-bottom: 4px; }
        .emotion-option-name { font-size: 12px; }
        
        .note-section { margin: 24px 0; }
        .note-label { font-weight: 600; margin-bottom: 12px; display: flex; align-items: center; gap: 8px; }
        
        .note-textarea {
            width: 100%;
            min-height: 90px;
            padding: 12px;
            border: 2px solid var(--border);
            border-radius: 12px;
            font-family: 'Inter', sans-serif;
            font-size: 14px;
            line-height: 1.5;
            resize: vertical;
        }
        
        .note-textarea:focus {
            outline: none;
            border-color: var(--coffee-medium);
        }
        
        .char-count {
            text-align: right;
            font-size: 12px;
            color: var(--text-light);
            margin-top: 4px;
        }
        
        .rating { margin: 24px 0; text-align: center; }
        .rating-label { font-weight: 600; margin-bottom: 12px; }
        
        .stars {
            display: flex;
            justify-content: center;
            gap: 8px;
        }
        
        .star {
            font-size: 32px;
            cursor: pointer;
            color: var(--border);
            transition: all 0.2s;
        }
        
        .star:hover,
        .star.active {
            color: #ffd54f;
            transform: scale(1.2) rotate(10deg);
        }
        
        .stamps-collection { margin: 24px 0; }
        
        .progress-header { text-align: center; margin-bottom: 24px; }
        .progress-text { font-family: 'Playfair Display', serif; font-size: 20px; margin-bottom: 12px; }
        
        .progress-bar {
            width: 100%;
            height: 10px;
            background: var(--cream);
            border-radius: 50px;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(to right, var(--coffee-light), var(--coffee-medium));
            border-radius: 50px;
            transition: width 0.5s;
        }
        
        .stamp-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 12px;
            margin: 24px 0;
        }
        
        .stamp {
            aspect-ratio: 1;
            background: white;
            border: 3px dashed var(--border);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 28px;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
        }
        
        .stamp:hover {
            transform: scale(1.05);
            border-color: var(--coffee-light);
        }
        
        .stamp.filled {
            border-style: solid;
            border-color: var(--coffee-medium);
            background: linear-gradient(135deg, rgba(245,240,232,0.5), white);
        }
        
        .stamp-date {
            position: absolute;
            bottom: -18px;
            font-size: 9px;
            color: var(--text-light);
        }
        
        .history-toggle {
            width: 100%;
            padding: 12px;
            background: var(--cream);
            border: none;
            border-radius: 12px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .history-list {
            display: none;
            margin-top: 12px;
        }
        
        .history-list.show { display: block; }
        
        .history-item {
            background: white;
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.06);
            border-left: 4px solid var(--coffee-light);
        }
        
        .history-date { font-size: 12px; color: var(--text-light); margin-bottom: 4px; }
        .history-coffee { font-weight: 600; font-size: 16px; margin-bottom: 8px; }
        .history-emotions { display: flex; align-items: center; gap: 8px; margin-bottom: 8px; font-size: 13px; }
        .history-note { font-size: 13px; color: var(--text-light); font-style: italic; padding-left: 12px; border-left: 2px solid var(--border); }
        
        .journal-header {
            display: flex;
            gap: 8px;
            margin-bottom: 24px;
            border-bottom: 2px solid var(--border);
        }
        
        .journal-tab {
            padding: 12px 20px;
            background: none;
            border: none;
            font-weight: 600;
            cursor: pointer;
            color: var(--text-light);
            border-bottom: 3px solid transparent;
            margin-bottom: -2px;
        }
        
        .journal-tab.active {
            color: var(--coffee-dark);
            border-bottom-color: var(--coffee-medium);
        }
        
        .timeline { margin-top: 24px; }
        
        .week-section {
            margin-bottom: 24px;
        }
        
        .week-title {
            font-weight: 600;
            font-size: 13px;
            color: var(--text-light);
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .timeline-item {
            position: relative;
            padding-left: 32px;
            margin-bottom: 16px;
        }
        
        .timeline-item::before {
            content: '‚óè';
            position: absolute;
            left: 0;
            color: var(--coffee-medium);
            font-size: 20px;
        }
        
        .timeline-item::after {
            content: '';
            position: absolute;
            left: 7px;
            top: 20px;
            width: 2px;
            height: calc(100% + 16px);
            background: repeating-linear-gradient(to bottom, var(--coffee-light) 0, var(--coffee-light) 3px, transparent 3px, transparent 6px);
            opacity: 0.3;
        }
        
        .timeline-item:last-child::after { display: none; }
        
        .insight-box {
            background: linear-gradient(135deg, rgba(255,213,79,0.1), rgba(255,183,77,0.1));
            border-radius: 12px;
            padding: 16px;
            margin-top: 24px;
            border-left: 4px solid #ffb74d;
        }
        
        .insight-title {
            font-weight: 600;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .insight-text {
            font-size: 14px;
            color: var(--text-light);
            line-height: 1.5;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin: 24px 0;
        }
        
        .stat-card {
            background: white;
            border-radius: 16px;
            padding: 20px;
            text-align: center;
            box-shadow: 0 2px 8px rgba(0,0,0,0.06);
        }
        
        .stat-number {
            font-family: 'Playfair Display', serif;
            font-size: 36px;
            font-weight: 700;
            color: var(--coffee-medium);
            margin-bottom: 4px;
        }
        
        .stat-label {
            font-size: 13px;
            color: var(--text-light);
        }
        
        .chart-container {
            background: white;
            border-radius: 16px;
            padding: 20px;
            margin: 16px 0;
            box-shadow: 0 2px 8px rgba(0,0,0,0.06);
        }
        
        .chart-title {
            font-weight: 600;
            margin-bottom: 16px;
        }
        
        .bar-chart {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        
        .bar-item {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .bar-label {
            width: 60px;
            font-size: 13px;
            font-weight: 500;
        }
        
        .bar-track {
            flex: 1;
            height: 24px;
            background: var(--cream);
            border-radius: 12px;
            overflow: hidden;
        }
        
        .bar-fill {
            height: 100%;
            background: linear-gradient(to right, var(--coffee-light), var(--coffee-medium));
            border-radius: 12px;
            display: flex;
            align-items: center;
            padding: 0 8px;
            color: white;
            font-size: 12px;
            font-weight: 600;
        }
        
        .weekly-container { margin-top: 24px; }
        
        .journey-line {
            display: flex;
            justify-content: space-between;
            align-items: flex-end;
            height: 100px;
            margin: 24px 0;
            padding: 0 8px;
        }
        
        .journey-day {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
        }
        
        .journey-icon {
            font-size: 24px;
            transition: all 0.3s;
        }
        
        .journey-label {
            font-size: 11px;
            color: var(--text-light);
            font-weight: 500;
        }
        
        .reflection-box {
            background: white;
            border-radius: 16px;
            padding: 20px;
            margin-top: 16px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.06);
        }
        
        .reflection-q {
            font-weight: 600;
            margin-bottom: 8px;
            font-size: 14px;
        }
        
        .reflection-input {
            width: 100%;
            padding: 12px;
            border: 2px solid var(--border);
            border-radius: 12px;
            font-family: 'Inter', sans-serif;
            font-size: 14px;
            margin-bottom: 16px;
        }
        
        .reflection-input:focus {
            outline: none;
            border-color: var(--coffee-medium);
        }
        
        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 8px;
            margin-top: 24px;
        }
        
        .calendar-day {
            aspect-ratio: 1;
            background: white;
            border-radius: 12px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            font-weight: 500;
            border: 2px solid transparent;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .calendar-day:hover {
            border-color: var(--coffee-light);
            transform: scale(1.05);
        }
        
        .calendar-day.has-brew {
            border-color: var(--coffee-medium);
            background: linear-gradient(135deg, rgba(245,240,232,0.5), white);
        }
        
        .calendar-icon {
            font-size: 20px;
            margin-top: 4px;
        }
        
        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }
        
        .calendar-month {
            font-family: 'Playfair Display', serif;
            font-size: 24px;
            font-weight: 600;
        }
        
        .calendar-nav {
            display: flex;
            gap: 8px;
        }
        
        .calendar-nav button {
            padding: 8px 12px;
            background: var(--cream);
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
        }
        
        .weekday-header {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 8px;
            margin-bottom: 8px;
        }
        
        .weekday {
            text-align: center;
            font-size: 12px;
            font-weight: 600;
            color: var(--text-light);
            text-transform: uppercase;
        }
        
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: white;
            border-top: 1px solid var(--border);
            box-shadow: 0 -4px 16px rgba(0,0,0,0.08);
            z-index: 1000;
            display: none;
        }
        
        @media (max-width: 768px) {
            .bottom-nav { display: block; }
        }
        
        .bottom-nav-inner {
            max-width: 430px;
            margin: 0 auto;
            display: flex;
            justify-content: space-around;
            padding: 8px 0;
        }
        
        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
            padding: 8px 12px;
            cursor: pointer;
            border-radius: 12px;
            color: var(--text-light);
            transition: all 0.3s;
        }
        
        .nav-item:hover {
            background: var(--cream);
            color: var(--coffee-dark);
        }
        
        .nav-item.active {
            color: var(--coffee-dark);
            background: var(--latte);
        }
        
        .nav-icon { font-size: 22px; }
        .nav-label { font-size: 10px; font-weight: 600; }
        
        @media (max-width: 430px) {
            .page { padding: 20px 16px 100px; }
            .page-title { font-size: 24px; }
            .emotion-icon { font-size: 48px; }
            .coffee-icon-large { font-size: 64px; }
            .coffee-name { font-size: 28px; }
        }

        /* ========== TOGGLE SWITCH ========== */
        .toggle-switch {
            width: 50px;
            height: 28px;
            background: var(--border);
            border-radius: 14px;
            cursor: pointer;
            position: relative;
            transition: all 0.3s ease;
        }
        .toggle-switch::after {
            content: '';
            position: absolute;
            width: 24px;
            height: 24px;
            background: white;
            border-radius: 50%;
            top: 2px;
            left: 2px;
            transition: all 0.3s ease;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .toggle-switch.active {
            background: var(--coffee-medium);
        }
        .toggle-switch.active::after {
            left: calc(100% - 26px);
        }

        /* ========== MODAL STYLES ========== */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(45, 27, 19, 0.5);
            backdrop-filter: blur(4px);
            z-index: 2000;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }
        .modal-overlay.active {
            opacity: 1;
            visibility: visible;
        }
        .modal-content {
            background: white;
            border-radius: 20px;
            width: 100%;
            max-width: 400px;
            max-height: 80vh;
            overflow-y: auto;
            transform: translateY(20px);
            transition: all 0.3s ease;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }
        .modal-overlay.active .modal-content {
            transform: translateY(0);
        }
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 24px;
            border-bottom: 1px solid var(--border);
            position: sticky;
            top: 0;
            background: white;
            border-radius: 20px 20px 0 0;
        }
        .modal-header h3 {
            font-family: 'Playfair Display', serif;
            font-size: 20px;
            font-weight: 600;
        }
        .modal-close {
            width: 32px;
            height: 32px;
            border: none;
            background: var(--cream);
            border-radius: 50%;
            cursor: pointer;
            font-size: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
        }
        .modal-close:hover {
            background: var(--coffee-light);
            color: white;
        }
        .modal-body {
            padding: 24px;
        }
        .modal-body h4 {
            font-size: 14px;
            font-weight: 600;
            margin: 16px 0 8px;
            color: var(--coffee-dark);
        }
        .modal-body p {
            font-size: 14px;
            line-height: 1.6;
            color: var(--text-light);
            margin-bottom: 8px;
        }

        /* ========== FORM STYLES ========== */
        .form-group {
            margin-bottom: 16px;
        }
        .form-group label {
            display: block;
            font-weight: 600;
            font-size: 14px;
            margin-bottom: 8px;
            color: var(--text);
        }
        .form-input {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid var(--border);
            border-radius: 12px;
            font-size: 14px;
            font-family: 'Inter', sans-serif;
            transition: all 0.3s;
        }
        .form-input:focus {
            outline: none;
            border-color: var(--coffee-medium);
        }

        /* ========== CONNECTED ACCOUNTS ========== */
        .connected-account {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px 0;
            border-bottom: 1px solid var(--border);
        }
        .connected-account:last-child {
            border-bottom: none;
        }
        .account-info {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        .btn-connect {
            padding: 8px 16px;
            background: var(--cream);
            border: none;
            border-radius: 20px;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }
        .btn-connect:hover {
            background: var(--coffee-medium);
            color: white;
        }

        /* ========== LANGUAGE SELECTOR ========== */
        .language-option {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 16px;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s;
            margin-bottom: 8px;
        }
        .language-option:hover {
            background: var(--cream);
        }
        .language-option.selected {
            background: linear-gradient(135deg, rgba(93,64,55,0.1), rgba(141,110,99,0.1));
            border: 2px solid var(--coffee-medium);
        }
        .language-option .check-mark {
            margin-left: auto;
            color: var(--coffee-medium);
            font-weight: bold;
            opacity: 0;
        }
        .language-option.selected .check-mark {
            opacity: 1;
        }

        /* ========== TIME PICKER ========== */
        .time-picker {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            padding: 20px 0;
        }
        .time-select {
            padding: 12px 16px;
            font-size: 20px;
            font-weight: 600;
            border: 2px solid var(--border);
            border-radius: 12px;
            background: white;
            cursor: pointer;
            font-family: 'Playfair Display', serif;
        }
        .time-select:focus {
            outline: none;
            border-color: var(--coffee-medium);
        }

        /* ========== TOAST NOTIFICATION ========== */
        .toast {
            position: fixed;
            bottom: 100px;
            left: 50%;
            transform: translateX(-50%) translateY(100px);
            background: var(--coffee-dark);
            color: white;
            padding: 12px 24px;
            border-radius: 50px;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
            font-weight: 500;
            z-index: 3000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
            box-shadow: 0 4px 20px rgba(0,0,0,0.3);
        }
        .toast.show {
            opacity: 1;
            visibility: visible;
            transform: translateX(-50%) translateY(0);
        }
        .toast-icon {
            width: 20px;
            height: 20px;
            background: #4CAF50;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
        }

        /* ========== SPLASH SCREEN ========== */
        .splash-screen {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, var(--coffee-dark) 0%, #1a0f0a 100%);
            z-index: 10000;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: opacity 0.5s ease, visibility 0.5s ease;
        }
        .splash-screen.hidden {
            opacity: 0;
            visibility: hidden;
        }
        .splash-content {
            text-align: center;
            color: white;
        }
        .splash-logo-container {
            position: relative;
            display: inline-block;
            margin-bottom: 24px;
        }
        .splash-cup {
            font-size: 80px;
            animation: splashFloat 2s ease-in-out infinite;
        }
        .splash-steam {
            position: absolute;
            top: -20px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 8px;
        }
        .splash-steam span {
            width: 4px;
            height: 20px;
            background: rgba(255,255,255,0.6);
            border-radius: 4px;
            animation: steamRise 1.5s ease-in-out infinite;
        }
        .splash-steam span:nth-child(2) { animation-delay: 0.3s; height: 28px; }
        .splash-steam span:nth-child(3) { animation-delay: 0.6s; }
        @keyframes steamRise {
            0%, 100% { opacity: 0; transform: translateY(0); }
            50% { opacity: 0.8; transform: translateY(-15px); }
        }
        @keyframes splashFloat {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }
        .splash-title {
            font-family: 'Caveat', cursive;
            font-size: 48px;
            font-weight: 700;
            margin-bottom: 8px;
        }
        .splash-tagline {
            font-size: 16px;
            opacity: 0.8;
            margin-bottom: 32px;
        }
        .splash-loader {
            width: 200px;
            height: 4px;
            background: rgba(255,255,255,0.2);
            border-radius: 4px;
            overflow: hidden;
            margin: 0 auto;
        }
        .splash-loader-fill {
            height: 100%;
            width: 0%;
            background: linear-gradient(90deg, var(--coffee-light), #fff);
            border-radius: 4px;
            animation: loadingBar 2s ease-in-out forwards;
        }
        @keyframes loadingBar {
            0% { width: 0%; }
            100% { width: 100%; }
        }

        /* ========== ENHANCED ONBOARDING ========== */
        .onboarding-hero {
            margin-bottom: 24px;
        }
        .hero-cup-container {
            position: relative;
            display: inline-block;
        }
        .hero-cup {
            font-size: 120px;
            animation: heroBounce 3s ease-in-out infinite;
        }
        .hero-steam {
            position: absolute;
            top: -10px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 12px;
        }
        .hero-steam span {
            width: 6px;
            height: 30px;
            background: linear-gradient(to top, var(--coffee-light), transparent);
            border-radius: 6px;
            animation: heroSteam 2s ease-in-out infinite;
        }
        .hero-steam span:nth-child(2) { animation-delay: 0.4s; height: 40px; }
        .hero-steam span:nth-child(3) { animation-delay: 0.8s; }
        @keyframes heroBounce {
            0%, 100% { transform: translateY(0) rotate(-2deg); }
            50% { transform: translateY(-15px) rotate(2deg); }
        }
        @keyframes heroSteam {
            0%, 100% { opacity: 0.3; transform: translateY(0) scaleY(0.8); }
            50% { opacity: 0.8; transform: translateY(-20px) scaleY(1.2); }
        }
        .onboarding-tagline {
            font-size: 18px;
            color: var(--text-light);
            margin-bottom: 32px;
        }
        .onboarding-stats-preview {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 24px;
            margin: 32px 0;
            padding: 20px;
            background: white;
            border-radius: 16px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
        }
        .preview-stat {
            text-align: center;
        }
        .preview-number {
            display: block;
            font-family: 'Playfair Display', serif;
            font-size: 28px;
            font-weight: 700;
            color: var(--coffee-medium);
        }
        .preview-label {
            font-size: 12px;
            color: var(--text-light);
        }
        .preview-divider {
            width: 1px;
            height: 40px;
            background: var(--border);
        }
        .onboarding-btn.large {
            padding: 20px 40px;
            font-size: 18px;
        }
        
        /* Emotion bubbles animation */
        .onboarding-illustration {
            margin: 32px 0;
        }
        .emotion-bubbles {
            display: flex;
            justify-content: center;
            gap: 16px;
        }
        .bubble {
            font-size: 48px;
            animation: bubbleFloat 3s ease-in-out infinite;
        }
        .bubble.b1 { animation-delay: 0s; }
        .bubble.b2 { animation-delay: 0.5s; }
        .bubble.b3 { animation-delay: 1s; }
        .bubble.b4 { animation-delay: 1.5s; }
        @keyframes bubbleFloat {
            0%, 100% { transform: translateY(0) scale(1); }
            50% { transform: translateY(-20px) scale(1.1); }
        }

        /* Brew demo */
        .brew-demo {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            margin: 32px 0;
            padding: 24px;
            background: white;
            border-radius: 16px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
        }
        .brew-step {
            text-align: center;
            padding: 16px;
        }
        .brew-step-icon {
            font-size: 36px;
            margin-bottom: 8px;
        }
        .brew-step-text {
            font-weight: 600;
            font-size: 14px;
            margin-bottom: 4px;
        }
        .brew-step-time {
            font-family: 'Playfair Display', serif;
            font-size: 20px;
            color: var(--coffee-medium);
            font-weight: 700;
        }
        .brew-arrow {
            font-size: 24px;
            color: var(--coffee-light);
        }

        /* Coffee menu preview */
        .coffee-menu-preview {
            display: flex;
            flex-direction: column;
            gap: 8px;
            margin: 24px 0;
            max-width: 350px;
        }
        .coffee-menu-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 16px;
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.06);
        }
        .coffee-menu-icon {
            font-size: 28px;
        }
        .coffee-menu-info {
            display: flex;
            flex-direction: column;
        }
        .coffee-menu-info strong {
            font-size: 14px;
        }
        .coffee-menu-info span {
            font-size: 12px;
            color: var(--text-light);
        }

        /* ========== HELP ACCORDION ========== */
        .help-accordion {
            border-bottom: 1px solid var(--border);
        }
        .help-accordion:last-child {
            border-bottom: none;
        }
        .help-accordion-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px 0;
            cursor: pointer;
            transition: all 0.3s;
        }
        .help-accordion-header:hover {
            color: var(--coffee-medium);
        }
        .accordion-arrow {
            transition: transform 0.3s;
            color: var(--text-light);
        }
        .help-accordion.open .accordion-arrow {
            transform: rotate(180deg);
        }
        .help-accordion-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease;
            padding: 0;
        }
        .help-accordion.open .help-accordion-content {
            max-height: 500px;
            padding-bottom: 16px;
        }
        .help-accordion-content p {
            font-size: 14px;
            line-height: 1.6;
            color: var(--text-light);
            margin-bottom: 8px;
            padding-left: 8px;
        }

        /* ========== MINDFUL STATS (STAMPS PAGE) ========== */
        .mindful-stats {
            display: flex;
            justify-content: space-between;
            gap: 12px;
        }
        .mindful-stat-item {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            padding: 16px 8px;
            background: var(--cream);
            border-radius: 12px;
        }
        .mindful-stat-icon {
            font-size: 28px;
            margin-bottom: 8px;
        }
        .mindful-stat-value {
            font-family: 'Playfair Display', serif;
            font-size: 24px;
            font-weight: 700;
            color: var(--coffee-medium);
        }
        .mindful-stat-label {
            font-size: 11px;
            color: var(--text-light);
            margin-top: 4px;
        }

        /* ========== ACHIEVEMENTS GRID ========== */
        .achievements-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 12px;
        }
        .achievement-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            padding: 12px 8px;
            background: var(--cream);
            border-radius: 12px;
            opacity: 0.4;
            transition: all 0.3s;
        }
        .achievement-item.unlocked {
            opacity: 1;
            background: linear-gradient(135deg, #fff5e6, #ffe4cc);
        }
        .achievement-icon {
            font-size: 28px;
            margin-bottom: 8px;
        }
        .achievement-name {
            font-size: 10px;
            font-weight: 600;
            color: var(--text);
        }
        @media (max-width: 430px) {
            .achievements-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            .mindful-stats {
                flex-direction: column;
            }
            .mindful-stat-item {
                flex-direction: row;
                justify-content: flex-start;
                gap: 16px;
                text-align: left;
            }
            .mindful-stat-info {
                text-align: left;
            }
        }

        /* ========== EXPERIENCE MODE ========== */
        .mode-option {
            display: flex;
            align-items: flex-start;
            gap: 12px;
            padding: 16px;
            background: white;
            border: 2px solid var(--border);
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s;
        }
        .mode-option:hover {
            border-color: var(--coffee-light);
        }
        .mode-option.active {
            border-color: var(--coffee-medium);
            background: linear-gradient(135deg, rgba(93, 64, 55, 0.05), rgba(141, 110, 99, 0.08));
        }
        .mode-radio {
            width: 20px;
            height: 20px;
            border: 2px solid var(--border);
            border-radius: 50%;
            flex-shrink: 0;
            margin-top: 2px;
            position: relative;
        }
        .mode-option.active .mode-radio {
            border-color: var(--coffee-medium);
        }
        .mode-option.active .mode-radio::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 10px;
            height: 10px;
            background: var(--coffee-medium);
            border-radius: 50%;
        }
        .mode-content {
            flex: 1;
        }
        .mode-title {
            font-weight: 600;
            font-size: 15px;
            margin-bottom: 4px;
        }
        .mode-desc {
            font-size: 12px;
            color: var(--text-light);
            line-height: 1.5;
        }

        /* ========== EXPERIMENT FRAME ========== */
        .experiment-frame {
            background: linear-gradient(135deg, #1a1a2e, #16213e);
            color: white;
            padding: 24px;
            border-radius: 16px;
            margin-bottom: 24px;
            text-align: center;
        }
        .experiment-badge {
            display: inline-block;
            padding: 6px 16px;
            background: rgba(255,255,255,0.1);
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 20px;
            font-size: 11px;
            font-weight: 700;
            letter-spacing: 2px;
            margin-bottom: 16px;
        }
        .experiment-title {
            font-family: 'Playfair Display', serif;
            font-size: 24px;
            font-weight: 600;
            margin-bottom: 12px;
        }
        .experiment-desc {
            font-size: 14px;
            opacity: 0.8;
            line-height: 1.6;
            margin-bottom: 20px;
        }
        .experiment-observe {
            background: rgba(255,255,255,0.05);
            padding: 16px;
            border-radius: 12px;
            text-align: left;
        }
        .observe-title {
            font-weight: 600;
            font-size: 13px;
            margin-bottom: 8px;
        }
        .observe-list {
            list-style: none;
            font-size: 13px;
            opacity: 0.9;
            line-height: 1.8;
        }
        .observe-list li::before {
            content: '‚Üí ';
            opacity: 0.5;
        }

        /* ========== RESEARCH REFLECTION ========== */
        .research-reflection {
            background: linear-gradient(135deg, #2d3436, #1e272e);
            border: 2px solid #636e72;
            border-radius: 16px;
            padding: 24px;
            margin: 24px 0;
        }
        .research-reflection-header {
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: 700;
            font-size: 16px;
            margin-bottom: 20px;
            color: #dfe6e9;
            padding-bottom: 12px;
            border-bottom: 1px solid #636e72;
        }
        .research-question {
            margin-bottom: 20px;
            padding: 16px;
            background: rgba(255,255,255,0.05);
            border-radius: 12px;
        }
        .research-q-text {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 12px;
            color: #fff;
        }
        .research-q-options {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }
        .research-option {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 10px 16px;
            background: rgba(255,255,255,0.1);
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 8px;
            font-size: 13px;
            color: #dfe6e9;
            cursor: pointer;
            transition: all 0.2s;
        }
        .research-option:hover {
            background: rgba(255,255,255,0.15);
            border-color: rgba(255,255,255,0.4);
        }
        .research-option input {
            accent-color: #74b9ff;
        }
        .research-option input:checked + span {
            font-weight: 600;
            color: #74b9ff;
        }

        /* ========== SELF-OBSERVATION PAGE ========== */
        .observation-intro {
            display: flex;
            align-items: center;
            gap: 16px;
            padding: 20px;
            background: linear-gradient(135deg, #2d1b13, #1a0f0a);
            color: white;
            border-radius: 16px;
            margin-bottom: 24px;
        }
        .observation-intro-icon {
            font-size: 40px;
        }
        .observation-intro-text {
            font-size: 14px;
            line-height: 1.6;
            opacity: 0.9;
        }
        .observation-card {
            background: white;
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 16px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.04);
        }
        .observation-card.primary {
            background: linear-gradient(135deg, var(--cream), var(--latte));
            text-align: center;
        }
        .observation-card.final {
            background: linear-gradient(135deg, #1a1a2e, #16213e);
            color: white;
            text-align: center;
        }
        .observation-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 16px;
        }
        .observation-icon {
            font-size: 20px;
        }
        .observation-title {
            font-weight: 700;
            font-size: 15px;
        }
        .observation-big-number {
            font-family: 'Playfair Display', serif;
            font-size: 72px;
            font-weight: 700;
            color: var(--coffee-dark);
            line-height: 1;
        }
        .observation-label {
            font-size: 14px;
            color: var(--text-light);
            margin-top: 8px;
        }
        .observation-insight {
            font-size: 13px;
            color: var(--text-light);
            font-style: italic;
            margin-top: 16px;
            padding: 12px;
            background: rgba(0,0,0,0.03);
            border-radius: 8px;
        }
        .observation-question {
            font-size: 13px;
            color: var(--coffee-medium);
            margin-top: 16px;
            padding: 12px;
            background: var(--cream);
            border-radius: 8px;
        }
        
        /* Perception Stats */
        .perception-stats {
            display: flex;
            justify-content: space-around;
            text-align: center;
        }
        .perception-item {
            flex: 1;
        }
        .perception-value {
            font-family: 'Playfair Display', serif;
            font-size: 28px;
            font-weight: 700;
            color: var(--coffee-medium);
        }
        .perception-label {
            font-size: 11px;
            color: var(--text-light);
            margin-top: 4px;
        }
        
        /* Control Visual */
        .control-bar {
            display: flex;
            height: 24px;
            border-radius: 12px;
            overflow: hidden;
            margin-bottom: 12px;
        }
        .control-fill {
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            font-weight: 600;
            color: white;
        }
        .control-fill.interface { background: #e74c3c; }
        .control-fill.together { background: #9b59b6; }
        .control-fill.me { background: #27ae60; }
        .control-legend {
            display: flex;
            justify-content: center;
            gap: 16px;
            font-size: 11px;
            color: var(--text-light);
        }
        .legend-dot {
            display: inline-block;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            margin-right: 4px;
        }
        .legend-dot.interface { background: #e74c3c; }
        .legend-dot.together { background: #9b59b6; }
        .legend-dot.me { background: #27ae60; }
        
        /* Transition Map */
        .transition-map {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        .transition-item {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 10px 12px;
            background: var(--cream);
            border-radius: 8px;
            font-size: 13px;
        }
        .transition-item.highlight {
            background: #ffebee;
        }
        .transition-from, .transition-to {
            flex: 1;
        }
        .transition-arrow {
            color: var(--text-light);
        }
        .transition-count {
            font-weight: 600;
            color: var(--coffee-medium);
        }
        
        /* Time Pattern */
        .time-pattern {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        .time-slot {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        .time-label {
            width: 70px;
            font-size: 13px;
            color: var(--text-light);
        }
        .time-bar {
            flex: 1;
            height: 8px;
            background: var(--cream);
            border-radius: 4px;
            overflow: hidden;
        }
        .time-fill {
            height: 100%;
            background: var(--coffee-medium);
            border-radius: 4px;
        }
        .time-percent {
            width: 40px;
            text-align: right;
            font-size: 13px;
            font-weight: 600;
            color: var(--coffee-medium);
        }
        
        /* Gamification Data */
        .gamification-data {
            margin-bottom: 16px;
        }
        .gamification-q {
            font-size: 13px;
            margin-bottom: 12px;
        }
        .gamification-responses {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        .response-bar {
            height: 28px;
            background: var(--cream);
            border-radius: 6px;
            overflow: hidden;
        }
        .response-fill {
            height: 100%;
            display: flex;
            align-items: center;
            padding: 0 12px;
            font-size: 11px;
            font-weight: 600;
            color: white;
        }
        .response-fill.yes { background: #27ae60; }
        .response-fill.pressure { background: #e74c3c; }
        .response-fill.no { background: #95a5a6; }
        .mode-switch-hint {
            font-size: 12px;
            color: var(--text-light);
            margin-top: 12px;
            padding: 12px;
            background: var(--cream);
            border-radius: 8px;
        }
        
        /* Final Reflection */
        .final-question {
            font-family: 'Playfair Display', serif;
            font-size: 22px;
            line-height: 1.5;
            margin-bottom: 24px;
            opacity: 0.9;
        }
        .final-prompt {
            font-size: 14px;
            margin-bottom: 12px;
            opacity: 0.7;
        }
        .final-input {
            width: 100%;
            min-height: 100px;
            padding: 16px;
            background: rgba(255,255,255,0.1);
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 12px;
            color: white;
            font-family: 'Inter', sans-serif;
            font-size: 14px;
            resize: vertical;
        }
        .final-input::placeholder {
            color: rgba(255,255,255,0.4);
        }
        
        /* ========== CALENDAR PAGE STYLES ========== */
        .calendar-page-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
        }
        .calendar-month-nav {
            display: flex;
            align-items: center;
            gap: 16px;
        }
        .calendar-month-nav button {
            width: 40px;
            height: 40px;
            border: none;
            background: var(--cream);
            border-radius: 50%;
            cursor: pointer;
            font-size: 18px;
            transition: all 0.2s;
        }
        .calendar-month-nav button:hover {
            background: var(--coffee-light);
            color: white;
        }
        .calendar-month-title {
            font-family: 'Playfair Display', serif;
            font-size: 24px;
            font-weight: 600;
        }
        .calendar-weekdays {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 4px;
            margin-bottom: 8px;
        }
        .calendar-weekday {
            text-align: center;
            font-size: 12px;
            font-weight: 600;
            color: var(--text-light);
            padding: 8px 0;
        }
        .calendar-days {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 4px;
        }
        .calendar-day-cell {
            aspect-ratio: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.2s;
            position: relative;
            background: white;
            border: 1px solid var(--border);
        }
        .calendar-day-cell:hover {
            background: var(--cream);
            transform: scale(1.05);
        }
        .calendar-day-cell.today {
            border: 2px solid var(--coffee-medium);
            font-weight: 700;
        }
        .calendar-day-cell.has-brew {
            background: linear-gradient(135deg, #fff5e6, #ffe4cc);
        }
        .calendar-day-cell.has-brew::after {
            content: '‚òï';
            position: absolute;
            bottom: 4px;
            font-size: 12px;
        }
        .calendar-day-cell.future {
            opacity: 0.4;
            pointer-events: none;
        }
        .calendar-day-num {
            font-size: 14px;
            font-weight: 500;
        }
        .calendar-day-emotion {
            font-size: 10px;
            margin-top: 2px;
        }
        .calendar-stats-row {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
            margin-top: 24px;
        }
        .calendar-stat-card {
            background: white;
            border-radius: 16px;
            padding: 16px;
            text-align: center;
            box-shadow: 0 2px 8px rgba(0,0,0,0.04);
        }
        .calendar-stat-icon {
            font-size: 28px;
            margin-bottom: 8px;
        }
        .calendar-stat-value {
            font-family: 'Playfair Display', serif;
            font-size: 24px;
            font-weight: 700;
            color: var(--coffee-medium);
        }
        .calendar-stat-label {
            font-size: 11px;
            color: var(--text-light);
            margin-top: 4px;
        }
        .calendar-detail-card {
            background: white;
            border-radius: 16px;
            padding: 20px;
            margin-top: 16px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.04);
        }
        .calendar-detail-title {
            font-weight: 600;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .brew-history-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            background: var(--cream);
            border-radius: 12px;
            margin-bottom: 8px;
        }
        .brew-history-icon {
            font-size: 24px;
        }
        .brew-history-info {
            flex: 1;
        }
        .brew-history-name {
            font-weight: 600;
            font-size: 14px;
        }
        .brew-history-emotion {
            font-size: 12px;
            color: var(--text-light);
        }
        .brew-history-time {
            font-size: 12px;
            color: var(--text-light);
        }
        
        /* ========== REWARDS/COUPON PAGE STYLES ========== */
        .rewards-header {
            text-align: center;
            padding: 24px;
            background: linear-gradient(135deg, #ffeaa7, #fdcb6e);
            border-radius: 20px;
            margin-bottom: 24px;
        }
        .rewards-icon {
            font-size: 64px;
            margin-bottom: 12px;
        }
        .rewards-title {
            font-family: 'Playfair Display', serif;
            font-size: 28px;
            font-weight: 700;
            color: var(--coffee-dark);
        }
        .rewards-subtitle {
            font-size: 14px;
            color: var(--coffee-medium);
            margin-top: 8px;
        }
        .rewards-progress-card {
            background: white;
            border-radius: 20px;
            padding: 24px;
            margin-bottom: 20px;
            box-shadow: 0 4px 16px rgba(0,0,0,0.08);
        }
        .rewards-progress-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }
        .rewards-progress-title {
            font-weight: 600;
            font-size: 16px;
        }
        .rewards-progress-count {
            font-family: 'Playfair Display', serif;
            font-size: 24px;
            font-weight: 700;
            color: var(--coffee-medium);
        }
        .rewards-progress-bar {
            height: 12px;
            background: var(--cream);
            border-radius: 6px;
            overflow: hidden;
            margin-bottom: 12px;
        }
        .rewards-progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #fdcb6e, #f39c12);
            border-radius: 6px;
            transition: width 0.5s ease;
        }
        .rewards-stamps-preview {
            display: flex;
            justify-content: space-between;
            margin-top: 8px;
        }
        .reward-stamp-dot {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: var(--cream);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            border: 2px solid var(--border);
        }
        .reward-stamp-dot.filled {
            background: linear-gradient(135deg, #fdcb6e, #f39c12);
            border-color: #f39c12;
        }
        .reward-stamp-dot.next {
            border: 2px dashed var(--coffee-light);
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }
        .coupon-card {
            background: white;
            border-radius: 20px;
            overflow: hidden;
            margin-bottom: 16px;
            box-shadow: 0 4px 16px rgba(0,0,0,0.08);
            position: relative;
        }
        .coupon-card.locked {
            opacity: 0.6;
        }
        .coupon-card::before {
            content: '';
            position: absolute;
            left: -10px;
            top: 50%;
            width: 20px;
            height: 20px;
            background: var(--bg);
            border-radius: 50%;
        }
        .coupon-card::after {
            content: '';
            position: absolute;
            right: -10px;
            top: 50%;
            width: 20px;
            height: 20px;
            background: var(--bg);
            border-radius: 50%;
        }
        .coupon-top {
            padding: 20px;
            background: linear-gradient(135deg, var(--coffee-medium), var(--coffee-dark));
            color: white;
        }
        .coupon-badge {
            display: inline-block;
            padding: 4px 12px;
            background: rgba(255,255,255,0.2);
            border-radius: 20px;
            font-size: 11px;
            font-weight: 600;
            margin-bottom: 8px;
        }
        .coupon-value {
            font-family: 'Playfair Display', serif;
            font-size: 32px;
            font-weight: 700;
        }
        .coupon-desc {
            font-size: 13px;
            opacity: 0.9;
            margin-top: 4px;
        }
        .coupon-bottom {
            padding: 16px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-top: 2px dashed var(--border);
        }
        .coupon-requirement {
            font-size: 13px;
            color: var(--text-light);
        }
        .coupon-status {
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 13px;
            font-weight: 600;
        }
        .coupon-status.available {
            background: #d4edda;
            color: #155724;
        }
        .coupon-status.locked {
            background: var(--cream);
            color: var(--text-light);
        }
        .coupon-status.used {
            background: #f8d7da;
            color: #721c24;
        }
        .milestone-section {
            margin-top: 24px;
        }
        .milestone-title {
            font-weight: 600;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .milestone-item {
            display: flex;
            align-items: center;
            gap: 16px;
            padding: 16px;
            background: white;
            border-radius: 16px;
            margin-bottom: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.04);
        }
        .milestone-icon {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: var(--cream);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
        }
        .milestone-icon.achieved {
            background: linear-gradient(135deg, #ffeaa7, #fdcb6e);
        }
        .milestone-info {
            flex: 1;
        }
        .milestone-name {
            font-weight: 600;
            font-size: 15px;
        }
        .milestone-desc {
            font-size: 12px;
            color: var(--text-light);
            margin-top: 2px;
        }
        .milestone-progress {
            text-align: right;
        }
        .milestone-count {
            font-weight: 700;
            color: var(--coffee-medium);
        }
        
        /* Gamified-only elements */
        .gamified-only {
            /* Will be toggled by JS */
        }
        body.pure-mode .gamified-only {
            display: none !important;
        }
        
        /* Breathe animation for home page */
        @keyframes breathe {
            0%, 100% { transform: scale(1); opacity: 0.8; }
            50% { transform: scale(1.15); opacity: 1; }
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-20px); }
        }
        
        @keyframes steam {
            0%, 100% { 
                opacity: 0.3; 
                transform: translateY(0) scaleY(1);
            }
            50% { 
                opacity: 0.6; 
                transform: translateY(-10px) scaleY(1.2);
            }
        }
        
        /* Ensure research reflection is visible */
        .research-reflection {
            display: block !important;
        }
    </style>
</head>
<body>
    <!-- SPLASH SCREEN -->
    <div class="splash-screen" id="splashScreen">
        <div class="splash-content">
            <div class="splash-logo-container">
                <div class="splash-cup">‚òï</div>
                <div class="splash-steam">
                    <span></span><span></span><span></span>
                </div>
            </div>
            <h1 class="splash-title">Breath Caf√©</h1>
            <p class="splash-tagline">Breathe. Brew. Be.</p>
            <div class="splash-loader">
                <div class="splash-loader-fill"></div>
            </div>
        </div>
    </div>

    <!-- ONBOARDING OVERLAY -->
    <div class="onboarding-overlay" id="onboardingOverlay">
        <button class="onboarding-skip" onclick="skipOnboarding()">Skip ‚Üí</button>
        
        <!-- Slide 0: Hero Welcome -->
        <div class="onboarding-slide active" id="slide0">
            <div class="onboarding-hero">
                <div class="hero-cup-container">
                    <div class="hero-cup">‚òï</div>
                    <div class="hero-steam">
                        <span></span><span></span><span></span>
                    </div>
                </div>
            </div>
            <h1 class="onboarding-title" style="font-size: 48px;">Breath Caf√©</h1>
            <p class="onboarding-tagline">Where mindful breathing meets coffee brewing</p>
            <div class="onboarding-stats-preview">
                <div class="preview-stat">
                    <span class="preview-number">2min</span>
                    <span class="preview-label">per session</span>
                </div>
                <div class="preview-divider"></div>
                <div class="preview-stat">
                    <span class="preview-number">5</span>
                    <span class="preview-label">unique brews</span>
                </div>
                <div class="preview-divider"></div>
                <div class="preview-stat">
                    <span class="preview-number">87%</span>
                    <span class="preview-label">feel better</span>
                </div>
            </div>
            <div class="onboarding-dots">
                <div class="onboarding-dot active" onclick="goToSlide(0)"></div>
                <div class="onboarding-dot" onclick="goToSlide(1)"></div>
                <div class="onboarding-dot" onclick="goToSlide(2)"></div>
                <div class="onboarding-dot" onclick="goToSlide(3)"></div>
                <div class="onboarding-dot" onclick="goToSlide(4)"></div>
                <div class="onboarding-dot" onclick="goToSlide(5)"></div>
            </div>
            <div class="onboarding-buttons">
                <button class="onboarding-btn primary large" onclick="nextSlide()">Begin Your Journey ‚Üí</button>
            </div>
        </div>
        
        <!-- Slide 1: The Problem -->
        <div class="onboarding-slide" id="slide1">
            <div class="onboarding-icon">üòÆ‚Äçüí®</div>
            <h1 class="onboarding-title">Feeling Overwhelmed?</h1>
            <p class="onboarding-desc">Stress, anxiety, and difficult emotions are part of life. But you don't have to face them alone.</p>
            <div class="onboarding-illustration">
                <div class="emotion-bubbles">
                    <span class="bubble b1">üò∞</span>
                    <span class="bubble b2">üò§</span>
                    <span class="bubble b3">üò¢</span>
                    <span class="bubble b4">üò¥</span>
                </div>
            </div>
            <div class="onboarding-dots">
                <div class="onboarding-dot" onclick="goToSlide(0)"></div>
                <div class="onboarding-dot active" onclick="goToSlide(1)"></div>
                <div class="onboarding-dot" onclick="goToSlide(2)"></div>
                <div class="onboarding-dot" onclick="goToSlide(3)"></div>
                <div class="onboarding-dot" onclick="goToSlide(4)"></div>
                <div class="onboarding-dot" onclick="goToSlide(5)"></div>
            </div>
            <div class="onboarding-buttons">
                <button class="onboarding-btn secondary" onclick="prevSlide()">‚Üê Back</button>
                <button class="onboarding-btn primary" onclick="nextSlide()">Next ‚Üí</button>
            </div>
        </div>
        
        <!-- Slide 2: The Solution -->
        <div class="onboarding-slide" id="slide2">
            <div class="onboarding-icon">ü´Å</div>
            <h1 class="onboarding-title">Breathe Like Brewing Coffee</h1>
            <p class="onboarding-desc">We've transformed breathing exercises into a cozy coffee ritual. Each "brew" is a guided breathing pattern designed for your specific emotion.</p>
            <div class="brew-demo">
                <div class="brew-step">
                    <div class="brew-step-icon">ü´ò</div>
                    <div class="brew-step-text">Inhale</div>
                    <div class="brew-step-time">5s</div>
                </div>
                <div class="brew-arrow">‚Üí</div>
                <div class="brew-step">
                    <div class="brew-step-icon">‚ô®Ô∏è</div>
                    <div class="brew-step-text">Hold</div>
                    <div class="brew-step-time">4s</div>
                </div>
                <div class="brew-arrow">‚Üí</div>
                <div class="brew-step">
                    <div class="brew-step-icon">‚òï</div>
                    <div class="brew-step-text">Exhale</div>
                    <div class="brew-step-time">7s</div>
                </div>
            </div>
            <div class="onboarding-dots">
                <div class="onboarding-dot" onclick="goToSlide(0)"></div>
                <div class="onboarding-dot" onclick="goToSlide(1)"></div>
                <div class="onboarding-dot active" onclick="goToSlide(2)"></div>
                <div class="onboarding-dot" onclick="goToSlide(3)"></div>
                <div class="onboarding-dot" onclick="goToSlide(4)"></div>
                <div class="onboarding-dot" onclick="goToSlide(5)"></div>
            </div>
            <div class="onboarding-buttons">
                <button class="onboarding-btn secondary" onclick="prevSlide()">‚Üê Back</button>
                <button class="onboarding-btn primary" onclick="nextSlide()">Next ‚Üí</button>
            </div>
        </div>
        
        <!-- Slide 3: Coffee Types -->
        <div class="onboarding-slide" id="slide3">
            <div class="onboarding-icon">üéØ</div>
            <h1 class="onboarding-title">5 Brews for Every Mood</h1>
            <p class="onboarding-desc">Each coffee has a unique breathing rhythm scientifically designed for specific emotions.</p>
            <div class="coffee-menu-preview">
                <div class="coffee-menu-item">
                    <span class="coffee-menu-icon">ü´ñ</span>
                    <div class="coffee-menu-info">
                        <strong>Mocha</strong>
                        <span>Sadness ‚Üí Comfort</span>
                    </div>
                </div>
                <div class="coffee-menu-item">
                    <span class="coffee-menu-icon">‚òï</span>
                    <div class="coffee-menu-info">
                        <strong>Americano</strong>
                        <span>Anxiety ‚Üí Balance</span>
                    </div>
                </div>
                <div class="coffee-menu-item">
                    <span class="coffee-menu-icon">üßä</span>
                    <div class="coffee-menu-info">
                        <strong>Cold Brew</strong>
                        <span>Anger ‚Üí Calm</span>
                    </div>
                </div>
                <div class="coffee-menu-item">
                    <span class="coffee-menu-icon">ü•õ</span>
                    <div class="coffee-menu-info">
                        <strong>Latte</strong>
                        <span>Stress ‚Üí Peace</span>
                    </div>
                </div>
                <div class="coffee-menu-item">
                    <span class="coffee-menu-icon">üçØ</span>
                    <div class="coffee-menu-info">
                        <strong>Caramel</strong>
                        <span>Joy ‚Üí Bliss</span>
                    </div>
                </div>
            </div>
            <div class="onboarding-dots">
                <div class="onboarding-dot" onclick="goToSlide(0)"></div>
                <div class="onboarding-dot" onclick="goToSlide(1)"></div>
                <div class="onboarding-dot" onclick="goToSlide(2)"></div>
                <div class="onboarding-dot active" onclick="goToSlide(3)"></div>
                <div class="onboarding-dot" onclick="goToSlide(4)"></div>
                <div class="onboarding-dot" onclick="goToSlide(5)"></div>
            </div>
            <div class="onboarding-buttons">
                <button class="onboarding-btn secondary" onclick="prevSlide()">‚Üê Back</button>
                <button class="onboarding-btn primary" onclick="nextSlide()">Next ‚Üí</button>
            </div>
        </div>
        
        <!-- Slide 4: Goal Selection (NEW) -->
        <div class="onboarding-slide" id="slide4">
            <div class="onboarding-icon">üéØ</div>
            <h1 class="onboarding-title">What brings you here?</h1>
            <p class="onboarding-desc">Select your primary goal (you can change this later)</p>
            
            <div style="display: flex; flex-direction: column; gap: 12px; margin: 24px 0; max-width: 320px;">
                <button onclick="selectGoal(this, 'focus')" class="goal-option" style="display: flex; align-items: center; gap: 16px; padding: 16px 20px; background: #fff; border: 2px solid #e8dcc7; border-radius: 16px; cursor: pointer; text-align: left; transition: all 0.2s;">
                    <span style="font-size: 28px;">üß†</span>
                    <div>
                        <div style="font-weight: 600; color: #3e2723;">Focus & Clarity</div>
                        <div style="font-size: 13px; color: #8d6e63;">Improve concentration</div>
                    </div>
                </button>
                <button onclick="selectGoal(this, 'relax')" class="goal-option" style="display: flex; align-items: center; gap: 16px; padding: 16px 20px; background: #fff; border: 2px solid #e8dcc7; border-radius: 16px; cursor: pointer; text-align: left; transition: all 0.2s;">
                    <span style="font-size: 28px;">üòå</span>
                    <div>
                        <div style="font-weight: 600; color: #3e2723;">Relax & De-stress</div>
                        <div style="font-size: 13px; color: #8d6e63;">Calm anxiety & tension</div>
                    </div>
                </button>
                <button onclick="selectGoal(this, 'sleep')" class="goal-option" style="display: flex; align-items: center; gap: 16px; padding: 16px 20px; background: #fff; border: 2px solid #e8dcc7; border-radius: 16px; cursor: pointer; text-align: left; transition: all 0.2s;">
                    <span style="font-size: 28px;">üåô</span>
                    <div>
                        <div style="font-weight: 600; color: #3e2723;">Better Sleep</div>
                        <div style="font-size: 13px; color: #8d6e63;">Wind down at night</div>
                    </div>
                </button>
            </div>
            
            <div class="onboarding-dots">
                <div class="onboarding-dot" onclick="goToSlide(0)"></div>
                <div class="onboarding-dot" onclick="goToSlide(1)"></div>
                <div class="onboarding-dot" onclick="goToSlide(2)"></div>
                <div class="onboarding-dot" onclick="goToSlide(3)"></div>
                <div class="onboarding-dot active" onclick="goToSlide(4)"></div>
                <div class="onboarding-dot" onclick="goToSlide(5)"></div>
            </div>
            <div class="onboarding-buttons">
                <button class="onboarding-btn secondary" onclick="prevSlide()">‚Üê Back</button>
                <button class="onboarding-btn primary" onclick="nextSlide()">Next ‚Üí</button>
            </div>
        </div>
        
        <!-- Slide 5: Breathing Style (NEW) -->
        <div class="onboarding-slide" id="slide5">
            <div class="onboarding-icon">ü´Å</div>
            <h1 class="onboarding-title">Your Breathing Style</h1>
            <p class="onboarding-desc">How much time do you have for each session?</p>
            
            <div style="display: flex; flex-direction: column; gap: 12px; margin: 24px 0; max-width: 320px;">
                <button onclick="selectStyle(this, 'quick')" class="style-option" style="display: flex; align-items: center; gap: 16px; padding: 16px 20px; background: #fff; border: 2px solid #e8dcc7; border-radius: 16px; cursor: pointer; text-align: left; transition: all 0.2s;">
                    <span style="font-size: 28px;">‚ö°</span>
                    <div style="flex: 1;">
                        <div style="font-weight: 600; color: #3e2723;">Quick</div>
                        <div style="font-size: 13px; color: #8d6e63;">~1 minute sessions</div>
                    </div>
                    <div style="font-size: 12px; color: #a1887f; background: #f5f0e8; padding: 4px 10px; border-radius: 12px;">4-2-4</div>
                </button>
                <button onclick="selectStyle(this, 'balanced')" class="style-option" style="display: flex; align-items: center; gap: 16px; padding: 16px 20px; background: #fff; border: 2px solid #e8dcc7; border-radius: 16px; cursor: pointer; text-align: left; transition: all 0.2s;">
                    <span style="font-size: 28px;">‚òØÔ∏è</span>
                    <div style="flex: 1;">
                        <div style="font-weight: 600; color: #3e2723;">Balanced</div>
                        <div style="font-size: 13px; color: #8d6e63;">~2 minute sessions</div>
                    </div>
                    <div style="font-size: 12px; color: #a1887f; background: #f5f0e8; padding: 4px 10px; border-radius: 12px;">5-4-6</div>
                </button>
                <button onclick="selectStyle(this, 'deep')" class="style-option" style="display: flex; align-items: center; gap: 16px; padding: 16px 20px; background: #fff; border: 2px solid #e8dcc7; border-radius: 16px; cursor: pointer; text-align: left; transition: all 0.2s;">
                    <span style="font-size: 28px;">üßò</span>
                    <div style="flex: 1;">
                        <div style="font-weight: 600; color: #3e2723;">Deep</div>
                        <div style="font-size: 13px; color: #8d6e63;">~3 minute sessions</div>
                    </div>
                    <div style="font-size: 12px; color: #a1887f; background: #f5f0e8; padding: 4px 10px; border-radius: 12px;">6-5-8</div>
                </button>
            </div>
            
            <div style="text-align: center; font-size: 13px; color: #8d6e63; margin-bottom: 16px;">
                You can adjust this anytime in Settings
            </div>
            
            <div class="onboarding-dots">
                <div class="onboarding-dot" onclick="goToSlide(0)"></div>
                <div class="onboarding-dot" onclick="goToSlide(1)"></div>
                <div class="onboarding-dot" onclick="goToSlide(2)"></div>
                <div class="onboarding-dot" onclick="goToSlide(3)"></div>
                <div class="onboarding-dot" onclick="goToSlide(4)"></div>
                <div class="onboarding-dot active" onclick="goToSlide(5)"></div>
            </div>
            <div class="onboarding-buttons">
                <button class="onboarding-btn secondary" onclick="prevSlide()">‚Üê Back</button>
                <button class="onboarding-btn primary large" onclick="finishOnboarding()">Start Brewing ‚òï</button>
            </div>
        </div>
    </div>
        </div>
    </div>

    <!-- HEADER -->
    <header class="header">
        <div class="header-left">
            <button class="hamburger" id="hamburgerBtn" onclick="toggleSidebar()">
                <span></span><span></span><span></span>
            </button>
            <a href="#" class="logo" onclick="goTo('welcome')">
                <span class="logo-icon">‚òï</span>
                <span class="logo-text">Breath Caf√©</span>
            </a>
        </div>
        <div class="header-center">
            <nav class="header-nav">
                <button class="header-nav-item active" onclick="goTo('welcome')">üè† Home</button>
                <button class="header-nav-item" onclick="goTo('emotion')">‚òï Brew</button>
                <button class="header-nav-item" onclick="goTo('journal')">üìñ Journal</button>
                <button class="header-nav-item" onclick="goTo('stats')">üî¨ Observe</button>
            </nav>
        </div>
        <div class="header-right">
            <div class="streak-badge"><span>üî•</span><span>7 Day Streak</span></div>
            <div class="user-avatar">üë§</div>
        </div>
    </header>

    <!-- SIDEBAR OVERLAY -->
    <div class="sidebar-overlay" id="sidebarOverlay" onclick="toggleSidebar()"></div>

    <!-- SIDEBAR -->
    <nav class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <span style="font-size: 28px;">‚òï</span>
            <span class="sidebar-logo">Breath Caf√©</span>
            <button class="sidebar-close" onclick="toggleSidebar()">‚úï</button>
        </div>
        <div class="sidebar-content">
            <div class="sidebar-section">
                <div class="sidebar-section-title">Main Menu</div>
                <ul class="sidebar-menu">
                    <li class="sidebar-menu-item"><a class="sidebar-menu-link active" onclick="goTo('welcome'); toggleSidebar();"><span class="sidebar-menu-icon">üè†</span><span>Home</span></a></li>
                    <li class="sidebar-menu-item"><a class="sidebar-menu-link" onclick="goTo('emotion'); toggleSidebar();"><span class="sidebar-menu-icon">‚òï</span><span>Start Brewing</span><span class="sidebar-menu-badge">NEW</span></a></li>
                    <li class="sidebar-menu-item"><a class="sidebar-menu-link" onclick="goTo('calendar'); toggleSidebar();"><span class="sidebar-menu-icon">üìÖ</span><span>Calendar</span></a></li>
                    <li class="sidebar-menu-item gamified-only"><a class="sidebar-menu-link" onclick="goTo('rewards'); toggleSidebar();"><span class="sidebar-menu-icon">üéÅ</span><span>Rewards & Coupons</span></a></li>
                    <li class="sidebar-menu-item gamified-only"><a class="sidebar-menu-link" onclick="goTo('stamps'); toggleSidebar();"><span class="sidebar-menu-icon">üèÜ</span><span>Stamp Collection</span></a></li>
                </ul>
            </div>
            <div class="sidebar-section">
                <div class="sidebar-section-title">Records</div>
                <ul class="sidebar-menu">
                    <li class="sidebar-menu-item"><a class="sidebar-menu-link" onclick="goTo('journal'); toggleSidebar();"><span class="sidebar-menu-icon">üìñ</span><span>Journal</span></a></li>
                    <li class="sidebar-menu-item"><a class="sidebar-menu-link" onclick="goTo('stats'); toggleSidebar();"><span class="sidebar-menu-icon">üî¨</span><span>Self-Observation</span></a></li>
                    <li class="sidebar-menu-item"><a class="sidebar-menu-link" onclick="goTo('weekly'); toggleSidebar();"><span class="sidebar-menu-icon">üìä</span><span>Weekly Report</span></a></li>
                </ul>
            </div>
            <div class="sidebar-section">
                <div class="sidebar-section-title">Settings</div>
                <ul class="sidebar-menu">
                    <li class="sidebar-menu-item"><a class="sidebar-menu-link" onclick="goTo('settings'); toggleSidebar();"><span class="sidebar-menu-icon">‚öôÔ∏è</span><span>Settings</span></a></li>
                    <li class="sidebar-menu-item"><a class="sidebar-menu-link" onclick="goTo('notifications'); toggleSidebar();"><span class="sidebar-menu-icon">üîî</span><span>Notifications</span></a></li>
                    <li class="sidebar-menu-item"><a class="sidebar-menu-link" onclick="goTo('help'); toggleSidebar();"><span class="sidebar-menu-icon">‚ùì</span><span>Help</span></a></li>
                </ul>
            </div>
        </div>
        <div class="sidebar-footer">
            <div class="sidebar-user" onclick="goTo('account'); toggleSidebar();" style="cursor: pointer;">
                <div class="sidebar-user-avatar">üë§</div>
                <div>
                    <div class="sidebar-user-name">Guest</div>
                    <div class="sidebar-user-level">Manage your Account</div>
                </div>
            </div>
        </div>
    </nav>

    <div class="app">
        <!-- PAGE 1: WELCOME -->
        <div id="welcome" class="page active">
            
            <!-- Hero Section - Warm Coffee Style -->
            <div style="background: linear-gradient(180deg, #2d1b13 0%, #3e2723 40%, #5d4037 100%); margin: -40px -40px 0 -40px; padding: 50px 40px 70px; position: relative; overflow: hidden;">
                
                <!-- Coffee Bean Pattern Background -->
                <div style="position: absolute; top: 0; left: 0; right: 0; bottom: 0; opacity: 0.05;">
                    <div style="position: absolute; top: 15%; left: 8%; font-size: 40px; transform: rotate(-15deg);">‚òï</div>
                    <div style="position: absolute; top: 35%; right: 12%; font-size: 30px; transform: rotate(20deg);">‚òï</div>
                    <div style="position: absolute; bottom: 25%; left: 15%; font-size: 25px; transform: rotate(-10deg);">‚òï</div>
                    <div style="position: absolute; top: 60%; right: 20%; font-size: 35px; transform: rotate(15deg);">‚òï</div>
                </div>
                
                <!-- Main Title -->
                <div style="text-align: center; position: relative; z-index: 1;">
                    
                    <!-- Logo -->
                    <div style="margin-bottom: 24px;">
                        <span style="font-size: 56px;">‚òï</span>
                    </div>
                    
                    <h1 style="font-family: 'Caveat', cursive; font-size: 52px; color: #fff; font-weight: 700; margin-bottom: 4px; letter-spacing: 1px;">
                        Breath Caf√©
                    </h1>
                    
                    <div style="font-family: 'Playfair Display', serif; font-size: 14px; color: #d7ccc8; letter-spacing: 3px; margin-bottom: 20px;">
                        SLOW DOWN ¬∑ BREATHE ¬∑ OBSERVE
                    </div>
                    
                    <div style="width: 80px; height: 1px; background: linear-gradient(90deg, transparent, #8d6e63, transparent); margin: 0 auto 20px;"></div>
                    
                    <p style="font-family: 'Playfair Display', serif; color: #bcaaa4; font-size: 16px; line-height: 1.8; max-width: 300px; margin: 0 auto; font-style: italic;">
                        "Every breath is a chance to<br>reclaim your own rhythm"
                    </p>
                </div>
                
                <!-- Animated Coffee Cup -->
                <div style="text-align: center; margin-top: 32px;">
                    <div style="display: inline-block; position: relative;">
                        <!-- Steam Lines -->
                        <div style="position: absolute; top: -20px; left: 50%; transform: translateX(-50%); display: flex; gap: 8px;">
                            <div style="width: 2px; height: 20px; background: linear-gradient(to top, rgba(255,255,255,0.3), transparent); border-radius: 2px; animation: steam 2s ease-in-out infinite;"></div>
                            <div style="width: 2px; height: 25px; background: linear-gradient(to top, rgba(255,255,255,0.3), transparent); border-radius: 2px; animation: steam 2s ease-in-out infinite 0.3s;"></div>
                            <div style="width: 2px; height: 18px; background: linear-gradient(to top, rgba(255,255,255,0.3), transparent); border-radius: 2px; animation: steam 2s ease-in-out infinite 0.6s;"></div>
                        </div>
                        <!-- Cup Circle -->
                        <div style="width: 100px; height: 100px; border: 3px solid rgba(255,255,255,0.2); border-radius: 50%; display: flex; align-items: center; justify-content: center; animation: breathe 4s ease-in-out infinite;">
                            <div style="width: 70px; height: 70px; background: rgba(255,255,255,0.1); border-radius: 50%; display: flex; align-items: center; justify-content: center;">
                                <span style="font-size: 28px;">ü´Å</span>
                            </div>
                        </div>
                        <div style="margin-top: 12px; font-family: 'Caveat', cursive; font-size: 16px; color: #a1887f;">
                            breathe with me
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Research Question Card - Coffee Paper Style -->
            <div style="background: #fffbf5; margin: -30px 0 20px 0; border-radius: 20px; padding: 24px; box-shadow: 0 4px 20px rgba(45, 27, 19, 0.15); position: relative; border: 1px solid #e8dcc7;">
                <div style="position: absolute; top: -12px; left: 50%; transform: translateX(-50%); background: #5d4037; color: #fff; padding: 5px 14px; border-radius: 20px; font-size: 11px; font-weight: 600; font-family: 'Inter', sans-serif;">
                    ‚òï TODAY'S QUESTION
                </div>
                <div style="text-align: center; padding-top: 8px;">
                    <p style="font-family: 'Playfair Display', serif; font-size: 18px; color: #3e2723; line-height: 1.7; font-style: italic;">
                        "Does the interface control me,<br>
                        or can I define the speed<br>
                        of my own experience?"
                    </p>
                </div>
            </div>
            
            <!-- Stats Cards - Warm Style -->
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 20px;">
                <div style="background: linear-gradient(135deg, #efebe9, #d7ccc8); border-radius: 16px; padding: 20px; text-align: center;">
                    <div style="font-family: 'Caveat', cursive; font-size: 14px; color: #5d4037; margin-bottom: 6px;">Brews Made</div>
                    <div style="font-family: 'Playfair Display', serif; font-size: 40px; font-weight: 600; color: #3e2723;">24</div>
                    <div style="font-size: 11px; color: #8d6e63;">this month</div>
                </div>
                <div style="background: linear-gradient(135deg, #efebe9, #d7ccc8); border-radius: 16px; padding: 20px; text-align: center;">
                    <div style="font-family: 'Caveat', cursive; font-size: 14px; color: #5d4037; margin-bottom: 6px;">Time Paused</div>
                    <div style="font-family: 'Playfair Display', serif; font-size: 40px; font-weight: 600; color: #3e2723;">48<span style="font-size: 18px;">m</span></div>
                    <div style="font-size: 11px; color: #8d6e63;">of mindfulness</div>
                </div>
            </div>
            
            <!-- Today's Note - Handwritten Style -->
            <div style="background: #fffdf8; border-radius: 16px; padding: 20px; margin-bottom: 20px; border: 1px solid #e8dcc7; position: relative;">
                <div style="position: absolute; top: -1px; left: 20px; right: 20px; height: 3px; background: repeating-linear-gradient(90deg, #d7ccc8, #d7ccc8 10px, transparent 10px, transparent 12px);"></div>
                <div style="display: flex; align-items: flex-start; gap: 14px;">
                    <div style="font-size: 28px;">üìù</div>
                    <div>
                        <div style="font-family: 'Caveat', cursive; font-size: 18px; color: #5d4037; margin-bottom: 6px;">A gentle reminder...</div>
                        <p style="font-family: 'Caveat', cursive; font-size: 17px; line-height: 1.6; color: #6d4c41;">
                            You last paused <strong>3 hours ago</strong>.<br>
                            Your mind has been racing since then.<br>
                            <span style="color: #8d6e63;">Maybe it's time for a slow brew?</span>
                        </p>
                    </div>
                </div>
            </div>
            
            <!-- Experience Mode Card -->
            <div style="background: #fff; border-radius: 16px; padding: 16px; margin-bottom: 20px; border: 1px solid #e8dcc7; display: flex; align-items: center; justify-content: space-between;">
                <div style="display: flex; align-items: center; gap: 12px;">
                    <div id="homeModeIcon" style="width: 44px; height: 44px; background: linear-gradient(135deg, #ffcc80, #ffab40); border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 20px;">üéÆ</div>
                    <div>
                        <div style="font-family: 'Inter', sans-serif; font-size: 14px; font-weight: 600; color: #3e2723;" id="homeModeText">Gamified Mode</div>
                        <div style="font-size: 12px; color: #8d6e63;">Rewards & streaks on</div>
                    </div>
                </div>
                <button onclick="goTo('settings')" style="padding: 8px 16px; background: #efebe9; border: none; border-radius: 20px; font-size: 12px; cursor: pointer; color: #5d4037; font-weight: 500;">
                    Switch
                </button>
            </div>
            
            <!-- Gamified Stats (only in Gamified Mode) -->
            <div class="gamified-only" style="background: linear-gradient(135deg, #fff8e1, #ffecb3); border-radius: 16px; padding: 18px; margin-bottom: 20px; border: 1px solid #ffe082;">
                <div style="display: flex; align-items: center; justify-content: space-between;">
                    <div style="display: flex; align-items: center; gap: 12px;">
                        <div style="font-size: 32px;">üî•</div>
                        <div>
                            <div style="font-family: 'Playfair Display', serif; font-size: 22px; font-weight: 600; color: #e65100;">7 Day Streak</div>
                            <div style="font-size: 12px; color: #8d6e63;">Don't break it!</div>
                        </div>
                    </div>
                    <div style="text-align: right;">
                        <div style="font-size: 20px; letter-spacing: 2px;">‚òï‚òï‚òï‚òï</div>
                        <div style="font-size: 10px; color: #8d6e63; margin-top: 2px;">4 stamps</div>
                    </div>
                </div>
                <div style="margin-top: 14px; padding-top: 12px; border-top: 1px dashed #ffe082; font-family: 'Caveat', cursive; font-size: 15px; color: #6d4c41; text-align: center;">
                    üî¨ Does this motivate you, or create pressure?
                </div>
            </div>
            
            <!-- Main CTA Button -->
            <div style="margin-bottom: 20px;">
                <button onclick="goTo('emotion')" style="width: 100%; padding: 18px 24px; background: linear-gradient(135deg, #5d4037, #3e2723); color: #fff; border: none; border-radius: 16px; font-family: 'Playfair Display', serif; font-size: 18px; cursor: pointer; position: relative; box-shadow: 0 4px 15px rgba(45, 27, 19, 0.3);">
                    Start Brewing ‚òï
                </button>
                <div style="text-align: center; margin-top: 8px; font-family: 'Caveat', cursive; font-size: 15px; color: #8d6e63;">~2 minutes of intentional pause</div>
            </div>
            
            <!-- Quick Access Grid -->
            <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-bottom: 24px;">
                <button onclick="goTo('calendar')" style="padding: 16px 8px; background: #fff; border: 1px solid #e8dcc7; border-radius: 14px; cursor: pointer; text-align: center;">
                    <div style="font-size: 24px; margin-bottom: 6px;">üìÖ</div>
                    <div style="font-family: 'Caveat', cursive; font-size: 15px; color: #5d4037;">Calendar</div>
                </button>
                <button onclick="goTo('journal')" style="padding: 16px 8px; background: #fff; border: 1px solid #e8dcc7; border-radius: 14px; cursor: pointer; text-align: center;">
                    <div style="font-size: 24px; margin-bottom: 6px;">üìñ</div>
                    <div style="font-family: 'Caveat', cursive; font-size: 15px; color: #5d4037;">Journal</div>
                </button>
                <button onclick="goTo('stats')" style="padding: 16px 8px; background: #fff; border: 1px solid #e8dcc7; border-radius: 14px; cursor: pointer; text-align: center;">
                    <div style="font-size: 24px; margin-bottom: 6px;">üî¨</div>
                    <div style="font-family: 'Caveat', cursive; font-size: 15px; color: #5d4037;">Observe</div>
                </button>
            </div>
            
            <!-- About Section - Coffee Menu Style -->
            <div style="background: #3e2723; border-radius: 16px; padding: 24px; text-align: center;">
                <div style="font-family: 'Caveat', cursive; font-size: 20px; color: #d7ccc8; margin-bottom: 12px;">What is Breath Caf√©?</div>
                <p style="font-family: 'Playfair Display', serif; font-size: 14px; color: #a1887f; line-height: 1.8; margin-bottom: 16px;">
                    A <span style="color: #efebe9;">design research platform</span> exploring how digital interfaces shape our sense of time.
                    <br><br>
                    Part wellness app, part experiment.
                </p>
                <div style="display: flex; gap: 8px; justify-content: center; flex-wrap: wrap;">
                    <span style="padding: 6px 12px; background: rgba(255,255,255,0.1); border-radius: 20px; font-family: 'Caveat', cursive; font-size: 14px; color: #bcaaa4;">#SlowDesign</span>
                    <span style="padding: 6px 12px; background: rgba(255,255,255,0.1); border-radius: 20px; font-family: 'Caveat', cursive; font-size: 14px; color: #bcaaa4;">#MFAThesis</span>
                    <span style="padding: 6px 12px; background: rgba(255,255,255,0.1); border-radius: 20px; font-family: 'Caveat', cursive; font-size: 14px; color: #bcaaa4;">#BreathWork</span>
                </div>
            </div>
            
            <!-- Philosophy Section - Design Sovereignty -->
            <div style="background: linear-gradient(135deg, #1a1a2e, #16213e); border-radius: 20px; padding: 32px; margin-top: 20px; position: relative; overflow: hidden;">
                <!-- Decorative elements -->
                <div style="position: absolute; top: 20px; right: 20px; font-size: 60px; opacity: 0.05;">ü´Å</div>
                
                <div style="position: relative; z-index: 1;">
                    <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 20px;">
                        <div style="width: 8px; height: 8px; background: #74b9ff; border-radius: 50%;"></div>
                        <span style="font-size: 11px; color: #74b9ff; font-weight: 600; letter-spacing: 2px;">DESIGN PHILOSOPHY</span>
                    </div>
                    
                    <h3 style="font-family: 'Playfair Display', serif; font-size: 28px; color: #fff; font-weight: 400; margin-bottom: 16px; line-height: 1.4;">
                        Design Sovereignty
                    </h3>
                    
                    <p style="font-size: 15px; color: #a0aec0; line-height: 1.8; margin-bottom: 24px;">
                        The idea that we can reclaim awareness and choice within systems designed to optimize us.
                    </p>
                    
                    <div style="background: rgba(255,255,255,0.05); border-radius: 12px; padding: 20px; margin-bottom: 24px;">
                        <div style="font-family: 'Playfair Display', serif; font-size: 18px; color: #fff; font-style: italic; text-align: center; line-height: 1.6;">
                            "Most apps optimize your time.<br>
                            <span style="color: #74b9ff;">This one lets you reclaim it.</span>"
                        </div>
                    </div>
                    
                    <div style="display: flex; flex-direction: column; gap: 12px;">
                        <div style="display: flex; align-items: flex-start; gap: 12px;">
                            <span style="color: #74b9ff; font-size: 18px;">‚Üí</span>
                            <span style="color: #cbd5e0; font-size: 14px; line-height: 1.6;">What if frictionless isn't always good?</span>
                        </div>
                        <div style="display: flex; align-items: flex-start; gap: 12px;">
                            <span style="color: #74b9ff; font-size: 18px;">‚Üí</span>
                            <span style="color: #cbd5e0; font-size: 14px; line-height: 1.6;">What if slowness is a form of resistance?</span>
                        </div>
                        <div style="display: flex; align-items: flex-start; gap: 12px;">
                            <span style="color: #74b9ff; font-size: 18px;">‚Üí</span>
                            <span style="color: #cbd5e0; font-size: 14px; line-height: 1.6;">What if breathing could be a protest?</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Designer Credit Section -->
            <div style="background: #fffdf8; border-radius: 16px; padding: 24px; margin-top: 20px; border: 1px solid #e8dcc7;">
                <div style="display: flex; align-items: center; gap: 16px;">
                    <div style="width: 64px; height: 64px; background: linear-gradient(135deg, var(--coffee-medium), var(--coffee-dark)); border-radius: 50%; display: flex; align-items: center; justify-content: center; flex-shrink: 0;">
                        <span style="font-size: 28px;">üë©‚Äçüé®</span>
                    </div>
                    <div style="flex: 1;">
                        <div style="font-family: 'Caveat', cursive; font-size: 22px; color: var(--coffee-dark); margin-bottom: 4px;">Designed by Chloe Choi</div>
                        <div style="font-size: 13px; color: var(--text-light); line-height: 1.5;">
                            MFA Design & Technology<br>
                            Pratt Institute, 2024
                        </div>
                    </div>
                </div>
                <div style="margin-top: 16px; padding-top: 16px; border-top: 1px solid #e8dcc7;">
                    <p style="font-family: 'Caveat', cursive; font-size: 16px; color: var(--coffee-medium); line-height: 1.6; text-align: center;">
                        "I still don't have all the answers. But I've learned that hesitation isn't weakness‚Äîit's the first step toward noticing. And noticing is where sovereignty begins."
                    </p>
                </div>
            </div>
            
            <!-- Footer -->
            <div style="text-align: center; padding: 32px 0 16px; margin-top: 20px;">
                <div style="font-size: 24px; margin-bottom: 8px;">‚òï</div>
                <div style="font-family: 'Caveat', cursive; font-size: 18px; color: var(--coffee-medium); margin-bottom: 8px;">Breath Caf√©</div>
                <div style="font-size: 12px; color: var(--text-light); line-height: 1.6;">
                    A thesis project exploring design sovereignty<br>
                    and mindful resistance in digital spaces.
                </div>
                <div style="font-size: 11px; color: #bcaaa4; margin-top: 16px;">
                    ¬© 2024 Chloe Choi ¬∑ Pratt Institute MFA Thesis
                </div>
            </div>
            
        </div>

        <!-- PAGE 2: EMOTION -->
        <div id="emotion" class="page">
            <div class="drip-line"><div class="line"></div></div>
            <div class="text-center">
                <h2 class="page-title">How are you feeling?</h2>
                <p class="page-subtitle">Let your emotions guide your brew</p>
            </div>
            <div class="emotion-grid">
                <div class="emotion-card" onclick="selectEmotion('joy', 'üòä', 'Joy')">
                    <span class="emotion-icon">üòä</span>
                    <div class="emotion-name">Joy</div>
                    <div class="emotion-desc">Happy & energetic</div>
                </div>
                <div class="emotion-card" onclick="selectEmotion('calm', 'üòå', 'Calm')">
                    <span class="emotion-icon">üòå</span>
                    <div class="emotion-name">Calm</div>
                    <div class="emotion-desc">Peaceful & content</div>
                </div>
                <div class="emotion-card" onclick="selectEmotion('angry', 'üò§', 'Angry')">
                    <span class="emotion-icon">üò§</span>
                    <div class="emotion-name">Angry</div>
                    <div class="emotion-desc">Frustrated & tense</div>
                </div>
                <div class="emotion-card" onclick="selectEmotion('sad', 'üò¢', 'Sad')">
                    <span class="emotion-icon">üò¢</span>
                    <div class="emotion-name">Sad</div>
                    <div class="emotion-desc">Feeling down</div>
                </div>
                <div class="emotion-card" onclick="selectEmotion('anxious', 'üò∞', 'Anxious')">
                    <span class="emotion-icon">üò∞</span>
                    <div class="emotion-name">Anxious</div>
                    <div class="emotion-desc">Worried & uneasy</div>
                </div>
                <div class="emotion-card" onclick="selectEmotion('tired', 'üò¥', 'Tired')">
                    <span class="emotion-icon">üò¥</span>
                    <div class="emotion-name">Tired</div>
                    <div class="emotion-desc">Exhausted</div>
                </div>
            </div>
        </div>

        <!-- PAGE 3: RECOMMENDATION -->
        <div id="recommendation" class="page">
            <div class="drip-line"><div class="line"></div></div>
            
            <!-- Experiment Framing -->
            <div class="experiment-frame" id="experimentFrame">
                <div class="experiment-badge">üî¨ EXPERIMENT</div>
                <div class="experiment-title">Reconstructing Speed</div>
                <div class="experiment-desc">
                    You are about to experience an intentional pause.<br>
                    For the next <strong id="expDuration">2 min 16 sec</strong>, the interface will guide your rhythm.
                </div>
                <div class="experiment-observe">
                    <div class="observe-title">üëÅÔ∏è Observe:</div>
                    <ul class="observe-list">
                        <li>Does time feel different when you control the pace?</li>
                        <li>Are you following the interface, or is it following you?</li>
                    </ul>
                </div>
            </div>
            
            <div class="text-center">
                <p class="page-subtitle" style="margin-bottom: 12px;">
                    You're feeling <span id="currEmotion" style="font-weight: 600;"></span> <span id="currIcon"></span>
                </p>
                <h2 class="page-title">We recommend...</h2>
            </div>
            <div class="recommendation-card">
                <div class="coffee-icon-large" id="recIcon">ü´ñ</div>
                <h3 class="coffee-name" id="recName">Mocha</h3>
                <p class="coffee-tagline" id="recTag">"Warm & Comforting"</p>
                <div class="breath-pattern">
                    <div class="breath-bar">
                        <div class="breath-visual" style="height: 50px;"></div>
                        <div class="breath-label">Inhale ‚Üë</div>
                        <div class="breath-time" id="inhaleT">5s</div>
                    </div>
                    <div class="breath-bar">
                        <div class="breath-visual" style="height: 40px; background: linear-gradient(to top, #ffb74d, #ffd54f);"></div>
                        <div class="breath-label">Hold ‚Äî</div>
                        <div class="breath-time" id="holdT">4s</div>
                    </div>
                    <div class="breath-bar">
                        <div class="breath-visual" style="height: 60px;"></div>
                        <div class="breath-label">Exhale ‚Üì</div>
                        <div class="breath-time" id="exhaleT">7s</div>
                    </div>
                </div>
                <div class="why-box">
                    <div class="why-title">‚òï Why this breathing?</div>
                    <div class="step"><span class="step-name" id="s1n">Grinding (5s)</span><br><span id="s1d">Prepare slowly, breathe in deeply</span></div>
                    <div class="step"><span class="step-name" id="s2n">Heating (4s)</span><br><span id="s2d">Let warmth settle</span></div>
                    <div class="step"><span class="step-name" id="s3n">Brewing (7s)</span><br><span id="s3d">Release slowly like comfort</span></div>
                </div>
                <button class="btn btn-primary" style="margin-top: 16px;" onclick="startBrew()">Begin Experiment ‚òï</button>
            </div>
            <div class="alternatives">
                <div class="alternatives-title">Or choose by intention:</div>
                
                <!-- 3 Categories Only - ZEN Concept -->
                <div style="display: flex; flex-direction: column; gap: 12px;">
                    
                    <!-- Breathe Category -->
                    <div style="background: linear-gradient(135deg, #e8f5e9, #c8e6c9); border-radius: 16px; padding: 16px;">
                        <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 12px;">
                            <span style="font-size: 20px;">üß†</span>
                            <span style="font-weight: 600; color: #2e7d32;">Focus</span>
                            <span style="font-size: 11px; color: #66bb6a; margin-left: auto;">Quick energy</span>
                        </div>
                        <div style="display: flex; gap: 8px;">
                            <div class="alt-card" onclick="changeRec('americano')" style="flex: 1; background: #fff; border-radius: 12px; padding: 12px; text-align: center; cursor: pointer;">
                                <div style="font-size: 24px;">‚òï</div>
                                <div style="font-size: 12px; font-weight: 500;">Americano</div>
                                <div style="font-size: 10px; color: #888;">4-2-4</div>
                            </div>
                            <div class="alt-card" onclick="changeRec('espresso')" style="flex: 1; background: #fff; border-radius: 12px; padding: 12px; text-align: center; cursor: pointer;">
                                <div style="font-size: 24px;">‚ö°</div>
                                <div style="font-size: 12px; font-weight: 500;">Espresso</div>
                                <div style="font-size: 10px; color: #888;">3-2-3</div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Calm Category -->
                    <div style="background: linear-gradient(135deg, #e3f2fd, #bbdefb); border-radius: 16px; padding: 16px;">
                        <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 12px;">
                            <span style="font-size: 20px;">üòå</span>
                            <span style="font-weight: 600; color: #1565c0;">Calm</span>
                            <span style="font-size: 11px; color: #42a5f5; margin-left: auto;">Reduce stress</span>
                        </div>
                        <div style="display: flex; gap: 8px;">
                            <div class="alt-card" onclick="changeRec('latte')" style="flex: 1; background: #fff; border-radius: 12px; padding: 12px; text-align: center; cursor: pointer;">
                                <div style="font-size: 24px;">ü•õ</div>
                                <div style="font-size: 12px; font-weight: 500;">Latte</div>
                                <div style="font-size: 10px; color: #888;">5-3-6</div>
                            </div>
                            <div class="alt-card" onclick="changeRec('mocha')" style="flex: 1; background: #fff; border-radius: 12px; padding: 12px; text-align: center; cursor: pointer;">
                                <div style="font-size: 24px;">ü´ñ</div>
                                <div style="font-size: 12px; font-weight: 500;">Mocha</div>
                                <div style="font-size: 10px; color: #888;">5-4-7</div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Sleep Category -->
                    <div style="background: linear-gradient(135deg, #ede7f6, #d1c4e9); border-radius: 16px; padding: 16px;">
                        <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 12px;">
                            <span style="font-size: 20px;">üåô</span>
                            <span style="font-weight: 600; color: #5e35b1;">Sleep</span>
                            <span style="font-size: 11px; color: #7e57c2; margin-left: auto;">Deep relaxation</span>
                        </div>
                        <div style="display: flex; gap: 8px;">
                            <div class="alt-card" onclick="changeRec('coldbrew')" style="flex: 1; background: #fff; border-radius: 12px; padding: 12px; text-align: center; cursor: pointer;">
                                <div style="font-size: 24px;">üßä</div>
                                <div style="font-size: 12px; font-weight: 500;">Cold Brew</div>
                                <div style="font-size: 10px; color: #888;">6-3-6</div>
                            </div>
                            <div class="alt-card" onclick="changeRec('decaf')" style="flex: 1; background: #fff; border-radius: 12px; padding: 12px; text-align: center; cursor: pointer;">
                                <div style="font-size: 24px;">üçµ</div>
                                <div style="font-size: 12px; font-weight: 500;">Decaf</div>
                                <div style="font-size: 10px; color: #888;">6-5-8</div>
                            </div>
                        </div>
                    </div>
                    
                </div>
                
                <div style="text-align: center; margin-top: 16px; font-size: 12px; color: #8d6e63;">
                    üî¨ Fewer choices = clearer mind
                </div>
            </div>
        </div>

        <!-- PAGE 4: BREWING -->
        <div id="brewing" class="page">
            <div class="brewing-header">
                <button class="back-btn" onclick="confirmStop()">‚Üê</button>
                <div class="timer" id="brewTimer">00:00</div>
                <div style="width: 32px;"></div>
            </div>
            
            <!-- Remaining Time Badge -->
            <div style="text-align: center; margin-bottom: 12px;">
                <div style="display: inline-block; background: rgba(93, 64, 55, 0.1); padding: 6px 16px; border-radius: 20px;">
                    <span style="font-size: 12px; color: #8d6e63;">Remaining: </span>
                    <span style="font-size: 14px; font-weight: 600; color: #5d4037;" id="remainingTime">2:16</span>
                </div>
            </div>
            
            <!-- Cycle Counter -->
            <div style="text-align: center; margin-bottom: 16px;">
                <div style="font-size: 48px; font-weight: 700; color: var(--coffee-medium);" id="cycleCount">1</div>
                <div style="font-size: 14px; color: var(--text-light); font-weight: 600;">/ 3 Cycles</div>
                <div style="display: flex; justify-content: center; gap: 8px; margin-top: 8px;">
                    <div class="cycle-dot" id="dot1"></div>
                    <div class="cycle-dot" id="dot2"></div>
                    <div class="cycle-dot" id="dot3"></div>
                </div>
            </div>
            
            <!-- Pattern Preview Mini -->
            <div style="display: flex; justify-content: center; gap: 6px; margin-bottom: 20px;">
                <div id="patternIn" style="padding: 6px 12px; background: #e8dcc7; border-radius: 12px; font-size: 11px; color: #5d4037; transition: all 0.3s;">
                    ‚Üë 5s
                </div>
                <div id="patternHold" style="padding: 6px 12px; background: #f5f0e8; border-radius: 12px; font-size: 11px; color: #8d6e63; transition: all 0.3s;">
                    ‚Äî 4s
                </div>
                <div id="patternOut" style="padding: 6px 12px; background: #f5f0e8; border-radius: 12px; font-size: 11px; color: #8d6e63; transition: all 0.3s;">
                    ‚Üì 7s
                </div>
            </div>
            
            <div class="coffee-maker">
                <div class="filter"></div>
                <div class="drops">
                    <div class="drop"></div>
                    <div class="drop"></div>
                    <div class="drop"></div>
                </div>
                <div class="server">
                    <div class="coffee-level" id="coffeeLevel"></div>
                </div>
                <div class="steam">
                    <div class="steam-line"></div>
                    <div class="steam-line"></div>
                    <div class="steam-line"></div>
                </div>
            </div>
            
            <!-- Progress Ring -->
            <div style="position: relative; width: 180px; height: 180px; margin: 0 auto 24px;">
                <svg width="180" height="180" style="transform: rotate(-90deg);">
                    <circle cx="90" cy="90" r="80" fill="none" stroke="var(--cream)" stroke-width="12"></circle>
                    <circle id="progressCircle" cx="90" cy="90" r="80" fill="none" stroke="var(--coffee-medium)" stroke-width="12" 
                            stroke-dasharray="502.4" stroke-dashoffset="502.4" stroke-linecap="round"
                            style="transition: stroke-dashoffset 1s ease;"></circle>
                </svg>
                <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); text-align: center;">
                    <div style="font-size: 32px;" id="phaseEmoji">ü´ò</div>
                    <div style="font-size: 13px; color: var(--text-light); margin-top: 4px;" id="phaseProgress">0%</div>
                </div>
            </div>
            
            <div class="phase-box">
                <div class="phase-title" id="phaseTitle">GRINDING BEANS</div>
                <div class="phase-action" id="phaseAction">Inhale ‚Üë</div>
                <div class="phase-desc" id="phaseDesc">"Prepare slowly, breathe in deeply"</div>
                <div class="phase-timer" id="phaseTime">5s left</div>
            </div>
            <button class="hold-btn" id="holdBtn" onmousedown="hold()" onmouseup="unhold()" ontouchstart="hold()" ontouchend="unhold()">
                <span id="btnText">Hold to Brew</span>
                <div class="hold-progress" id="holdProgress"></div>
            </button>
        </div>

        <!-- PAGE 5: REFLECTION -->
        <div id="reflection" class="page">
            <div class="drip-line"><div class="line"></div></div>
            <div class="text-center">
                <h2 class="page-title">Your <span id="refCoffee">Mocha</span> is ready!</h2>
                <p class="page-subtitle">Take a moment to reflect</p>
            </div>
            <div style="text-align: center; margin: 32px 0;">
                <div style="font-size: 80px;">‚òï</div>
            </div>
            <div class="emotion-compare">
                <div class="emotion-flow">
                    <div class="emotion-state">
                        <div class="emotion-label">Before</div>
                        <div class="emotion-display" id="beforeIcon">üò¢</div>
                        <div class="emotion-text" id="beforeText">Sad</div>
                    </div>
                    <div class="emotion-arrow">‚Üí</div>
                    <div class="emotion-state">
                        <div class="emotion-label">Now</div>
                        <div class="emotion-display">?</div>
                        <div class="emotion-text">How do you feel?</div>
                    </div>
                </div>
                <div class="emotion-selector">
                    <div class="emotion-option" onclick="selectAfter('joy', 'üòä', 'Joy')">
                        <div class="emotion-option-icon">üòä</div>
                        <div class="emotion-option-name">Joy</div>
                    </div>
                    <div class="emotion-option" onclick="selectAfter('calm', 'üòå', 'Calm')">
                        <div class="emotion-option-icon">üòå</div>
                        <div class="emotion-option-name">Calm</div>
                    </div>
                    <div class="emotion-option" onclick="selectAfter('angry', 'üò§', 'Angry')">
                        <div class="emotion-option-icon">üò§</div>
                        <div class="emotion-option-name">Angry</div>
                    </div>
                    <div class="emotion-option" onclick="selectAfter('sad', 'üò¢', 'Sad')">
                        <div class="emotion-option-icon">üò¢</div>
                        <div class="emotion-option-name">Sad</div>
                    </div>
                    <div class="emotion-option" onclick="selectAfter('anxious', 'üò∞', 'Anxious')">
                        <div class="emotion-option-icon">üò∞</div>
                        <div class="emotion-option-name">Anxious</div>
                    </div>
                    <div class="emotion-option" onclick="selectAfter('tired', 'üò¥', 'Tired')">
                        <div class="emotion-option-icon">üò¥</div>
                        <div class="emotion-option-name">Tired</div>
                    </div>
                </div>
            </div>
            
            <!-- Critical Reflection Questions -->
            <div class="research-reflection">
                <div class="research-reflection-header">
                    <span>üî¨</span> Research Reflection
                </div>
                
                <div class="research-question">
                    <div class="research-q-text">Did this 2 minutes feel different from a normal 2 minutes?</div>
                    <div class="research-q-options">
                        <label class="research-option" onclick="selectResearchAnswer('time', 'longer')">
                            <input type="radio" name="timePerception" value="longer">
                            <span>Much longer</span>
                        </label>
                        <label class="research-option" onclick="selectResearchAnswer('time', 'same')">
                            <input type="radio" name="timePerception" value="same">
                            <span>About the same</span>
                        </label>
                        <label class="research-option" onclick="selectResearchAnswer('time', 'shorter')">
                            <input type="radio" name="timePerception" value="shorter">
                            <span>Shorter</span>
                        </label>
                    </div>
                </div>
                
                <div class="research-question">
                    <div class="research-q-text">Who controlled the pace of this experience?</div>
                    <div class="research-q-options">
                        <label class="research-option" onclick="selectResearchAnswer('control', 'interface')">
                            <input type="radio" name="paceControl" value="interface">
                            <span>The interface</span>
                        </label>
                        <label class="research-option" onclick="selectResearchAnswer('control', 'me')">
                            <input type="radio" name="paceControl" value="me">
                            <span>I did</span>
                        </label>
                        <label class="research-option" onclick="selectResearchAnswer('control', 'together')">
                            <input type="radio" name="paceControl" value="together">
                            <span>We did together</span>
                        </label>
                    </div>
                </div>
                
                <div class="research-question gamified-only" id="gamifiedQuestion">
                    <div class="research-q-text">Will the streak/stamp influence your next session?</div>
                    <div class="research-q-options">
                        <label class="research-option" onclick="selectResearchAnswer('gamification', 'yes')">
                            <input type="radio" name="gamificationInfluence" value="yes">
                            <span>Yes, it motivates me</span>
                        </label>
                        <label class="research-option" onclick="selectResearchAnswer('gamification', 'no')">
                            <input type="radio" name="gamificationInfluence" value="no">
                            <span>No, not really</span>
                        </label>
                        <label class="research-option" onclick="selectResearchAnswer('gamification', 'pressure')">
                            <input type="radio" name="gamificationInfluence" value="pressure">
                            <span>It feels like pressure</span>
                        </label>
                    </div>
                </div>
            </div>
            
            <div class="note-section">
                <div class="note-label">‚úçÔ∏è Today's Sip Note</div>
                <textarea class="note-textarea" id="sipNote" placeholder="How was your experience? (100 characters)" maxlength="100" oninput="updateCount()"></textarea>
                <div class="char-count" id="charCount">0/100</div>
            </div>
            <div class="rating">
                <div class="rating-label">Rate your brewing:</div>
                <div class="stars" id="stars">
                    <span class="star" onclick="rate(1)">‚òÜ</span>
                    <span class="star" onclick="rate(2)">‚òÜ</span>
                    <span class="star" onclick="rate(3)">‚òÜ</span>
                    <span class="star" onclick="rate(4)">‚òÜ</span>
                    <span class="star" onclick="rate(5)">‚òÜ</span>
                </div>
            </div>
            <button class="btn btn-primary" onclick="saveRef()">Save & Continue</button>
        </div>

        <!-- PAGE 6: STAMPS -->
        <div id="stamps" class="page">
            <div class="drip-line"><div class="line"></div></div>
            <div class="text-center">
                <h2 class="page-title">‚òï Your Mindful Collection</h2>
                <p class="page-subtitle">Every breath is a step toward inner peace</p>
            </div>
            
            <!-- Motivational Quote Card -->
            <div class="card" style="background: linear-gradient(135deg, #f5f0e8, #e8dcc7); border: none; text-align: center; margin: 24px 0;">
                <div style="font-size: 32px; margin-bottom: 12px;">üßò</div>
                <div style="font-family: 'Caveat', cursive; font-size: 20px; color: var(--coffee-dark); line-height: 1.5;" id="mindfulQuote">
                    "Breathing in, I calm my body. Breathing out, I smile."
                </div>
                <div style="font-size: 12px; color: var(--text-light); margin-top: 8px;">‚Äî Thich Nhat Hanh</div>
            </div>

            <div class="stamps-collection">
                <!-- Progress Section -->
                <div class="progress-header">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                        <div class="progress-text" id="stampProg">10/10 stamps</div>
                        <div style="font-size: 13px; color: var(--text-light);" id="stampReward">üéÅ Reward unlocked!</div>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="stampBar" style="width: 100%;"></div>
                    </div>
                </div>

                <!-- Stamp Grid with Mindful Messages -->
                <div class="stamp-grid" id="stampGrid"></div>
                
                <!-- Coffee Collection - NEW -->
                <div class="card" style="margin-top: 24px; background: linear-gradient(135deg, #3e2723, #5d4037); color: white;">
                    <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 20px;">
                        <span style="font-size: 24px;">‚òï</span>
                        <div>
                            <div style="font-weight: 600; font-size: 16px;">Your Coffee Collection</div>
                            <div style="font-size: 12px; color: #d7ccc8;">Brews you've mastered</div>
                        </div>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: repeat(5, 1fr); gap: 12px;">
                        <!-- Mocha - Unlocked -->
                        <div style="text-align: center;">
                            <div style="width: 48px; height: 48px; background: rgba(255,255,255,0.15); border-radius: 12px; display: flex; align-items: center; justify-content: center; margin: 0 auto 6px; border: 2px solid #a1887f;">
                                <span style="font-size: 24px;">ü´ñ</span>
                            </div>
                            <div style="font-size: 11px; color: #d7ccc8;">Mocha</div>
                            <div style="font-size: 10px; color: #a1887f;">5x</div>
                        </div>
                        
                        <!-- Americano - Unlocked -->
                        <div style="text-align: center;">
                            <div style="width: 48px; height: 48px; background: rgba(255,255,255,0.15); border-radius: 12px; display: flex; align-items: center; justify-content: center; margin: 0 auto 6px; border: 2px solid #a1887f;">
                                <span style="font-size: 24px;">‚òï</span>
                            </div>
                            <div style="font-size: 11px; color: #d7ccc8;">Americano</div>
                            <div style="font-size: 10px; color: #a1887f;">3x</div>
                        </div>
                        
                        <!-- Latte - Unlocked -->
                        <div style="text-align: center;">
                            <div style="width: 48px; height: 48px; background: rgba(255,255,255,0.15); border-radius: 12px; display: flex; align-items: center; justify-content: center; margin: 0 auto 6px; border: 2px solid #a1887f;">
                                <span style="font-size: 24px;">ü•õ</span>
                            </div>
                            <div style="font-size: 11px; color: #d7ccc8;">Latte</div>
                            <div style="font-size: 10px; color: #a1887f;">4x</div>
                        </div>
                        
                        <!-- Cold Brew - Unlocked -->
                        <div style="text-align: center;">
                            <div style="width: 48px; height: 48px; background: rgba(255,255,255,0.15); border-radius: 12px; display: flex; align-items: center; justify-content: center; margin: 0 auto 6px; border: 2px solid #a1887f;">
                                <span style="font-size: 24px;">üßä</span>
                            </div>
                            <div style="font-size: 11px; color: #d7ccc8;">Cold Brew</div>
                            <div style="font-size: 10px; color: #a1887f;">1x</div>
                        </div>
                        
                        <!-- Caramel - Unlocked -->
                        <div style="text-align: center;">
                            <div style="width: 48px; height: 48px; background: rgba(255,255,255,0.15); border-radius: 12px; display: flex; align-items: center; justify-content: center; margin: 0 auto 6px; border: 2px solid #a1887f;">
                                <span style="font-size: 24px;">üçØ</span>
                            </div>
                            <div style="font-size: 11px; color: #d7ccc8;">Caramel</div>
                            <div style="font-size: 10px; color: #a1887f;">1x</div>
                        </div>
                    </div>
                    
                    <div style="margin-top: 16px; padding-top: 16px; border-top: 1px solid rgba(255,255,255,0.1); text-align: center;">
                        <div style="font-family: 'Caveat', cursive; font-size: 15px; color: #bcaaa4;">
                            üéâ All 5 brews collected! You're a true barista.
                        </div>
                    </div>
                </div>
                
                <!-- Current Streak Card -->
                <div class="card gamified-only" style="margin-top: 16px; display: flex; align-items: center; gap: 16px;">
                    <div style="font-size: 48px;">üî•</div>
                    <div style="flex: 1;">
                        <div style="font-weight: 700; font-size: 18px;" id="stampStreak">7 Day Streak!</div>
                        <div style="font-size: 13px; color: var(--text-light);">Consistency builds lasting habits</div>
                    </div>
                </div>

                <!-- Mindfulness Benefits Card -->
                <div class="card" style="margin-top: 16px;">
                    <div style="font-weight: 600; margin-bottom: 16px; display: flex; align-items: center; gap: 8px;">
                        üåü Your Mindfulness Journey
                    </div>
                    <div class="mindful-stats">
                        <div class="mindful-stat-item">
                            <div class="mindful-stat-icon">ü´Å</div>
                            <div class="mindful-stat-info">
                                <div class="mindful-stat-value" id="totalBreaths">384</div>
                                <div class="mindful-stat-label">Mindful Breaths</div>
                            </div>
                        </div>
                        <div class="mindful-stat-item">
                            <div class="mindful-stat-icon">‚è±Ô∏è</div>
                            <div class="mindful-stat-info">
                                <div class="mindful-stat-value" id="totalMinutes">48</div>
                                <div class="mindful-stat-label">Minutes of Calm</div>
                            </div>
                        </div>
                        <div class="mindful-stat-item">
                            <div class="mindful-stat-icon">üòå</div>
                            <div class="mindful-stat-info">
                                <div class="mindful-stat-value" id="moodImprovePercent">87%</div>
                                <div class="mindful-stat-label">Mood Improved</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Achievements Section -->
                <div class="card gamified-only" style="margin-top: 16px;">
                    <div style="font-weight: 600; margin-bottom: 16px; display: flex; align-items: center; gap: 8px;">
                        üèÜ Achievements
                    </div>
                    <div class="achievements-grid">
                        <div class="achievement-item unlocked" id="achFirst">
                            <div class="achievement-icon">‚òï</div>
                            <div class="achievement-name">First Brew</div>
                        </div>
                        <div class="achievement-item unlocked" id="achWeek">
                            <div class="achievement-icon">üî•</div>
                            <div class="achievement-name">7 Day Streak</div>
                        </div>
                        <div class="achievement-item" id="achMaster">
                            <div class="achievement-icon">ü´ñ</div>
                            <div class="achievement-name">Mocha Master</div>
                        </div>
                        <div class="achievement-item" id="achZen">
                            <div class="achievement-icon">üßò</div>
                            <div class="achievement-name">Zen Mode</div>
                        </div>
                    </div>
                </div>
                
                <!-- History Section -->
                <button class="history-toggle" onclick="toggleHist()" style="margin-top: 24px;">
                    <span>‚ñº View Brewing History</span>
                    <span id="histCount">(4 entries)</span>
                </button>
                <div class="history-list" id="histList"></div>
                
                <!-- Call to Action -->
                <div style="text-align: center; margin-top: 32px;">
                    <p style="font-family: 'Caveat', cursive; font-size: 18px; color: var(--text-light); margin-bottom: 16px;">
                        Ready for your next moment of peace?
                    </p>
                    <button class="btn btn-primary" onclick="goTo('emotion')">
                        Start Mindful Brewing ‚òï
                    </button>
                </div>
            </div>
        </div>

        <!-- PAGE 7: JOURNAL -->
        <div id="journal" class="page">
            <div class="drip-line"><div class="line"></div></div>
            <div class="text-center">
                <h2 class="page-title">üìñ My Coffee Journal</h2>
                <p class="page-subtitle">Your brewing journey</p>
            </div>
            <div class="journal-header">
                <button class="journal-tab active" onclick="switchTab('timeline')">Timeline</button>
                <button class="journal-tab" onclick="switchTab('calendar')">Calendar</button>
            </div>
            <div id="timelineView" class="timeline">
                <!-- Add New Entry -->
                <div class="card" style="margin-bottom: 24px;">
                    <div style="font-weight: 600; margin-bottom: 12px; display: flex; align-items: center; gap: 8px;">
                        ‚úçÔ∏è Add Today's Entry
                    </div>
                    <div style="font-size: 14px; color: var(--text-light); margin-bottom: 12px;">How are you feeling today?</div>
                    <textarea id="journalEntry" placeholder="Write about your day, feelings, or thoughts... (300 characters)" 
                              maxlength="300" 
                              style="width: 100%; min-height: 100px; padding: 12px; border: 2px solid var(--border); border-radius: 12px; font-family: 'Inter', sans-serif; font-size: 14px; line-height: 1.5; resize: vertical; margin-bottom: 8px;"></textarea>
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <div style="font-size: 12px; color: var(--text-light);" id="journalCharCount">0/300</div>
                        <button class="btn btn-primary" style="width: auto; padding: 10px 24px; font-size: 14px;" onclick="saveJournalEntry()">Save Entry</button>
                    </div>
                </div>
                
                <div class="week-section">
                    <div class="week-title">‚ñº This Week</div>
                    <div id="thisWeekList"></div>
                </div>
                <div class="week-section">
                    <div class="week-title">‚ñº Last Week</div>
                    <div id="lastWeekList"></div>
                </div>
                <div class="insight-box">
                    <div class="insight-title">üí° Insights</div>
                    <div class="insight-text">Mocha helped 80% of the time when you felt sad. Your best brewing time is morning (7-9am).</div>
                </div>
            </div>
            <div id="calendarView" style="display: none;">
                <div class="calendar-header">
                    <div class="calendar-month" id="calendarMonth">November 2024</div>
                    <div class="calendar-nav">
                        <button onclick="changeMonth(-1)">‚Üê</button>
                        <button onclick="changeMonth(1)">‚Üí</button>
                    </div>
                </div>
                <div class="weekday-header">
                    <div class="weekday">S</div>
                    <div class="weekday">M</div>
                    <div class="weekday">T</div>
                    <div class="weekday">W</div>
                    <div class="weekday">T</div>
                    <div class="weekday">F</div>
                    <div class="weekday">S</div>
                </div>
                <div class="calendar-grid" id="calGrid"></div>
            </div>
        </div>

        <!-- PAGE 8: SELF-OBSERVATION (formerly Stats) -->
        <div id="stats" class="page">
            <div class="drip-line"><div class="line"></div></div>
            <div class="text-center">
                <h2 class="page-title">üî¨ Self-Observation</h2>
                <p class="page-subtitle">What patterns do you notice?</p>
            </div>

            <!-- Research Context -->
            <div class="observation-intro">
                <div class="observation-intro-icon">üëÅÔ∏è</div>
                <div class="observation-intro-text">
                    This is not a performance dashboard.<br>
                    It's a mirror for observing your own patterns.
                </div>
            </div>

            <!-- Core Observation: Intentional Pauses -->
            <div class="observation-card primary">
                <div class="observation-header">
                    <span class="observation-icon">‚è∏Ô∏è</span>
                    <span class="observation-title">Intentional Pauses</span>
                </div>
                <div class="observation-big-number">24</div>
                <div class="observation-label">moments you chose to stop</div>
                <div class="observation-insight">
                    In a world of infinite scroll, you paused 24 times.
                </div>
            </div>
            
            <!-- NEW: Weekly Minutes Graph - Coffee Drip Style -->
            <div class="observation-card" style="background: linear-gradient(180deg, #3e2723 0%, #5d4037 100%); color: #fff; overflow: hidden;">
                <div class="observation-header" style="border-bottom: 1px solid rgba(255,255,255,0.1); padding-bottom: 12px; margin-bottom: 16px;">
                    <span class="observation-icon" style="background: rgba(255,255,255,0.1);">‚òï</span>
                    <span class="observation-title" style="color: #fff;">Weekly Brew</span>
                    <span style="margin-left: auto; font-size: 11px; color: #bcaaa4;">This Week</span>
                </div>
                
                <!-- Coffee Dripper Visualization -->
                <div style="position: relative; padding: 0 10px;">
                    
                    <!-- Dripper Top (V60 shape) -->
                    <div style="position: relative; margin: 0 auto 8px; width: 100%;">
                        <svg viewBox="0 0 300 40" style="width: 100%; height: 30px;">
                            <path d="M 0 0 L 300 0 L 270 40 L 30 40 Z" fill="#4e342e" />
                            <path d="M 10 5 L 290 5 L 265 35 L 35 35 Z" fill="#6d4c41" />
                        </svg>
                    </div>
                    
                    <!-- Coffee Cups Row (7 days) -->
                    <div style="display: flex; justify-content: space-between; align-items: flex-end; height: 120px; padding: 0 4px; position: relative;">
                        
                        <!-- Drip Lines Background -->
                        <div style="position: absolute; top: -8px; left: 0; right: 0; display: flex; justify-content: space-between; padding: 0 18px;">
                            <div style="width: 2px; height: 12px; background: linear-gradient(to bottom, #8d6e63, transparent);"></div>
                            <div style="width: 2px; height: 18px; background: linear-gradient(to bottom, #8d6e63, transparent);"></div>
                            <div style="width: 2px; height: 10px; background: linear-gradient(to bottom, #8d6e63, transparent);"></div>
                            <div style="width: 2px; height: 15px; background: linear-gradient(to bottom, #8d6e63, transparent);"></div>
                            <div style="width: 2px; height: 20px; background: linear-gradient(to bottom, #a1887f, transparent);"></div>
                            <div style="width: 2px; height: 8px; background: linear-gradient(to bottom, #d7ccc8, transparent);"></div>
                            <div style="width: 2px; height: 5px; background: linear-gradient(to bottom, #d7ccc8, transparent); opacity: 0.5;"></div>
                        </div>
                        
                        <!-- Monday Cup -->
                        <div style="display: flex; flex-direction: column; align-items: center; gap: 6px;">
                            <div style="position: relative;">
                                <div style="width: 32px; height: 50px; background: #2d1b13; border-radius: 0 0 8px 8px; border: 2px solid #5d4037; border-top: none; position: relative; overflow: hidden;">
                                    <div style="position: absolute; bottom: 0; left: 0; right: 0; height: 65%; background: linear-gradient(to top, #8B4513, #A0522D); border-radius: 0 0 6px 6px;"></div>
                                </div>
                                <div style="position: absolute; top: 12px; right: -8px; width: 10px; height: 20px; border: 2px solid #5d4037; border-left: none; border-radius: 0 8px 8px 0;"></div>
                            </div>
                            <div style="font-size: 10px; color: #bcaaa4;">M</div>
                            <div style="font-size: 9px; color: #8d6e63;">8m</div>
                        </div>
                        
                        <!-- Tuesday Cup -->
                        <div style="display: flex; flex-direction: column; align-items: center; gap: 6px;">
                            <div style="position: relative;">
                                <div style="width: 32px; height: 50px; background: #2d1b13; border-radius: 0 0 8px 8px; border: 2px solid #5d4037; border-top: none; position: relative; overflow: hidden;">
                                    <div style="position: absolute; bottom: 0; left: 0; right: 0; height: 85%; background: linear-gradient(to top, #8B4513, #A0522D); border-radius: 0 0 6px 6px;"></div>
                                </div>
                                <div style="position: absolute; top: 12px; right: -8px; width: 10px; height: 20px; border: 2px solid #5d4037; border-left: none; border-radius: 0 8px 8px 0;"></div>
                            </div>
                            <div style="font-size: 10px; color: #bcaaa4;">T</div>
                            <div style="font-size: 9px; color: #8d6e63;">12m</div>
                        </div>
                        
                        <!-- Wednesday Cup -->
                        <div style="display: flex; flex-direction: column; align-items: center; gap: 6px;">
                            <div style="position: relative;">
                                <div style="width: 32px; height: 50px; background: #2d1b13; border-radius: 0 0 8px 8px; border: 2px solid #5d4037; border-top: none; position: relative; overflow: hidden;">
                                    <div style="position: absolute; bottom: 0; left: 0; right: 0; height: 50%; background: linear-gradient(to top, #8B4513, #A0522D); border-radius: 0 0 6px 6px;"></div>
                                </div>
                                <div style="position: absolute; top: 12px; right: -8px; width: 10px; height: 20px; border: 2px solid #5d4037; border-left: none; border-radius: 0 8px 8px 0;"></div>
                            </div>
                            <div style="font-size: 10px; color: #bcaaa4;">W</div>
                            <div style="font-size: 9px; color: #8d6e63;">6m</div>
                        </div>
                        
                        <!-- Thursday Cup -->
                        <div style="display: flex; flex-direction: column; align-items: center; gap: 6px;">
                            <div style="position: relative;">
                                <div style="width: 32px; height: 50px; background: #2d1b13; border-radius: 0 0 8px 8px; border: 2px solid #5d4037; border-top: none; position: relative; overflow: hidden;">
                                    <div style="position: absolute; bottom: 0; left: 0; right: 0; height: 75%; background: linear-gradient(to top, #8B4513, #A0522D); border-radius: 0 0 6px 6px;"></div>
                                </div>
                                <div style="position: absolute; top: 12px; right: -8px; width: 10px; height: 20px; border: 2px solid #5d4037; border-left: none; border-radius: 0 8px 8px 0;"></div>
                            </div>
                            <div style="font-size: 10px; color: #bcaaa4;">T</div>
                            <div style="font-size: 9px; color: #8d6e63;">10m</div>
                        </div>
                        
                        <!-- Friday Cup (Today - Highlighted) -->
                        <div style="display: flex; flex-direction: column; align-items: center; gap: 6px;">
                            <div style="position: relative;">
                                <div style="width: 36px; height: 54px; background: #1a0f0a; border-radius: 0 0 10px 10px; border: 3px solid #a1887f; border-top: none; position: relative; overflow: hidden; box-shadow: 0 0 12px rgba(255,200,150,0.3);">
                                    <div style="position: absolute; bottom: 0; left: 0; right: 0; height: 95%; background: linear-gradient(to top, #6F4E37, #8B4513); border-radius: 0 0 7px 7px;"></div>
                                    <!-- Steam animation -->
                                    <div style="position: absolute; top: -8px; left: 50%; transform: translateX(-50%); display: flex; gap: 3px;">
                                        <div style="width: 2px; height: 8px; background: rgba(255,255,255,0.4); border-radius: 2px; animation: steam 1.5s ease-in-out infinite;"></div>
                                        <div style="width: 2px; height: 10px; background: rgba(255,255,255,0.3); border-radius: 2px; animation: steam 1.5s ease-in-out infinite 0.2s;"></div>
                                        <div style="width: 2px; height: 6px; background: rgba(255,255,255,0.4); border-radius: 2px; animation: steam 1.5s ease-in-out infinite 0.4s;"></div>
                                    </div>
                                </div>
                                <div style="position: absolute; top: 14px; right: -9px; width: 11px; height: 22px; border: 3px solid #a1887f; border-left: none; border-radius: 0 10px 10px 0;"></div>
                            </div>
                            <div style="font-size: 11px; color: #fff; font-weight: 600;">F</div>
                            <div style="font-size: 10px; color: #a1887f; font-weight: 500;">14m ‚òï</div>
                        </div>
                        
                        <!-- Saturday Cup (Empty/Future) -->
                        <div style="display: flex; flex-direction: column; align-items: center; gap: 6px;">
                            <div style="position: relative; opacity: 0.5;">
                                <div style="width: 32px; height: 50px; background: transparent; border-radius: 0 0 8px 8px; border: 2px dashed #5d4037; border-top: none; position: relative;">
                                    <div style="position: absolute; bottom: 8px; left: 50%; transform: translateX(-50%); font-size: 16px; opacity: 0.5;">?</div>
                                </div>
                                <div style="position: absolute; top: 12px; right: -8px; width: 10px; height: 20px; border: 2px dashed #5d4037; border-left: none; border-radius: 0 8px 8px 0;"></div>
                            </div>
                            <div style="font-size: 10px; color: #6d4c41;">S</div>
                            <div style="font-size: 9px; color: #5d4037;">-</div>
                        </div>
                        
                        <!-- Sunday Cup (Empty/Future) -->
                        <div style="display: flex; flex-direction: column; align-items: center; gap: 6px;">
                            <div style="position: relative; opacity: 0.4;">
                                <div style="width: 32px; height: 50px; background: transparent; border-radius: 0 0 8px 8px; border: 2px dashed #5d4037; border-top: none; position: relative;">
                                    <div style="position: absolute; bottom: 8px; left: 50%; transform: translateX(-50%); font-size: 16px; opacity: 0.5;">?</div>
                                </div>
                                <div style="position: absolute; top: 12px; right: -8px; width: 10px; height: 20px; border: 2px dashed #5d4037; border-left: none; border-radius: 0 8px 8px 0;"></div>
                            </div>
                            <div style="font-size: 10px; color: #5d4037;">S</div>
                            <div style="font-size: 9px; color: #5d4037;">-</div>
                        </div>
                    </div>
                    
                </div>
                
                <!-- Summary Stats -->
                <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 20px; padding-top: 16px; border-top: 1px solid rgba(255,255,255,0.1);">
                    <div>
                        <div style="font-family: 'Playfair Display', serif; font-size: 32px; font-weight: 600;">48<span style="font-size: 16px; font-weight: 400;">min</span></div>
                        <div style="font-size: 12px; color: #bcaaa4;">total brewed</div>
                    </div>
                    <div style="text-align: center; padding: 0 16px; border-left: 1px solid rgba(255,255,255,0.1); border-right: 1px solid rgba(255,255,255,0.1);">
                        <div style="font-size: 24px; font-weight: 600;">5</div>
                        <div style="font-size: 11px; color: #bcaaa4;">cups filled</div>
                    </div>
                    <div style="text-align: right;">
                        <div style="font-size: 18px; color: #a5d6a7; font-weight: 500;">‚Üë 12%</div>
                        <div style="font-size: 11px; color: #bcaaa4;">vs last week</div>
                    </div>
                </div>
            </div>
            
            <!-- NEW: Mood Pattern - Coffee Temperature Style -->
            <div class="observation-card">
                <div class="observation-header">
                    <span class="observation-icon">üå°Ô∏è</span>
                    <span class="observation-title">Mood Temperature</span>
                    <span style="margin-left: auto; font-size: 11px; color: #8d6e63;">Your emotional brew</span>
                </div>
                <div class="observation-content">
                    
                    <!-- Temperature Scale -->
                    <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 20px; padding: 12px; background: linear-gradient(90deg, #ffccbc, #fff9c4, #c8e6c9); border-radius: 12px;">
                        <span style="font-size: 18px;">üî•</span>
                        <div style="flex: 1; text-align: center; font-size: 11px; color: #5d4037;">Hot (Stressed) ‚Üí Warm (Balanced) ‚Üí Cool (Calm)</div>
                        <span style="font-size: 18px;">‚ùÑÔ∏è</span>
                    </div>
                    
                    <!-- Daily Mood as Coffee Cups with Temperature -->
                    <div style="display: flex; justify-content: space-between; margin-bottom: 16px;">
                        
                        <!-- Monday - Hot/Anxious -->
                        <div style="text-align: center;">
                            <div style="width: 36px; height: 36px; background: linear-gradient(135deg, #ff8a65, #ffab91); border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 6px; box-shadow: 0 2px 8px rgba(255,138,101,0.4);">
                                <span style="font-size: 18px;">üò∞</span>
                            </div>
                            <div style="font-size: 10px; color: #8d6e63;">Mon</div>
                            <div style="font-size: 8px; color: #ff8a65;">Hot</div>
                        </div>
                        
                        <!-- Tuesday - Warm/Frustrated -->
                        <div style="text-align: center;">
                            <div style="width: 36px; height: 36px; background: linear-gradient(135deg, #ffb74d, #ffcc80); border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 6px; box-shadow: 0 2px 8px rgba(255,183,77,0.4);">
                                <span style="font-size: 18px;">üò§</span>
                            </div>
                            <div style="font-size: 10px; color: #8d6e63;">Tue</div>
                            <div style="font-size: 8px; color: #ffb74d;">Warm</div>
                        </div>
                        
                        <!-- Wednesday - Cool/Calm -->
                        <div style="text-align: center;">
                            <div style="width: 36px; height: 36px; background: linear-gradient(135deg, #81c784, #a5d6a7); border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 6px; box-shadow: 0 2px 8px rgba(129,199,132,0.4);">
                                <span style="font-size: 18px;">üòå</span>
                            </div>
                            <div style="font-size: 10px; color: #8d6e63;">Wed</div>
                            <div style="font-size: 8px; color: #81c784;">Cool</div>
                        </div>
                        
                        <!-- Thursday - Cool/Happy -->
                        <div style="text-align: center;">
                            <div style="width: 36px; height: 36px; background: linear-gradient(135deg, #4db6ac, #80cbc4); border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 6px; box-shadow: 0 2px 8px rgba(77,182,172,0.4);">
                                <span style="font-size: 18px;">üòä</span>
                            </div>
                            <div style="font-size: 10px; color: #8d6e63;">Thu</div>
                            <div style="font-size: 8px; color: #4db6ac;">Chill</div>
                        </div>
                        
                        <!-- Friday - Today (Highlighted) -->
                        <div style="text-align: center;">
                            <div style="width: 42px; height: 42px; background: linear-gradient(135deg, #81c784, #a5d6a7); border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 6px; box-shadow: 0 0 0 3px #fff, 0 0 0 5px #81c784, 0 4px 12px rgba(129,199,132,0.5);">
                                <span style="font-size: 20px;">üòå</span>
                            </div>
                            <div style="font-size: 11px; color: #5d4037; font-weight: 600;">Fri</div>
                            <div style="font-size: 9px; color: #81c784; font-weight: 500;">Now</div>
                        </div>
                        
                        <!-- Saturday - Future -->
                        <div style="text-align: center; opacity: 0.4;">
                            <div style="width: 36px; height: 36px; background: #e8dcc7; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 6px; border: 2px dashed #bcaaa4;">
                                <span style="font-size: 16px;">?</span>
                            </div>
                            <div style="font-size: 10px; color: #bcaaa4;">Sat</div>
                        </div>
                        
                        <!-- Sunday - Future -->
                        <div style="text-align: center; opacity: 0.3;">
                            <div style="width: 36px; height: 36px; background: #e8dcc7; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 6px; border: 2px dashed #bcaaa4;">
                                <span style="font-size: 16px;">?</span>
                            </div>
                            <div style="font-size: 10px; color: #bcaaa4;">Sun</div>
                        </div>
                    </div>
                    
                    <!-- Insight -->
                    <div style="background: linear-gradient(135deg, #e8f5e9, #f1f8e9); padding: 14px; border-radius: 12px; text-align: center;">
                        <div style="font-size: 13px; color: #2e7d32; line-height: 1.5;">
                            ‚òï <strong>Your brew is cooling down</strong><br>
                            <span style="font-size: 12px; color: #558b2f;">Started hot (anxious), now perfectly cool (calm)</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Time Perception Data -->
            <div class="observation-card">
                <div class="observation-header">
                    <span class="observation-icon">‚è±Ô∏è</span>
                    <span class="observation-title">Time Perception</span>
                </div>
                <div class="observation-content">
                    <div class="perception-stats">
                        <div class="perception-item">
                            <div class="perception-value">62%</div>
                            <div class="perception-label">felt time slow down</div>
                        </div>
                        <div class="perception-item">
                            <div class="perception-value">28%</div>
                            <div class="perception-label">felt normal pace</div>
                        </div>
                        <div class="perception-item">
                            <div class="perception-value">10%</div>
                            <div class="perception-label">felt time speed up</div>
                        </div>
                    </div>
                    <div class="observation-question">
                        üí≠ When does time feel different to you?
                    </div>
                </div>
            </div>

            <!-- Control Perception -->
            <div class="observation-card">
                <div class="observation-header">
                    <span class="observation-icon">üéÆ</span>
                    <span class="observation-title">Pace Control</span>
                </div>
                <div class="observation-content">
                    <div class="control-visual">
                        <div class="control-bar">
                            <div class="control-fill interface" style="width: 35%;"></div>
                            <div class="control-fill together" style="width: 45%;"></div>
                            <div class="control-fill me" style="width: 20%;"></div>
                        </div>
                        <div class="control-legend">
                            <span><span class="legend-dot interface"></span> Interface led (35%)</span>
                            <span><span class="legend-dot together"></span> Together (45%)</span>
                            <span><span class="legend-dot me"></span> I led (20%)</span>
                        </div>
                    </div>
                    <div class="observation-question">
                        üí≠ Who should control the pace of a digital experience?
                    </div>
                </div>
            </div>

            <!-- Emotion Transitions -->
            <div class="observation-card">
                <div class="observation-header">
                    <span class="observation-icon">üîÑ</span>
                    <span class="observation-title">Emotion Transitions</span>
                </div>
                <div class="observation-content">
                    <div class="transition-map">
                        <div class="transition-item">
                            <span class="transition-from">üò∞ Anxious</span>
                            <span class="transition-arrow">‚Üí</span>
                            <span class="transition-to">üòå Calm</span>
                            <span class="transition-count">8x</span>
                        </div>
                        <div class="transition-item">
                            <span class="transition-from">üò¢ Sad</span>
                            <span class="transition-arrow">‚Üí</span>
                            <span class="transition-to">üòå Calm</span>
                            <span class="transition-count">5x</span>
                        </div>
                        <div class="transition-item">
                            <span class="transition-from">üò§ Angry</span>
                            <span class="transition-arrow">‚Üí</span>
                            <span class="transition-to">üòå Calm</span>
                            <span class="transition-count">3x</span>
                        </div>
                        <div class="transition-item highlight">
                            <span class="transition-from">üò∞ Anxious</span>
                            <span class="transition-arrow">‚Üí</span>
                            <span class="transition-to">üò∞ Anxious</span>
                            <span class="transition-count">2x</span>
                        </div>
                    </div>
                    <div class="observation-insight">
                        Not every pause changes how you feel. That's data too.
                    </div>
                </div>
            </div>

            <!-- Gamification Reflection (only in Gamified mode) -->
            <div class="observation-card gamified-only" id="gamificationReflection">
                <div class="observation-header">
                    <span class="observation-icon">üé∞</span>
                    <span class="observation-title">Gamification Effect</span>
                </div>
                <div class="observation-content">
                    <div class="gamification-data">
                        <div class="gamification-item">
                            <div class="gamification-q">Did streaks motivate you?</div>
                            <div class="gamification-responses">
                                <div class="response-bar">
                                    <div class="response-fill yes" style="width: 55%;">Yes 55%</div>
                                </div>
                                <div class="response-bar">
                                    <div class="response-fill pressure" style="width: 30%;">Pressure 30%</div>
                                </div>
                                <div class="response-bar">
                                    <div class="response-fill no" style="width: 15%;">No 15%</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="observation-question">
                        üí≠ Is motivation from external rewards the same as intrinsic motivation?
                    </div>
                    <div class="mode-switch-hint">
                        Try <strong>Pure Mode</strong> to compare your experience without gamification.
                    </div>
                </div>
            </div>

            <!-- When Do You Pause? -->
            <div class="observation-card">
                <div class="observation-header">
                    <span class="observation-icon">üïê</span>
                    <span class="observation-title">When Do You Pause?</span>
                </div>
                <div class="observation-content">
                    <div class="time-pattern">
                        <div class="time-slot">
                            <div class="time-label">Morning</div>
                            <div class="time-bar"><div class="time-fill" style="width: 45%;"></div></div>
                            <div class="time-percent">45%</div>
                        </div>
                        <div class="time-slot">
                            <div class="time-label">Afternoon</div>
                            <div class="time-bar"><div class="time-fill" style="width: 30%;"></div></div>
                            <div class="time-percent">30%</div>
                        </div>
                        <div class="time-slot">
                            <div class="time-label">Evening</div>
                            <div class="time-bar"><div class="time-fill" style="width: 20%;"></div></div>
                            <div class="time-percent">20%</div>
                        </div>
                        <div class="time-slot">
                            <div class="time-label">Night</div>
                            <div class="time-bar"><div class="time-fill" style="width: 5%;"></div></div>
                            <div class="time-percent">5%</div>
                        </div>
                    </div>
                    <div class="observation-insight">
                        Your body has a rhythm. Does your technology respect it?
                    </div>
                </div>
            </div>

            <!-- Final Reflection -->
            <div class="observation-card final">
                <div class="observation-header">
                    <span class="observation-icon">ü™û</span>
                    <span class="observation-title">The Real Question</span>
                </div>
                <div class="final-question">
                    "Does the interface control me,<br>or can I define the speed<br>of my own experience?"
                </div>
                <div class="final-prompt">
                    What did you discover?
                </div>
                <textarea class="final-input" placeholder="Write your reflection..." maxlength="500"></textarea>
                <button class="btn btn-secondary" style="margin-top: 16px;" onclick="saveObservation()">Save Reflection</button>
            </div>
        </div>

        <!-- PAGE 9: WEEKLY -->
        <div id="weekly" class="page">
            <div class="drip-line"><div class="line"></div></div>
            <div class="text-center">
                <h2 class="page-title">üìä This Week's Flavors</h2>
                <p class="page-subtitle">Dec 4 - Dec 10, 2025</p>
            </div>
            <div class="weekly-container">
                <div class="card text-center">
                    <div style="font-size: 48px; margin-bottom: 8px;">‚òï</div>
                    <div style="font-size: 16px; font-weight: 600; margin-bottom: 16px;">7 brews completed</div>
                    <div style="display: flex; gap: 8px; justify-content: center; font-size: 13px;">
                        <div>ü´ñ 3x</div>
                        <div>‚òï 2x</div>
                        <div>ü•õ 2x</div>
                    </div>
                </div>
                <div class="card">
                    <div style="font-weight: 600; margin-bottom: 16px;">Your Emotional Journey:</div>
                    <div class="journey-line">
                        <div class="journey-day">
                            <div class="journey-icon">üò¢</div>
                            <div class="journey-label">Mon</div>
                        </div>
                        <div class="journey-day">
                            <div class="journey-icon">üò∞</div>
                            <div class="journey-label">Tue</div>
                        </div>
                        <div class="journey-day">
                            <div class="journey-icon">üòå</div>
                            <div class="journey-label">Wed</div>
                        </div>
                        <div class="journey-day">
                            <div class="journey-icon">üòä</div>
                            <div class="journey-label">Thu</div>
                        </div>
                        <div class="journey-day">
                            <div class="journey-icon">üòå</div>
                            <div class="journey-label">Fri</div>
                        </div>
                        <div class="journey-day">
                            <div class="journey-icon">üòä</div>
                            <div class="journey-label">Sat</div>
                        </div>
                        <div class="journey-day">
                            <div class="journey-icon">üòä</div>
                            <div class="journey-label">Sun</div>
                        </div>
                    </div>
                    <div class="insight-box" style="margin-top: 16px;">
                        <div class="insight-text">üìà Positive trend! You've been feeling better as the week progressed.</div>
                    </div>
                </div>
                <div class="reflection-box">
                    <div style="font-weight: 600; margin-bottom: 16px;">‚úçÔ∏è Week Reflection</div>
                    <div class="reflection-q">What was the best moment?</div>
                    <input type="text" class="reflection-input" placeholder="Type here...">
                    <div class="reflection-q">What helped you most?</div>
                    <input type="text" class="reflection-input" placeholder="Type here...">
                    <div class="reflection-q">Goal for next week?</div>
                    <input type="text" class="reflection-input" placeholder="Type here...">
                    <button class="btn btn-primary">Save My Week</button>
                </div>
            </div>
        </div>

        <!-- PAGE 14: CALENDAR -->
        <div id="calendar" class="page">
            <div class="drip-line"><div class="line"></div></div>
            
            <div class="calendar-page-header">
                <h2 class="page-title">üìÖ Breathing Calendar</h2>
            </div>
            
            <!-- Month Navigation -->
            <div class="card" style="margin-bottom: 20px;">
                <div class="calendar-month-nav">
                    <button onclick="changeCalendarMonth(-1)">‚Üê</button>
                    <div class="calendar-month-title" id="calendarPageMonth">December 2024</div>
                    <button onclick="changeCalendarMonth(1)">‚Üí</button>
                </div>
            </div>
            
            <!-- Calendar Grid -->
            <div class="card">
                <div class="calendar-weekdays">
                    <div class="calendar-weekday">Sun</div>
                    <div class="calendar-weekday">Mon</div>
                    <div class="calendar-weekday">Tue</div>
                    <div class="calendar-weekday">Wed</div>
                    <div class="calendar-weekday">Thu</div>
                    <div class="calendar-weekday">Fri</div>
                    <div class="calendar-weekday">Sat</div>
                </div>
                <div class="calendar-days" id="calendarPageGrid">
                    <!-- Generated by JS -->
                </div>
            </div>
            
            <!-- Monthly Stats -->
            <div class="calendar-stats-row">
                <div class="calendar-stat-card">
                    <div class="calendar-stat-icon">‚òï</div>
                    <div class="calendar-stat-value" id="calMonthBrews">12</div>
                    <div class="calendar-stat-label">Brews this month</div>
                </div>
                <div class="calendar-stat-card">
                    <div class="calendar-stat-icon">üî•</div>
                    <div class="calendar-stat-value" id="calMonthStreak">7</div>
                    <div class="calendar-stat-label">Best streak</div>
                </div>
                <div class="calendar-stat-card">
                    <div class="calendar-stat-icon">üòå</div>
                    <div class="calendar-stat-value" id="calMonthMood">85%</div>
                    <div class="calendar-stat-label">Mood improved</div>
                </div>
            </div>
            
            <!-- Today's Detail / Selected Day Detail -->
            <div class="calendar-detail-card" id="calendarDayDetail">
                <div class="calendar-detail-title">
                    <span>üìã</span> Today's Sessions
                </div>
                <div id="calendarDayBrews">
                    <div class="brew-history-item">
                        <div class="brew-history-icon">ü´ñ</div>
                        <div class="brew-history-info">
                            <div class="brew-history-name">Mocha</div>
                            <div class="brew-history-emotion">üò∞ Anxious ‚Üí üòå Calm</div>
                        </div>
                        <div class="brew-history-time">9:30 AM</div>
                    </div>
                    <div class="brew-history-item">
                        <div class="brew-history-icon">ü•õ</div>
                        <div class="brew-history-info">
                            <div class="brew-history-name">Latte</div>
                            <div class="brew-history-emotion">üò¥ Tired ‚Üí üòä Joy</div>
                        </div>
                        <div class="brew-history-time">3:15 PM</div>
                    </div>
                </div>
                <div style="text-align: center; margin-top: 16px; padding-top: 16px; border-top: 1px solid var(--border);">
                    <div style="font-size: 13px; color: var(--text-light); margin-bottom: 8px;">Ready for another mindful moment?</div>
                    <button class="btn btn-primary" onclick="goTo('emotion')">Start Brewing ‚òï</button>
                </div>
            </div>
            
            <!-- Emotion Pattern This Month -->
            <div class="calendar-detail-card">
                <div class="calendar-detail-title">
                    <span>üìä</span> Emotion Patterns This Month
                </div>
                <div style="display: flex; flex-wrap: wrap; gap: 8px;">
                    <div style="flex: 1; min-width: 140px; padding: 12px; background: var(--cream); border-radius: 12px; text-align: center;">
                        <div style="font-size: 24px;">üò∞</div>
                        <div style="font-size: 20px; font-weight: 700; color: var(--coffee-medium);">8</div>
                        <div style="font-size: 11px; color: var(--text-light);">Started Anxious</div>
                    </div>
                    <div style="flex: 1; min-width: 140px; padding: 12px; background: var(--cream); border-radius: 12px; text-align: center;">
                        <div style="font-size: 24px;">üòå</div>
                        <div style="font-size: 20px; font-weight: 700; color: var(--coffee-medium);">10</div>
                        <div style="font-size: 11px; color: var(--text-light);">Ended Calm</div>
                    </div>
                    <div style="flex: 1; min-width: 140px; padding: 12px; background: linear-gradient(135deg, #d4edda, #c3e6cb); border-radius: 12px; text-align: center;">
                        <div style="font-size: 24px;">‚ú®</div>
                        <div style="font-size: 20px; font-weight: 700; color: #155724;">85%</div>
                        <div style="font-size: 11px; color: #155724;">Felt Better After</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- PAGE 15: REWARDS - GAMIFICATION LABORATORY -->
        <div id="rewards" class="page gamified-only">
            <div class="drip-line"><div class="line"></div></div>
            
            <!-- Research Header - Dark, Experimental -->
            <div style="background: linear-gradient(135deg, #0a0a0a, #1a1a2e); border: 1px solid #333; border-radius: 20px; padding: 32px; margin-bottom: 24px; position: relative; overflow: hidden;">
                <div style="position: absolute; top: 10px; right: 10px; font-size: 10px; color: #666; font-family: monospace;">EXPERIMENT_MODULE_03</div>
                <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 16px;">
                    <div style="width: 12px; height: 12px; background: #e74c3c; border-radius: 50%; animation: pulse 2s infinite;"></div>
                    <span style="font-size: 11px; color: #e74c3c; font-weight: 600; letter-spacing: 2px;">GAMIFICATION ACTIVE</span>
                </div>
                <h2 style="font-size: 28px; color: #fff; font-weight: 300; margin-bottom: 8px;">The Reward System</h2>
                <p style="color: #888; font-size: 14px; line-height: 1.6;">
                    This page contains engagement mechanics designed to influence your behavior.<br>
                    <strong style="color: #fff;">Observe your reactions.</strong>
                </p>
            </div>
            
            <!-- Critical Question Banner -->
            <div style="background: #1a1a1a; border-left: 4px solid #f39c12; padding: 20px; margin-bottom: 24px; border-radius: 0 12px 12px 0;">
                <div style="font-size: 12px; color: #f39c12; margin-bottom: 8px; font-weight: 600;">‚ö†Ô∏è BEFORE YOU SCROLL</div>
                <div style="font-size: 16px; color: #fff; font-style: italic;">
                    "Are you here because you want to breathe, or because you want the reward?"
                </div>
            </div>
            
            <!-- Progress Section - Deconstructed -->
            <div style="background: #fff; border-radius: 20px; padding: 24px; margin-bottom: 24px; position: relative;">
                <div style="position: absolute; top: -12px; left: 20px; background: #e74c3c; color: #fff; padding: 4px 12px; border-radius: 20px; font-size: 11px; font-weight: 600;">
                    üî¨ VARIABLE RATIO REINFORCEMENT
                </div>
                
                <div style="margin-top: 12px;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
                        <div>
                            <div style="font-size: 13px; color: #888;">Your Progress</div>
                            <div style="font-size: 32px; font-weight: 700; color: var(--coffee-dark);"><span id="rewardStampCount2">4</span>/10</div>
                        </div>
                        <div style="text-align: right;">
                            <div style="font-size: 13px; color: #888;">Next Reward</div>
                            <div style="font-size: 18px; font-weight: 600; color: #f39c12;">6 more</div>
                        </div>
                    </div>
                    
                    <div style="height: 8px; background: #eee; border-radius: 4px; overflow: hidden; margin-bottom: 16px;">
                        <div style="height: 100%; width: 40%; background: linear-gradient(90deg, #f39c12, #e74c3c); border-radius: 4px;"></div>
                    </div>
                    
                    <div style="display: flex; justify-content: space-between;">
                        <span style="font-size: 20px;">‚òï‚òï‚òï‚òï</span>
                        <span style="font-size: 20px; opacity: 0.3;">‚òï‚òï‚òï‚òï‚òï‚òï</span>
                    </div>
                </div>
                
                <!-- Deconstruction Note -->
                <div style="margin-top: 20px; padding-top: 16px; border-top: 1px dashed #ddd;">
                    <div style="font-size: 11px; color: #888; line-height: 1.6;">
                        <strong>üîç What's happening here:</strong> Progress bars create anticipation. The "almost there" feeling triggers dopamine release, encouraging continued engagement regardless of actual benefit.
                    </div>
                </div>
            </div>
            
            <!-- Rewards Section - With Annotations -->
            <div style="margin-bottom: 24px;">
                <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 16px;">
                    <span style="font-size: 18px;">üéÅ</span>
                    <span style="font-weight: 600;">Available Rewards</span>
                    <span style="font-size: 11px; color: #888; margin-left: auto;">Tap to examine</span>
                </div>
                
                <!-- Reward Card 1 -->
                <div style="background: linear-gradient(135deg, #2d1b13, #1a0f0a); border-radius: 16px; padding: 20px; margin-bottom: 12px; color: #fff; position: relative;">
                    <div style="position: absolute; top: 12px; right: 12px; background: rgba(255,255,255,0.1); padding: 4px 8px; border-radius: 8px; font-size: 10px;">UNLOCKED</div>
                    <div style="font-size: 24px; margin-bottom: 8px;">‚òï</div>
                    <div style="font-size: 18px; font-weight: 600; margin-bottom: 4px;">Free Coffee Voucher</div>
                    <div style="font-size: 13px; opacity: 0.7; margin-bottom: 16px;">Redeem at partner caf√©s</div>
                    <div style="display: flex; gap: 8px;">
                        <button style="flex: 1; padding: 12px; background: #f39c12; border: none; border-radius: 8px; font-weight: 600; cursor: pointer;">Claim Reward</button>
                        <button style="padding: 12px 16px; background: rgba(255,255,255,0.1); border: none; border-radius: 8px; color: #fff; cursor: pointer;">?</button>
                    </div>
                </div>
                
                <!-- Reward Card 2 - Locked -->
                <div style="background: #f5f5f5; border-radius: 16px; padding: 20px; margin-bottom: 12px; position: relative; opacity: 0.7;">
                    <div style="position: absolute; top: 12px; right: 12px; background: #ddd; padding: 4px 8px; border-radius: 8px; font-size: 10px; color: #666;">üîí 16 MORE</div>
                    <div style="font-size: 24px; margin-bottom: 8px; filter: grayscale(1);">üé®</div>
                    <div style="font-size: 18px; font-weight: 600; margin-bottom: 4px; color: #888;">Custom Themes</div>
                    <div style="font-size: 13px; color: #aaa;">Personalize your experience</div>
                </div>
                
                <!-- Reward Card 3 - Locked -->
                <div style="background: #f5f5f5; border-radius: 16px; padding: 20px; position: relative; opacity: 0.7;">
                    <div style="position: absolute; top: 12px; right: 12px; background: #ddd; padding: 4px 8px; border-radius: 8px; font-size: 10px; color: #666;">üîí 26 MORE</div>
                    <div style="font-size: 24px; margin-bottom: 8px; filter: grayscale(1);">üèÜ</div>
                    <div style="font-size: 18px; font-weight: 600; margin-bottom: 4px; color: #888;">Premium Status</div>
                    <div style="font-size: 13px; color: #aaa;">Exclusive breathing patterns</div>
                </div>
            </div>
            
            <!-- Streak Section - Critical Analysis -->
            <div style="background: linear-gradient(135deg, #fff5f5, #ffe5e5); border: 2px solid #ffcccc; border-radius: 16px; padding: 20px; margin-bottom: 24px;">
                <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 16px;">
                    <div style="font-size: 36px;">üî•</div>
                    <div>
                        <div style="font-size: 24px; font-weight: 700; color: #e74c3c;">7 Day Streak</div>
                        <div style="font-size: 13px; color: #888;">Don't break it!</div>
                    </div>
                </div>
                
                <div style="display: flex; gap: 8px; margin-bottom: 16px;">
                    <div style="flex: 1; text-align: center; padding: 8px; background: #fff; border-radius: 8px; border: 2px solid #4CAF50;">
                        <div style="font-size: 10px; color: #888;">Mon</div>
                        <div style="font-size: 16px;">‚úì</div>
                    </div>
                    <div style="flex: 1; text-align: center; padding: 8px; background: #fff; border-radius: 8px; border: 2px solid #4CAF50;">
                        <div style="font-size: 10px; color: #888;">Tue</div>
                        <div style="font-size: 16px;">‚úì</div>
                    </div>
                    <div style="flex: 1; text-align: center; padding: 8px; background: #fff; border-radius: 8px; border: 2px solid #4CAF50;">
                        <div style="font-size: 10px; color: #888;">Wed</div>
                        <div style="font-size: 16px;">‚úì</div>
                    </div>
                    <div style="flex: 1; text-align: center; padding: 8px; background: #fff; border-radius: 8px; border: 2px solid #4CAF50;">
                        <div style="font-size: 10px; color: #888;">Thu</div>
                        <div style="font-size: 16px;">‚úì</div>
                    </div>
                    <div style="flex: 1; text-align: center; padding: 8px; background: #fff; border-radius: 8px; border: 2px solid #4CAF50;">
                        <div style="font-size: 10px; color: #888;">Fri</div>
                        <div style="font-size: 16px;">‚úì</div>
                    </div>
                    <div style="flex: 1; text-align: center; padding: 8px; background: #fff; border-radius: 8px; border: 2px solid #4CAF50;">
                        <div style="font-size: 10px; color: #888;">Sat</div>
                        <div style="font-size: 16px;">‚úì</div>
                    </div>
                    <div style="flex: 1; text-align: center; padding: 8px; background: #fff5e6; border-radius: 8px; border: 2px dashed #f39c12;">
                        <div style="font-size: 10px; color: #888;">Sun</div>
                        <div style="font-size: 16px;">?</div>
                    </div>
                </div>
                
                <!-- Critical Analysis -->
                <div style="background: rgba(0,0,0,0.05); padding: 12px; border-radius: 8px;">
                    <div style="font-size: 11px; color: #666; line-height: 1.6;">
                        <strong>üîç Loss Aversion in Action:</strong> The fear of "breaking" your streak creates anxiety. You may breathe not for wellness, but to avoid losing progress. Is this healthy motivation?
                    </div>
                </div>
            </div>
            
            <!-- Self-Check Section -->
            <div style="background: linear-gradient(135deg, #1a1a2e, #16213e); border-radius: 20px; padding: 24px; margin-bottom: 24px; color: #fff;">
                <div style="font-size: 14px; color: #74b9ff; margin-bottom: 16px; font-weight: 600;">ü™û HONEST SELF-CHECK</div>
                
                <div style="margin-bottom: 20px;">
                    <div style="font-size: 14px; margin-bottom: 12px;">Right now, I feel...</div>
                    <div style="display: flex; flex-wrap: wrap; gap: 8px;">
                        <button onclick="this.classList.toggle('selected')" style="padding: 10px 16px; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); border-radius: 20px; color: #fff; font-size: 13px; cursor: pointer; transition: all 0.2s;">Motivated üí™</button>
                        <button onclick="this.classList.toggle('selected')" style="padding: 10px 16px; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); border-radius: 20px; color: #fff; font-size: 13px; cursor: pointer; transition: all 0.2s;">Pressured üò∞</button>
                        <button onclick="this.classList.toggle('selected')" style="padding: 10px 16px; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); border-radius: 20px; color: #fff; font-size: 13px; cursor: pointer; transition: all 0.2s;">Excited üéâ</button>
                        <button onclick="this.classList.toggle('selected')" style="padding: 10px 16px; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); border-radius: 20px; color: #fff; font-size: 13px; cursor: pointer; transition: all 0.2s;">Anxious üòü</button>
                        <button onclick="this.classList.toggle('selected')" style="padding: 10px 16px; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); border-radius: 20px; color: #fff; font-size: 13px; cursor: pointer; transition: all 0.2s;">Indifferent üòê</button>
                    </div>
                </div>
                
                <div style="margin-bottom: 20px;">
                    <div style="font-size: 14px; margin-bottom: 12px;">Why did I open this page?</div>
                    <div style="display: flex; flex-wrap: wrap; gap: 8px;">
                        <button onclick="this.classList.toggle('selected')" style="padding: 10px 16px; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); border-radius: 20px; color: #fff; font-size: 13px; cursor: pointer;">Check my progress</button>
                        <button onclick="this.classList.toggle('selected')" style="padding: 10px 16px; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); border-radius: 20px; color: #fff; font-size: 13px; cursor: pointer;">Claim a reward</button>
                        <button onclick="this.classList.toggle('selected')" style="padding: 10px 16px; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); border-radius: 20px; color: #fff; font-size: 13px; cursor: pointer;">Just curious</button>
                        <button onclick="this.classList.toggle('selected')" style="padding: 10px 16px; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); border-radius: 20px; color: #fff; font-size: 13px; cursor: pointer;">Feel obligated</button>
                    </div>
                </div>
                
                <div style="padding-top: 16px; border-top: 1px solid rgba(255,255,255,0.1);">
                    <div style="font-size: 12px; color: #888; text-align: center;">
                        Your responses help us understand how gamification affects user behavior.
                    </div>
                </div>
            </div>
            
            <!-- The Alternative -->
            <div style="background: linear-gradient(135deg, #e8f5e9, #c8e6c9); border-radius: 20px; padding: 24px; text-align: center;">
                <div style="font-size: 32px; margin-bottom: 12px;">üßò</div>
                <div style="font-size: 18px; font-weight: 600; color: #2e7d32; margin-bottom: 8px;">Want to try without rewards?</div>
                <div style="font-size: 14px; color: #558b2f; margin-bottom: 16px; line-height: 1.6;">
                    Pure Mode removes all gamification.<br>
                    Just you, your breath, and the present moment.
                </div>
                <button onclick="goTo('settings')" style="padding: 14px 32px; background: #2e7d32; color: #fff; border: none; border-radius: 30px; font-weight: 600; font-size: 14px; cursor: pointer;">
                    Switch to Pure Mode ‚Üí
                </button>
            </div>
            
            <!-- Research Footer -->
            <div style="margin-top: 32px; padding: 20px; border: 1px solid #ddd; border-radius: 12px; background: #fafafa;">
                <div style="font-size: 11px; color: #888; line-height: 1.8; text-align: center;">
                    <strong>üìö Design Research Context</strong><br><br>
                    This rewards system replicates engagement patterns found in apps like Duolingo, Headspace, and social media platforms. 
                    By making these mechanics visible and asking you to reflect on them, Breath Caf√© investigates:<br><br>
                    <em>"Does the interface control me, or can I define the speed of my own experience?"</em>
                </div>
            </div>
        </div>

        <!-- PAGE 10: SETTINGS -->
        <div id="settings" class="page">
            <div class="drip-line"><div class="line"></div></div>
            <h2 class="section-title" style="margin-bottom: 32px;">‚öôÔ∏è Settings</h2>
            
            <!-- EXPERIENCE MODE - Design Research Feature -->
            <div class="stats-card" style="margin-bottom: 20px; border: 2px solid var(--coffee-medium);">
                <div style="padding: 20px; background: linear-gradient(135deg, rgba(93, 64, 55, 0.05), rgba(141, 110, 99, 0.08)); border-radius: 12px;">
                    <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 16px;">
                        <span style="font-size: 24px;">üî¨</span>
                        <div>
                            <div style="font-weight: 700; font-size: 16px;">Experience Mode</div>
                            <div style="font-size: 12px; color: var(--text-light);">A design research experiment</div>
                        </div>
                    </div>
                    
                    <div style="font-size: 13px; color: var(--text-light); line-height: 1.6; margin-bottom: 20px; padding: 12px; background: white; border-radius: 8px;">
                        "Does the interface control me, or can I define the speed of my own experience?"<br>
                        <span style="font-size: 11px;">‚Äî Compare how different modes affect your experience</span>
                    </div>
                    
                    <div style="display: flex; flex-direction: column; gap: 12px;">
                        <label class="mode-option" id="pureModeOption" onclick="setExperienceMode('pure')">
                            <div class="mode-radio"></div>
                            <div class="mode-content">
                                <div class="mode-title">üßò Pure Mode</div>
                                <div class="mode-desc">No streaks, no stamps, no achievements.<br>Just breathing. Just you.</div>
                            </div>
                        </label>
                        
                        <label class="mode-option active" id="gamifiedModeOption" onclick="setExperienceMode('gamified')">
                            <div class="mode-radio"></div>
                            <div class="mode-content">
                                <div class="mode-title">üéÆ Gamified Mode</div>
                                <div class="mode-desc">Streaks, stamps, achievements enabled.<br>Does this motivate you ‚Äî or control you?</div>
                            </div>
                        </label>
                    </div>
                    
                    <div style="margin-top: 16px; padding: 12px; background: var(--cream); border-radius: 8px; font-size: 12px; color: var(--text-light);">
                        üí° <strong>Observe:</strong> Switch between modes and notice how your motivation and experience change.
                    </div>
                </div>
            </div>
            
            <div class="stats-card" style="margin-bottom: 20px;">
                <div style="display: flex; justify-content: space-between; align-items: center; padding: 16px 0; border-bottom: 1px solid var(--border);">
                    <div>
                        <div style="font-weight: 600;">Dark Mode</div>
                        <div style="font-size: 13px; color: var(--text-light);">Switch to dark theme</div>
                    </div>
                    <div class="toggle-switch" id="toggleDarkMode" onclick="toggleSetting('darkMode')"></div>
                </div>
                <div style="display: flex; justify-content: space-between; align-items: center; padding: 16px 0; border-bottom: 1px solid var(--border);">
                    <div>
                        <div style="font-weight: 600;">Sound Effects</div>
                        <div style="font-size: 13px; color: var(--text-light);">Play sounds during brewing</div>
                    </div>
                    <div class="toggle-switch active" id="toggleSound" onclick="toggleSetting('sound')"></div>
                </div>
                <div style="display: flex; justify-content: space-between; align-items: center; padding: 16px 0; border-bottom: 1px solid var(--border);">
                    <div>
                        <div style="font-weight: 600;">Vibration</div>
                        <div style="font-size: 13px; color: var(--text-light);">Haptic feedback</div>
                    </div>
                    <div class="toggle-switch active" id="toggleVibration" onclick="toggleSetting('vibration')"></div>
                </div>
                <div style="display: flex; justify-content: space-between; align-items: center; padding: 16px 0;">
                    <div>
                        <div style="font-weight: 600;">Language</div>
                        <div style="font-size: 13px; color: var(--text-light);">Select your language</div>
                    </div>
                    <div style="font-weight: 500; color: var(--coffee-medium); cursor: pointer;" onclick="openLanguageModal()">English ‚Üí</div>
                </div>
            </div>

            <div class="stats-card">
                <div style="display: flex; justify-content: space-between; align-items: center; padding: 16px 0; border-bottom: 1px solid var(--border); cursor: pointer;" onclick="openModal('privacyModal')">
                    <div>
                        <div style="font-weight: 600;">Privacy Policy</div>
                    </div>
                    <div style="color: var(--text-light);">‚Üí</div>
                </div>
                <div style="display: flex; justify-content: space-between; align-items: center; padding: 16px 0; border-bottom: 1px solid var(--border); cursor: pointer;" onclick="openModal('termsModal')">
                    <div>
                        <div style="font-weight: 600;">Terms of Service</div>
                    </div>
                    <div style="color: var(--text-light);">‚Üí</div>
                </div>
                <div style="display: flex; justify-content: space-between; align-items: center; padding: 16px 0;">
                    <div>
                        <div style="font-weight: 600;">App Version</div>
                    </div>
                    <div style="color: var(--text-light);">1.0.0</div>
                </div>
            </div>
        </div>

        <!-- PAGE 11: NOTIFICATIONS -->
        <div id="notifications" class="page">
            <div class="drip-line"><div class="line"></div></div>
            <h2 class="section-title" style="margin-bottom: 32px;">üîî Notifications</h2>
            
            <div class="stats-card" style="margin-bottom: 20px;">
                <div style="display: flex; justify-content: space-between; align-items: center; padding: 16px 0; border-bottom: 1px solid var(--border);">
                    <div>
                        <div style="font-weight: 600;">Daily Reminder</div>
                        <div style="font-size: 13px; color: var(--text-light);">Get reminded to brew</div>
                    </div>
                    <div class="toggle-switch active" id="toggleDailyReminder" onclick="toggleSetting('dailyReminder')"></div>
                </div>
                <div style="display: flex; justify-content: space-between; align-items: center; padding: 16px 0; border-bottom: 1px solid var(--border);">
                    <div>
                        <div style="font-weight: 600;">Reminder Time</div>
                        <div style="font-size: 13px; color: var(--text-light);">Set your preferred time</div>
                    </div>
                    <div style="font-weight: 500; color: var(--coffee-medium); cursor: pointer;" onclick="openTimePickerModal()"><span id="reminderTimeDisplay">9:00 AM</span> ‚Üí</div>
                </div>
                <div style="display: flex; justify-content: space-between; align-items: center; padding: 16px 0; border-bottom: 1px solid var(--border);">
                    <div>
                        <div style="font-weight: 600;">Streak Alerts</div>
                        <div style="font-size: 13px; color: var(--text-light);">Don't break your streak!</div>
                    </div>
                    <div class="toggle-switch active" id="toggleStreakAlerts" onclick="toggleSetting('streakAlerts')"></div>
                </div>
                <div style="display: flex; justify-content: space-between; align-items: center; padding: 16px 0;">
                    <div>
                        <div style="font-weight: 600;">Weekly Summary</div>
                        <div style="font-size: 13px; color: var(--text-light);">Get weekly progress report</div>
                    </div>
                    <div class="toggle-switch" id="toggleWeeklySummary" onclick="toggleSetting('weeklySummary')"></div>
                </div>
            </div>
        </div>

        <!-- PAGE 12: HELP -->
        <div id="help" class="page">
            <div class="drip-line"><div class="line"></div></div>
            <h2 class="section-title" style="margin-bottom: 32px;">‚ùì Help & Support</h2>
            
            <div class="stats-card" style="margin-bottom: 20px;">
                <div style="padding: 20px; text-align: center; border-bottom: 1px solid var(--border);">
                    <div style="font-size: 48px; margin-bottom: 12px;">‚òï</div>
                    <div style="font-weight: 600; font-size: 18px; margin-bottom: 8px;">How to use Breath Caf√©</div>
                    <div style="font-size: 14px; color: var(--text-light);">Learn the basics of mindful breathing</div>
                </div>
                
                <!-- Getting Started -->
                <div class="help-accordion">
                    <div class="help-accordion-header" onclick="toggleAccordion(this)">
                        <div style="font-weight: 600;">üìñ Getting Started Guide</div>
                        <span class="accordion-arrow">‚ñº</span>
                    </div>
                    <div class="help-accordion-content">
                        <p><strong>Welcome to Breath Caf√©!</strong></p>
                        <p>1. <strong>Select your mood</strong> - Tell us how you're feeling right now</p>
                        <p>2. <strong>Get your brew</strong> - We'll recommend a breathing pattern matched to your emotion</p>
                        <p>3. <strong>Start brewing</strong> - Hold the button and follow the breathing guide</p>
                        <p>4. <strong>Reflect</strong> - Rate your experience and track your progress</p>
                        <p>5. <strong>Collect stamps</strong> - Build your collection with every completed session!</p>
                    </div>
                </div>
                
                <!-- Breathing Techniques -->
                <div class="help-accordion">
                    <div class="help-accordion-header" onclick="toggleAccordion(this)">
                        <div style="font-weight: 600;">ü´Å Breathing Techniques</div>
                        <span class="accordion-arrow">‚ñº</span>
                    </div>
                    <div class="help-accordion-content">
                        <p><strong>Each coffee has a unique breathing pattern:</strong></p>
                        <p>ü´ñ <strong>Mocha (5-4-7)</strong> - Warm & comforting, great for sadness</p>
                        <p>‚òï <strong>Americano (4-2-4)</strong> - Clear & balanced, perfect for anxiety</p>
                        <p>ü•õ <strong>Latte (5-3-6)</strong> - Smooth & gentle, ideal for relaxation</p>
                        <p>üßä <strong>Cold Brew (6-3-6)</strong> - Cool & patient, helps with anger</p>
                        <p>üçØ <strong>Caramel (4-3-5)</strong> - Sweet & rich, enhances joy</p>
                    </div>
                </div>
                
                <!-- Stamps & Rewards -->
                <div class="help-accordion">
                    <div class="help-accordion-header" onclick="toggleAccordion(this)">
                        <div style="font-weight: 600;">üèÜ Stamps & Rewards</div>
                        <span class="accordion-arrow">‚ñº</span>
                    </div>
                    <div class="help-accordion-content">
                        <p><strong>Build your collection!</strong></p>
                        <p>‚Ä¢ Complete a brewing session to earn a stamp</p>
                        <p>‚Ä¢ Collect 10 stamps to unlock achievements</p>
                        <p>‚Ä¢ Maintain your streak for bonus rewards</p>
                        <p>‚Ä¢ Track your mood improvements over time</p>
                        <p>‚Ä¢ Unlock new levels as you progress!</p>
                    </div>
                </div>
                
                <!-- Contact Support -->
                <div class="help-accordion">
                    <div class="help-accordion-header" onclick="toggleAccordion(this)">
                        <div style="font-weight: 600;">üí¨ Contact Support</div>
                        <span class="accordion-arrow">‚ñº</span>
                    </div>
                    <div class="help-accordion-content">
                        <p><strong>We're here to help!</strong></p>
                        <p>üìß Email: <a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="32414742425d40467250405753465a515354571c534242">[email&#160;protected]</a></p>
                        <p>üê¶ Twitter: @BreathCafeApp</p>
                        <p>üí¨ Response time: Within 24 hours</p>
                        <p style="margin-top: 12px;">
                            <button class="btn btn-primary" style="width: 100%;" onclick="window.open('mailto:support@breathcafe.app')">üìß Send Email</button>
                        </p>
                    </div>
                </div>
            </div>

            <div class="stats-card">
                <div style="padding: 20px; text-align: center;">
                    <div style="font-weight: 600; margin-bottom: 8px;">Need more help?</div>
                    <div style="font-size: 14px; color: var(--text-light); margin-bottom: 16px;">We're here to support you</div>
                    <button class="btn btn-primary" style="width: 100%;" onclick="window.open('mailto:support@breathcafe.app')">üìß Email Support</button>
                </div>
            </div>
        </div>

        <!-- PAGE 13: ACCOUNT -->
        <div id="account" class="page">
            <div class="drip-line"><div class="line"></div></div>
            <h2 class="section-title" style="margin-bottom: 32px;">üë§ My Account</h2>
            
            <div class="stats-card" style="margin-bottom: 20px; text-align: center; padding: 32px 20px;">
                <div style="width: 100px; height: 100px; background: linear-gradient(135deg, var(--coffee-medium), var(--coffee-dark)); border-radius: 50%; margin: 0 auto 16px; display: flex; align-items: center; justify-content: center; font-size: 48px; color: white;">üë§</div>
                <div style="font-family: 'Playfair Display', serif; font-size: 24px; font-weight: 600; margin-bottom: 4px;" id="accountUserName">Coffee Lover</div>
                <div style="color: var(--text-light); margin-bottom: 16px;" id="accountUserEmail"><a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="780d0b1d0a381a0a1d190c101b191e1d56190808">[email&#160;protected]</a></div>
                <div style="display: inline-flex; align-items: center; gap: 8px; background: linear-gradient(135deg, #fff5e6, #ffe4cc); padding: 8px 20px; border-radius: 20px;">
                    <span>üèÜ</span>
                    <span style="font-weight: 600;" id="accountUserLevel">Level 7 ¬∑ Gold Member</span>
                </div>
            </div>

            <div class="stats-card" style="margin-bottom: 20px;">
                <div style="display: flex; justify-content: space-between; align-items: center; padding: 16px 0; border-bottom: 1px solid var(--border); cursor: pointer;" onclick="openModal('editProfileModal')">
                    <div style="font-weight: 600;">Edit Profile</div>
                    <div style="color: var(--text-light);">‚Üí</div>
                </div>
                <div style="display: flex; justify-content: space-between; align-items: center; padding: 16px 0; border-bottom: 1px solid var(--border); cursor: pointer;" onclick="openModal('changePasswordModal')">
                    <div style="font-weight: 600;">Change Password</div>
                    <div style="color: var(--text-light);">‚Üí</div>
                </div>
                <div style="display: flex; justify-content: space-between; align-items: center; padding: 16px 0; cursor: pointer;" onclick="openModal('connectedAccountsModal')">
                    <div style="font-weight: 600;">Connected Accounts</div>
                    <div style="color: var(--text-light);">‚Üí</div>
                </div>
            </div>

            <div class="stats-card" style="margin-bottom: 20px;">
                <div style="display: flex; justify-content: space-around; padding: 20px 0; text-align: center;">
                    <div>
                        <div style="font-family: 'Playfair Display', serif; font-size: 28px; font-weight: 700; color: var(--coffee-medium);" id="accountTotalBrews">24</div>
                        <div style="font-size: 13px; color: var(--text-light);">Total Brews</div>
                    </div>
                    <div>
                        <div style="font-family: 'Playfair Display', serif; font-size: 28px; font-weight: 700; color: var(--coffee-medium);" id="accountStreak">7</div>
                        <div style="font-size: 13px; color: var(--text-light);">Day Streak</div>
                    </div>
                    <div>
                        <div style="font-family: 'Playfair Display', serif; font-size: 28px; font-weight: 700; color: var(--coffee-medium);" id="accountStamps">4</div>
                        <div style="font-size: 13px; color: var(--text-light);">Stamps</div>
                    </div>
                </div>
            </div>

            <button class="btn" style="width: 100%; color: #e74c3c; border: 2px solid #e74c3c; background: transparent;" onclick="confirmLogout()">Log Out</button>
        </div>

        <!-- BOTTOM NAV -->
        <nav class="bottom-nav">
            <div class="bottom-nav-inner">
                <div class="nav-item active" onclick="goTo('welcome')">
                    <div class="nav-icon">üè†</div>
                    <div class="nav-label">Home</div>
                </div>
                <div class="nav-item" onclick="goTo('emotion')">
                    <div class="nav-icon">‚òï</div>
                    <div class="nav-label">Brew</div>
                </div>
                <div class="nav-item gamified-only" onclick="goTo('stamps')">
                    <div class="nav-icon">üèÜ</div>
                    <div class="nav-label">Stamps</div>
                </div>
                <div class="nav-item" onclick="goTo('journal')">
                    <div class="nav-icon">üìñ</div>
                    <div class="nav-label">Journal</div>
                </div>
                <div class="nav-item" onclick="goTo('stats')">
                    <div class="nav-icon">üî¨</div>
                    <div class="nav-label">Observe</div>
                </div>
            </div>
        </nav>
    </div>

    <!-- ========== MODALS ========== -->
    
    <!-- Privacy Policy Modal -->
    <div class="modal-overlay" id="privacyModal" onclick="closeModalOnOverlay(event)">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Privacy Policy</h3>
                <button class="modal-close" onclick="closeModal('privacyModal')">‚úï</button>
            </div>
            <div class="modal-body">
                <p><strong>Last updated: December 2024</strong></p>
                <p>At Breath Caf√©, we take your privacy seriously. This policy explains how we collect, use, and protect your personal information.</p>
                <h4>Information We Collect</h4>
                <p>‚Ä¢ Usage data (brewing sessions, emotions tracked)</p>
                <p>‚Ä¢ Device information for app optimization</p>
                <p>‚Ä¢ Optional account information if you sign up</p>
                <h4>How We Use Your Data</h4>
                <p>‚Ä¢ To provide personalized breathing recommendations</p>
                <p>‚Ä¢ To track your progress and streaks</p>
                <p>‚Ä¢ To improve our services</p>
                <h4>Data Storage</h4>
                <p>Your data is stored locally on your device. We do not sell or share your personal information with third parties.</p>
                <h4>Contact Us</h4>
                <p>Questions? Email us at <a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="ea9a98839c8b8993aa88988f8b9e82898b8c8fc48b9a9a">[email&#160;protected]</a></p>
            </div>
        </div>
    </div>

    <!-- Terms of Service Modal -->
    <div class="modal-overlay" id="termsModal" onclick="closeModalOnOverlay(event)">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Terms of Service</h3>
                <button class="modal-close" onclick="closeModal('termsModal')">‚úï</button>
            </div>
            <div class="modal-body">
                <p><strong>Effective: December 2024</strong></p>
                <p>By using Breath Caf√©, you agree to these terms.</p>
                <h4>Use of Service</h4>
                <p>Breath Caf√© is designed to help you practice mindful breathing. It is not a substitute for professional medical advice, diagnosis, or treatment.</p>
                <h4>User Conduct</h4>
                <p>You agree to use the app responsibly and not attempt to reverse engineer or misuse the service.</p>
                <h4>Intellectual Property</h4>
                <p>All content, design, and branding are property of Breath Caf√©.</p>
                <h4>Limitation of Liability</h4>
                <p>Breath Caf√© is provided "as is" without warranties. We are not liable for any damages arising from use of the app.</p>
                <h4>Changes to Terms</h4>
                <p>We may update these terms. Continued use constitutes acceptance of changes.</p>
            </div>
        </div>
    </div>

    <!-- Edit Profile Modal -->
    <div class="modal-overlay" id="editProfileModal" onclick="closeModalOnOverlay(event)">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Edit Profile</h3>
                <button class="modal-close" onclick="closeModal('editProfileModal')">‚úï</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>Display Name</label>
                    <input type="text" id="editName" class="form-input" placeholder="Enter your name" value="Guest">
                </div>
                <div class="form-group">
                    <label>Email</label>
                    <input type="email" id="editEmail" class="form-input" placeholder="Enter your email" value="">
                </div>
                <button class="btn btn-primary" style="width: 100%; margin-top: 16px;" onclick="saveProfile()">Save Changes</button>
            </div>
        </div>
    </div>

    <!-- Change Password Modal -->
    <div class="modal-overlay" id="changePasswordModal" onclick="closeModalOnOverlay(event)">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Change Password</h3>
                <button class="modal-close" onclick="closeModal('changePasswordModal')">‚úï</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>Current Password</label>
                    <input type="password" id="currentPassword" class="form-input" placeholder="Enter current password">
                </div>
                <div class="form-group">
                    <label>New Password</label>
                    <input type="password" id="newPassword" class="form-input" placeholder="Enter new password">
                </div>
                <div class="form-group">
                    <label>Confirm New Password</label>
                    <input type="password" id="confirmPassword" class="form-input" placeholder="Confirm new password">
                </div>
                <button class="btn btn-primary" style="width: 100%; margin-top: 16px;" onclick="changePassword()">Update Password</button>
            </div>
        </div>
    </div>

    <!-- Connected Accounts Modal -->
    <div class="modal-overlay" id="connectedAccountsModal" onclick="closeModalOnOverlay(event)">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Connected Accounts</h3>
                <button class="modal-close" onclick="closeModal('connectedAccountsModal')">‚úï</button>
            </div>
            <div class="modal-body">
                <div class="connected-account">
                    <div class="account-info">
                        <span style="font-size: 24px;">üçé</span>
                        <div>
                            <div style="font-weight: 600;">Apple</div>
                            <div style="font-size: 12px; color: var(--text-light);">Not connected</div>
                        </div>
                    </div>
                    <button class="btn-connect" onclick="connectAccount('apple')">Connect</button>
                </div>
                <div class="connected-account">
                    <div class="account-info">
                        <span style="font-size: 24px;">üîµ</span>
                        <div>
                            <div style="font-weight: 600;">Google</div>
                            <div style="font-size: 12px; color: var(--text-light);">Not connected</div>
                        </div>
                    </div>
                    <button class="btn-connect" onclick="connectAccount('google')">Connect</button>
                </div>
                <div class="connected-account">
                    <div class="account-info">
                        <span style="font-size: 24px;">üìò</span>
                        <div>
                            <div style="font-weight: 600;">Facebook</div>
                            <div style="font-size: 12px; color: var(--text-light);">Not connected</div>
                        </div>
                    </div>
                    <button class="btn-connect" onclick="connectAccount('facebook')">Connect</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Language Modal -->
    <div class="modal-overlay" id="languageModal" onclick="closeModalOnOverlay(event)">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Select Language</h3>
                <button class="modal-close" onclick="closeModal('languageModal')">‚úï</button>
            </div>
            <div class="modal-body">
                <div class="language-option selected" onclick="selectLanguage('en', this)">
                    <span>üá∫üá∏</span> English
                    <span class="check-mark">‚úì</span>
                </div>
                <div class="language-option" onclick="selectLanguage('es', this)">
                    <span>üá™üá∏</span> Espa√±ol
                    <span class="check-mark">‚úì</span>
                </div>
                <div class="language-option" onclick="selectLanguage('fr', this)">
                    <span>üá´üá∑</span> Fran√ßais
                    <span class="check-mark">‚úì</span>
                </div>
                <div class="language-option" onclick="selectLanguage('de', this)">
                    <span>üá©üá™</span> Deutsch
                    <span class="check-mark">‚úì</span>
                </div>
                <div class="language-option" onclick="selectLanguage('ja', this)">
                    <span>üáØüáµ</span> Êó•Êú¨Ë™û
                    <span class="check-mark">‚úì</span>
                </div>
                <div class="language-option" onclick="selectLanguage('ko', this)">
                    <span>üá∞üá∑</span> ÌïúÍµ≠Ïñ¥
                    <span class="check-mark">‚úì</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Time Picker Modal -->
    <div class="modal-overlay" id="timePickerModal" onclick="closeModalOnOverlay(event)">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Set Reminder Time</h3>
                <button class="modal-close" onclick="closeModal('timePickerModal')">‚úï</button>
            </div>
            <div class="modal-body">
                <div class="time-picker">
                    <select id="reminderHour" class="time-select">
                        <option value="6">6</option>
                        <option value="7">7</option>
                        <option value="8">8</option>
                        <option value="9" selected>9</option>
                        <option value="10">10</option>
                        <option value="11">11</option>
                        <option value="12">12</option>
                    </select>
                    <span style="font-size: 24px; font-weight: 600;">:</span>
                    <select id="reminderMinute" class="time-select">
                        <option value="00" selected>00</option>
                        <option value="15">15</option>
                        <option value="30">30</option>
                        <option value="45">45</option>
                    </select>
                    <select id="reminderPeriod" class="time-select">
                        <option value="AM" selected>AM</option>
                        <option value="PM">PM</option>
                    </select>
                </div>
                <button class="btn btn-primary" style="width: 100%; margin-top: 24px;" onclick="saveReminderTime()">Save Time</button>
            </div>
        </div>
    </div>

    <!-- Toast Notification -->
    <div class="toast" id="toast">
        <span class="toast-icon">‚úì</span>
        <span class="toast-message" id="toastMessage">Settings saved!</span>
    </div>

    <script data-cfasync="false" src="/cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script><script>
        // ========== SPLASH & ONBOARDING SYSTEM ==========
        let currentSlide = 0;
        const totalSlides = 6;
        
        // User preferences
        let userGoal = null;
        let userStyle = null;
        
        function selectGoal(btn, goal) {
            document.querySelectorAll('.goal-option').forEach(b => {
                b.style.borderColor = '#e8dcc7';
                b.style.background = '#fff';
            });
            btn.style.borderColor = '#5d4037';
            btn.style.background = '#f5f0e8';
            userGoal = goal;
        }
        
        function selectStyle(btn, style) {
            document.querySelectorAll('.style-option').forEach(b => {
                b.style.borderColor = '#e8dcc7';
                b.style.background = '#fff';
            });
            btn.style.borderColor = '#5d4037';
            btn.style.background = '#f5f0e8';
            userStyle = style;
        }
        
        // Splash screen
        function initSplash() {
            const hasSeenOnboarding = localStorage.getItem('breathCafeOnboarding');
            
            // Show splash for 2.5 seconds
            setTimeout(() => {
                document.getElementById('splashScreen').classList.add('hidden');
                
                // If already seen onboarding, hide it too
                if (hasSeenOnboarding) {
                    document.getElementById('onboardingOverlay').classList.add('hidden');
                }
            }, 2500);
        }
        
        function checkOnboarding() {
            const hasSeenOnboarding = localStorage.getItem('breathCafeOnboarding');
            if (hasSeenOnboarding) {
                document.getElementById('onboardingOverlay').classList.add('hidden');
            }
        }
        
        function goToSlide(num) {
            currentSlide = num;
            document.querySelectorAll('.onboarding-slide').forEach(s => s.classList.remove('active'));
            document.getElementById('slide' + num).classList.add('active');
            
            // Update all dots across all slides
            document.querySelectorAll('.onboarding-dots').forEach(dotsContainer => {
                dotsContainer.querySelectorAll('.onboarding-dot').forEach((dot, i) => {
                    dot.classList.toggle('active', i === num);
                });
            });
        }
        
        function nextSlide() {
            if (currentSlide < totalSlides - 1) {
                goToSlide(currentSlide + 1);
            }
        }
        
        function prevSlide() {
            if (currentSlide > 0) {
                goToSlide(currentSlide - 1);
            }
        }
        
        function skipOnboarding() {
            finishOnboarding();
        }
        
        function finishOnboarding() {
            localStorage.setItem('breathCafeOnboarding', 'true');
            document.getElementById('onboardingOverlay').classList.add('hidden');
            // Go to emotion page for first brew
            goTo('emotion');
        }
        
        // Reset onboarding (for testing)
        function resetOnboarding() {
            localStorage.removeItem('breathCafeOnboarding');
            location.reload();
        }
        
        // Initialize splash on page load
        document.addEventListener('DOMContentLoaded', function() {
            initSplash();
            initExperienceMode();
        });

        // ========== DATA PERSISTENCE SYSTEM ==========
        const DB = {
            load: function() {
                const saved = localStorage.getItem('breathCafeData');
                if (saved) {
                    return JSON.parse(saved);
                }
                return {
                    user: { name: 'Coffee Lover', email: '', level: 1, joinDate: new Date().toISOString() },
                    stats: { totalBrews: 0, streak: 0, lastBrewDate: null, moodImproved: 0, moodTotal: 0 },
                    stamps: [],
                    history: [],
                    journalEntries: [],
                    coffeeCount: { mocha: 0, americano: 0, latte: 0, coldbrew: 0, caramel: 0 },
                    weeklyBrews: [0, 0, 0, 0],
                    timeOfDay: { morning: 0, afternoon: 0, evening: 0, night: 0 },
                    achievements: { streak7: false, streak30: false, mochaMaster: false, earlyBird: false, first10: false },
                    emotionJourney: [],
                    settings: { darkMode: false, sound: true, vibration: true, dailyReminder: true, reminderTime: '09:00' }
                };
            },
            save: function(data) { localStorage.setItem('breathCafeData', JSON.stringify(data)); },
            get: function() { return this.load(); },
            update: function(key, value) {
                const data = this.load();
                data[key] = value;
                this.save(data);
                return data;
            },
            addBrew: function(brewData) {
                const data = this.load();
                // Add to history
                data.history.unshift(brewData);
                // Add stamp
                data.stamps.push({ date: new Date().toLocaleDateString('en-US', {month: '2-digit', day: '2-digit'}), coffee: brewData.coffeeIcon, filled: true });
                // Update stats
                data.stats.totalBrews++;
                data.stats.moodTotal++;
                // Check mood improvement
                const negativeEmotions = ['sad', 'anxious', 'angry', 'tired'];
                const positiveEmotions = ['joy', 'calm'];
                if (negativeEmotions.includes(brewData.beforeEmotion) && positiveEmotions.includes(brewData.afterEmotion)) {
                    data.stats.moodImproved++;
                }
                // Update streak
                const today = new Date().toDateString();
                const lastBrew = data.stats.lastBrewDate ? new Date(data.stats.lastBrewDate).toDateString() : null;
                const yesterday = new Date(Date.now() - 86400000).toDateString();
                if (lastBrew === yesterday) {
                    data.stats.streak++;
                } else if (lastBrew !== today) {
                    data.stats.streak = 1;
                }
                data.stats.lastBrewDate = new Date().toISOString();
                // Update coffee count
                if (data.coffeeCount[brewData.coffeeType] !== undefined) {
                    data.coffeeCount[brewData.coffeeType]++;
                }
                // Update time of day
                const hour = new Date().getHours();
                if (hour >= 5 && hour < 12) data.timeOfDay.morning++;
                else if (hour >= 12 && hour < 17) data.timeOfDay.afternoon++;
                else if (hour >= 17 && hour < 21) data.timeOfDay.evening++;
                else data.timeOfDay.night++;
                // Update weekly brews
                const weekNum = Math.floor((new Date().getDate() - 1) / 7);
                if (weekNum < 4) data.weeklyBrews[weekNum]++;
                // Check achievements
                if (data.stats.streak >= 7) data.achievements.streak7 = true;
                if (data.stats.streak >= 30) data.achievements.streak30 = true;
                if (data.coffeeCount.mocha >= 10) data.achievements.mochaMaster = true;
                if (data.timeOfDay.morning >= 5) data.achievements.earlyBird = true;
                if (data.stats.totalBrews >= 10) data.achievements.first10 = true;
                // Update level
                data.user.level = Math.floor(data.stats.totalBrews / 5) + 1;
                // Add to emotion journey
                data.emotionJourney.push({
                    date: new Date().toISOString(),
                    day: new Date().getDay(),
                    before: brewData.beforeEmotion,
                    after: brewData.afterEmotion,
                    icon: brewData.afterIcon
                });
                // Keep only last 7 days of emotion journey
                if (data.emotionJourney.length > 7) {
                    data.emotionJourney = data.emotionJourney.slice(-7);
                }
                this.save(data);
                return data;
            },
            addJournalEntry: function(text) {
                const data = this.load();
                data.journalEntries.unshift({
                    date: new Date().toLocaleDateString('en-US', {month: 'short', day: 'numeric'}),
                    text: text,
                    timestamp: new Date().toISOString()
                });
                this.save(data);
                return data;
            }
        };

        // Load saved data on startup
        let userData = DB.load();
        
        const st = {
            curr: 'welcome',
            emotion: null, emotionIcon: null, emotionText: null,
            coffee: null, breathData: {inhale: 5, hold: 4, exhale: 7},
            afterEmotion: null, afterIcon: null, afterText: null,
            note: '', rating: 0,
            holding: false, phase: 0, timer: 0, phaseTime: 0, interval: null,
            cycle: 1, totalCycles: 3, cyclePhase: 0,
            stamps: userData.stamps,
            history: userData.history,
            journalEntries: userData.journalEntries
        };

        const coffees = {
            mocha: {icon: 'ü´ñ', name: 'Mocha', tag: 'Warm & Comforting', inhale: 5, hold: 4, exhale: 7, steps: [
                {n: 'Grinding (5s)', d: 'Prepare slowly, breathe deeply'},
                {n: 'Heating (4s)', d: 'Let warmth settle'},
                {n: 'Brewing (7s)', d: 'Release slowly like comfort'}
            ]},
            americano: {icon: '‚òï', name: 'Americano', tag: 'Clear & Balanced', inhale: 4, hold: 2, exhale: 4, steps: [
                {n: 'Pouring (4s)', d: 'Steady rhythm'},
                {n: 'Blooming (2s)', d: 'Find balance'},
                {n: 'Extracting (4s)', d: 'Even flow'}
            ]},
            latte: {icon: 'ü•õ', name: 'Latte', tag: 'Smooth & Gentle', inhale: 5, hold: 3, exhale: 6, steps: [
                {n: 'Brewing (5s)', d: 'Deep breath'},
                {n: 'Steaming (3s)', d: 'Gentle hold'},
                {n: 'Pouring (6s)', d: 'Smooth release'}
            ]},
            coldbrew: {icon: 'üßä', name: 'Cold Brew', tag: 'Cool & Patient', inhale: 6, hold: 3, exhale: 6, steps: [
                {n: 'Chilling (6s)', d: 'Deep slow breath'},
                {n: 'Steeping (3s)', d: 'Patient hold'},
                {n: 'Cooling (6s)', d: 'Long release'}
            ]},
            caramel: {icon: 'üçØ', name: 'Caramel', tag: 'Sweet & Rich', inhale: 4, hold: 3, exhale: 5, steps: [
                {n: 'Base (4s)', d: 'Gentle breath'},
                {n: 'Syrup (3s)', d: 'Sweet hold'},
                {n: 'Mixing (5s)', d: 'Rich release'}
            ]}
        };

        const emotionMap = {sad: 'mocha', anxious: 'americano', angry: 'coldbrew', tired: 'espresso', joy: 'caramel', calm: 'latte'};

        function toggleSidebar() {
            document.getElementById('sidebar').classList.toggle('active');
            document.getElementById('sidebarOverlay').classList.toggle('active');
            document.getElementById('hamburgerBtn').classList.toggle('active');
        }

        function goTo(page) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.getElementById(page).classList.add('active');
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
            // Update header nav
            document.querySelectorAll('.header-nav-item').forEach(n => {
                n.classList.remove('active');
                if ((page === 'welcome' && n.textContent.includes('Home')) ||
                    (page === 'emotion' && n.textContent.includes('Brew')) ||
                    (page === 'journal' && n.textContent.includes('Journal')) ||
                    (page === 'stats' && n.textContent.includes('Stats'))) {
                    n.classList.add('active');
                }
            });
            st.curr = page;
            if (page === 'stamps') initStamps();
            if (page === 'journal') initJournal();
            if (page === 'stats') updateStatsPage();
            if (page === 'welcome') updateWelcomePage();
            if (page === 'account') updateAccountPage();
            window.scrollTo(0, 0);
        }
        
        // Update Stats page with real data
        function updateStatsPage() {
            userData = DB.load();
            
            // Main stats
            const totalBrews = userData.stats.totalBrews;
            const streak = userData.stats.streak;
            const moodRate = userData.stats.moodTotal > 0 
                ? Math.round((userData.stats.moodImproved / userData.stats.moodTotal) * 100) 
                : 0;
            
            // Find favorite coffee
            let favCoffee = '‚òï';
            let maxCount = 0;
            for (const [coffee, count] of Object.entries(userData.coffeeCount)) {
                if (count > maxCount) {
                    maxCount = count;
                    favCoffee = coffees[coffee]?.icon || '‚òï';
                }
            }
            
            // Update main stats display
            const statsCards = document.querySelectorAll('#stats .stat-card .stat-number');
            if (statsCards.length >= 4) {
                statsCards[0].textContent = totalBrews;
                statsCards[1].textContent = streak + 'üî•';
                statsCards[2].textContent = maxCount > 0 ? favCoffee : '-';
                statsCards[3].textContent = moodRate + '%';
            }
            
            // Update coffee chart bars
            const coffeeOrder = ['mocha', 'americano', 'latte', 'coldbrew'];
            const totalCoffee = Object.values(userData.coffeeCount).reduce((a, b) => a + b, 0) || 1;
            coffeeOrder.forEach((coffee, i) => {
                const bars = document.querySelectorAll('#stats .bar-fill');
                if (bars[i]) {
                    const count = userData.coffeeCount[coffee] || 0;
                    const percent = Math.round((count / totalCoffee) * 100);
                    bars[i].style.width = percent + '%';
                    bars[i].textContent = count;
                }
            });
            
            // Update weekly bars
            const weekBars = document.querySelectorAll('#stats .chart-container:nth-of-type(2) .bar-fill');
            const maxWeek = Math.max(...userData.weeklyBrews, 1);
            userData.weeklyBrews.forEach((count, i) => {
                if (weekBars[i]) {
                    const percent = Math.round((count / maxWeek) * 100);
                    weekBars[i].style.width = percent + '%';
                    weekBars[i].textContent = count;
                }
            });
            
            // Update emotion journey
            updateEmotionJourney();
            
            // Update time of day
            updateTimeOfDay();
            
            // Update achievements
            updateAchievements();
            
            // Update ranking (based on total brews)
            updateRanking();
        }
        
        function updateEmotionJourney() {
            const days = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
            const today = new Date().getDay();
            const emotionDivs = document.querySelectorAll('#stats .stats-card:nth-of-type(3) > div > div:nth-child(2) > div');
            
            if (emotionDivs.length >= 7) {
                // Reset all days
                emotionDivs.forEach((div, i) => {
                    const iconDiv = div.querySelector('div:first-child');
                    if (iconDiv) {
                        iconDiv.textContent = '‚ùì';
                        iconDiv.style.opacity = '0.3';
                    }
                });
                
                // Fill in from emotion journey
                userData.emotionJourney.forEach(entry => {
                    const dayIndex = entry.day;
                    if (emotionDivs[dayIndex]) {
                        const iconDiv = emotionDivs[dayIndex].querySelector('div:first-child');
                        if (iconDiv) {
                            iconDiv.textContent = entry.icon;
                            iconDiv.style.opacity = '1';
                        }
                    }
                });
            }
        }
        
        function updateTimeOfDay() {
            const times = ['morning', 'afternoon', 'evening', 'night'];
            const total = Object.values(userData.timeOfDay).reduce((a, b) => a + b, 0) || 1;
            const timeDivs = document.querySelectorAll('#stats .stats-card:nth-of-type(5) .stat-number, #stats .stats-card:nth-of-type(5) div[style*="font-weight: 600"]');
        }
        
        function updateAchievements() {
            const achDivs = document.querySelectorAll('#stats .stats-card:last-child > div > div:nth-child(2) > div');
            const achievements = [
                { key: 'streak7', icon: 'üî•' },
                { key: 'mochaMaster', icon: 'ü´ñ' },
                { key: 'earlyBird', icon: 'üåÖ' },
                { key: 'streak30', icon: 'üèÜ' }
            ];
            
            achDivs.forEach((div, i) => {
                if (achievements[i]) {
                    const unlocked = userData.achievements[achievements[i].key];
                    const iconDiv = div.querySelector('div:first-child');
                    if (iconDiv) {
                        iconDiv.style.opacity = unlocked ? '1' : '0.4';
                        iconDiv.style.background = unlocked 
                            ? iconDiv.style.background 
                            : 'var(--border)';
                    }
                }
            });
        }
        
        function updateRanking() {
            const totalBrews = userData.stats.totalBrews;
            let rank = 100;
            let percentile = 50;
            
            if (totalBrews >= 50) { rank = 1; percentile = 99; }
            else if (totalBrews >= 40) { rank = 3; percentile = 97; }
            else if (totalBrews >= 30) { rank = 5; percentile = 95; }
            else if (totalBrews >= 20) { rank = 10; percentile = 90; }
            else if (totalBrews >= 10) { rank = 25; percentile = 75; }
            else if (totalBrews >= 5) { rank = 50; percentile = 50; }
            
            const rankDiv = document.querySelector('#stats .stats-card:nth-of-type(2) .stat-number, #stats div[style*="font-size: 24px"]');
        }
        
        function updateWelcomePage() {
            userData = DB.load();
            // Update welcome page stats if elements exist
            const welcomeStats = document.querySelectorAll('#welcome .stat-card .stat-number');
            if (welcomeStats.length >= 4) {
                welcomeStats[0].textContent = userData.stats.streak;
                welcomeStats[1].textContent = userData.stats.totalBrews;
            }
        }

        function selectEmotion(id, icon, text) {
            document.querySelectorAll('.emotion-card').forEach(c => c.classList.remove('selected'));
            event.target.closest('.emotion-card').classList.add('selected');
            st.emotion = id;
            st.emotionIcon = icon;
            st.emotionText = text;
            setTimeout(() => {
                showRec(id);
                goTo('recommendation');
            }, 500);
        }

        function showRec(emo) {
            const type = emotionMap[emo] || 'mocha';
            const c = coffees[type];
            st.coffee = type;
            st.breathData = {inhale: c.inhale, hold: c.hold, exhale: c.exhale};
            document.getElementById('currEmotion').textContent = st.emotionText;
            document.getElementById('currIcon').textContent = st.emotionIcon;
            document.getElementById('recIcon').textContent = c.icon;
            document.getElementById('recName').textContent = c.name;
            document.getElementById('recTag').textContent = `"${c.tag}"`;
            document.getElementById('inhaleT').textContent = c.inhale + 's';
            document.getElementById('holdT').textContent = c.hold + 's';
            document.getElementById('exhaleT').textContent = c.exhale + 's';
            const total = c.inhale + c.hold + c.exhale;
            document.querySelectorAll('.breath-visual')[0].style.height = (c.inhale/total*60) + 'px';
            document.querySelectorAll('.breath-visual')[1].style.height = (c.hold/total*60) + 'px';
            document.querySelectorAll('.breath-visual')[2].style.height = (c.exhale/total*60) + 'px';
            document.getElementById('s1n').textContent = c.steps[0].n;
            document.getElementById('s1d').textContent = c.steps[0].d;
            document.getElementById('s2n').textContent = c.steps[1].n;
            document.getElementById('s2d').textContent = c.steps[1].d;
            document.getElementById('s3n').textContent = c.steps[2].n;
            document.getElementById('s3d').textContent = c.steps[2].d;
        }

        function changeRec(type) {
            const c = coffees[type];
            st.coffee = type;
            st.breathData = {inhale: c.inhale, hold: c.hold, exhale: c.exhale};
            document.getElementById('recIcon').textContent = c.icon;
            document.getElementById('recName').textContent = c.name;
            document.getElementById('recTag').textContent = `"${c.tag}"`;
            document.getElementById('inhaleT').textContent = c.inhale + 's';
            document.getElementById('holdT').textContent = c.hold + 's';
            document.getElementById('exhaleT').textContent = c.exhale + 's';
            const total = c.inhale + c.hold + c.exhale;
            document.querySelectorAll('.breath-visual')[0].style.height = (c.inhale/total*60) + 'px';
            document.querySelectorAll('.breath-visual')[1].style.height = (c.hold/total*60) + 'px';
            document.querySelectorAll('.breath-visual')[2].style.height = (c.exhale/total*60) + 'px';
            document.getElementById('s1n').textContent = c.steps[0].n;
            document.getElementById('s1d').textContent = c.steps[0].d;
            document.getElementById('s2n').textContent = c.steps[1].n;
            document.getElementById('s2d').textContent = c.steps[1].d;
            document.getElementById('s3n').textContent = c.steps[2].n;
            document.getElementById('s3d').textContent = c.steps[2].d;
        }

        function startBrew() {
            goTo('brewing');
            st.phase = 0;
            st.timer = 0;
            st.phaseTime = 0;
            st.cycle = 1;
            st.cyclePhase = 0;
            updateCycleDots();
            updatePhase();
        }

        function hold() {
            st.holding = true;
            document.getElementById('holdBtn').classList.add('holding');
            if (!st.interval) {
                st.interval = setInterval(() => {
                    if (st.holding) {
                        st.timer++;
                        st.phaseTime++;
                        updateBrewUI();
                        const phases = [st.breathData.inhale, st.breathData.hold, st.breathData.exhale];
                        if (st.phaseTime >= phases[st.cyclePhase]) {
                            st.phaseTime = 0;
                            st.cyclePhase++;
                            if (st.cyclePhase >= 3) {
                                st.cyclePhase = 0;
                                st.cycle++;
                                updateCycleDots();
                                if (st.cycle > st.totalCycles) {
                                    complete();
                                    return;
                                }
                            }
                            updatePhase();
                        }
                    }
                }, 1000);
            }
        }
        
        function updateCycleDots() {
            document.getElementById('cycleCount').textContent = Math.min(st.cycle, st.totalCycles);
            for (let i = 1; i <= st.totalCycles; i++) {
                const dot = document.getElementById('dot' + i);
                if (i < st.cycle) {
                    dot.className = 'cycle-dot completed';
                } else if (i === st.cycle) {
                    dot.className = 'cycle-dot active';
                } else {
                    dot.className = 'cycle-dot';
                }
            }
        }

        function unhold() {
            st.holding = false;
            document.getElementById('holdBtn').classList.remove('holding');
        }

        function updatePhase() {
            const phases = [
                {title: 'GRINDING BEANS', action: 'Inhale ‚Üë', desc: '"Prepare slowly, breathe deeply"', dur: st.breathData.inhale, emoji: 'ü´ò'},
                {title: 'HEATING WATER', action: 'Hold ‚Äî', desc: '"Let warmth settle"', dur: st.breathData.hold, emoji: '‚ô®Ô∏è'},
                {title: 'BREWING', action: 'Exhale ‚Üì', desc: '"Release slowly"', dur: st.breathData.exhale, emoji: '‚òï'}
            ];
            const p = phases[st.cyclePhase];
            document.getElementById('phaseTitle').textContent = p.title;
            document.getElementById('phaseAction').textContent = p.action;
            document.getElementById('phaseDesc').textContent = p.desc;
            document.getElementById('phaseEmoji').textContent = p.emoji;
        }

        function updateBrewUI() {
            const m = Math.floor(st.timer / 60);
            const s = st.timer % 60;
            document.getElementById('brewTimer').textContent = String(m).padStart(2, '0') + ':' + String(s).padStart(2, '0');
            const phases = [st.breathData.inhale, st.breathData.hold, st.breathData.exhale];
            const rem = phases[st.cyclePhase] - st.phaseTime;
            document.getElementById('phaseTime').textContent = rem + 's left';
            
            // Update progress circle
            const totalPerCycle = st.breathData.inhale + st.breathData.hold + st.breathData.exhale;
            const completedCycles = (st.cycle - 1) * totalPerCycle;
            const currentCycleTime = st.cyclePhase === 0 ? st.phaseTime : 
                                    st.cyclePhase === 1 ? st.breathData.inhale + st.phaseTime :
                                    st.breathData.inhale + st.breathData.hold + st.phaseTime;
            const totalTime = completedCycles + currentCycleTime;
            const totalDuration = st.totalCycles * totalPerCycle;
            const progress = totalTime / totalDuration;
            const circumference = 2 * Math.PI * 80;
            const offset = circumference - (progress * circumference);
            document.getElementById('progressCircle').style.strokeDashoffset = offset;
            document.getElementById('phaseProgress').textContent = Math.round(progress * 100) + '%';
            
            // Update coffee level
            const coffeeProgress = Math.min(progress * 100, 100);
            document.getElementById('coffeeLevel').style.height = coffeeProgress + '%';
            
            // Update hold button progress
            const phaseProgress = (st.phaseTime / phases[st.cyclePhase]) * 100;
            document.getElementById('holdProgress').style.width = phaseProgress + '%';
        }

        function confirmStop() {
            if (confirm('Stop brewing?')) {
                clearInterval(st.interval);
                st.interval = null;
                goTo('recommendation');
            }
        }

        function complete() {
            clearInterval(st.interval);
            st.interval = null;
            setTimeout(() => {
                goTo('reflection');
                initRef();
            }, 1000);
        }

        function initRef() {
            const c = coffees[st.coffee];
            document.getElementById('refCoffee').textContent = c.name;
            document.getElementById('beforeIcon').textContent = st.emotionIcon;
            document.getElementById('beforeText').textContent = st.emotionText;
            document.querySelectorAll('.emotion-option').forEach(o => o.classList.remove('selected'));
            document.getElementById('sipNote').value = '';
            document.getElementById('charCount').textContent = '0/100';
            resetStars();
            st.afterEmotion = null;
            st.note = '';
            st.rating = 0;
        }

        function selectAfter(id, icon, text) {
            document.querySelectorAll('.emotion-option').forEach(o => o.classList.remove('selected'));
            event.target.closest('.emotion-option').classList.add('selected');
            st.afterEmotion = id;
            st.afterIcon = icon;
            st.afterText = text;
        }

        function updateCount() {
            const t = document.getElementById('sipNote');
            document.getElementById('charCount').textContent = t.value.length + '/100';
            st.note = t.value;
        }

        function rate(r) {
            st.rating = r;
            const stars = document.querySelectorAll('.star');
            stars.forEach((s, i) => {
                if (i < r) {
                    s.textContent = '‚òÖ';
                    s.classList.add('active');
                } else {
                    s.textContent = '‚òÜ';
                    s.classList.remove('active');
                }
            });
        }

        function resetStars() {
            document.querySelectorAll('.star').forEach(s => {
                s.textContent = '‚òÜ';
                s.classList.remove('active');
            });
        }

        function saveRef() {
            if (!st.afterEmotion) {
                showToast('Please select how you feel now', 'error');
                return;
            }
            if (st.rating === 0) {
                showToast('Please rate your experience', 'error');
                return;
            }
            const c = coffees[st.coffee];
            const brewData = {
                date: new Date().toLocaleDateString('en-US', {month: 'short', day: 'numeric'}),
                coffee: c.icon + ' ' + c.name,
                coffeeIcon: c.icon,
                coffeeType: st.coffee,
                before: st.emotionIcon,
                after: st.afterIcon,
                beforeT: st.emotionText,
                afterT: st.afterText,
                beforeEmotion: st.emotion,
                afterEmotion: st.afterEmotion,
                dur: formatTime(st.timer),
                rating: st.rating,
                note: st.note,
                timestamp: new Date().toISOString()
            };
            
            // Save to localStorage via DB
            userData = DB.addBrew(brewData);
            
            // Update local state
            st.history = userData.history;
            st.stamps = userData.stamps;
            
            // Show success message
            showToast('Brewing saved! Keep up the great work üéâ');
            
            setTimeout(() => goTo('stamps'), 500);
        }

        function formatTime(sec) {
            const m = Math.floor(sec / 60);
            const s = sec % 60;
            return m + ':' + String(s).padStart(2, '0');
        }

        function initStamps() {
            userData = DB.load();
            const prog = (st.stamps.length / 10) * 100;
            const remaining = 10 - st.stamps.length;
            
            // Update progress
            document.getElementById('stampProg').textContent = st.stamps.length + '/10 stamps';
            document.getElementById('stampBar').style.width = prog + '%';
            
            // Update reward text
            const rewardEl = document.getElementById('stampReward');
            if (rewardEl) {
                if (remaining > 0) {
                    rewardEl.textContent = `üéÅ ${remaining} more for reward!`;
                } else {
                    rewardEl.textContent = 'üéâ Reward unlocked!';
                }
            }
            
            // Update streak
            const streakEl = document.getElementById('stampStreak');
            if (streakEl) {
                streakEl.textContent = userData.stats.streak + ' Day Streak!';
            }
            
            // Update mindful stats
            const totalBrews = userData.stats.totalBrews;
            const avgBreathsPerSession = 24; // 3 cycles √ó 8 breaths approx
            const avgMinutesPerSession = 2;
            
            const totalBreathsEl = document.getElementById('totalBreaths');
            if (totalBreathsEl) {
                totalBreathsEl.textContent = (totalBrews * avgBreathsPerSession).toLocaleString();
            }
            
            const totalMinutesEl = document.getElementById('totalMinutes');
            if (totalMinutesEl) {
                totalMinutesEl.textContent = (totalBrews * avgMinutesPerSession).toLocaleString();
            }
            
            const moodPercentEl = document.getElementById('moodImprovePercent');
            if (moodPercentEl && userData.stats.moodTotal > 0) {
                const percent = Math.round((userData.stats.moodImproved / userData.stats.moodTotal) * 100);
                moodPercentEl.textContent = percent + '%';
            }
            
            // Update achievements
            if (userData.stats.totalBrews >= 1) {
                const achFirst = document.getElementById('achFirst');
                if (achFirst) achFirst.classList.add('unlocked');
            }
            if (userData.stats.streak >= 7) {
                const achWeek = document.getElementById('achWeek');
                if (achWeek) achWeek.classList.add('unlocked');
            }
            if (userData.coffeeCount.mocha >= 10) {
                const achMaster = document.getElementById('achMaster');
                if (achMaster) achMaster.classList.add('unlocked');
            }
            if (userData.stats.totalBrews >= 30) {
                const achZen = document.getElementById('achZen');
                if (achZen) achZen.classList.add('unlocked');
            }
            
            // Update motivational quote
            const quotes = [
                { text: "Breathing in, I calm my body. Breathing out, I smile.", author: "Thich Nhat Hanh" },
                { text: "The present moment is filled with joy and happiness. If you are attentive, you will see it.", author: "Thich Nhat Hanh" },
                { text: "Feelings come and go like clouds in a windy sky. Conscious breathing is my anchor.", author: "Thich Nhat Hanh" },
                { text: "In the midst of movement and chaos, keep stillness inside of you.", author: "Deepak Chopra" },
                { text: "The greatest weapon against stress is our ability to choose one thought over another.", author: "William James" },
                { text: "Almost everything will work again if you unplug it for a few minutes, including you.", author: "Anne Lamott" }
            ];
            const randomQuote = quotes[Math.floor(Math.random() * quotes.length)];
            const quoteEl = document.getElementById('mindfulQuote');
            if (quoteEl) {
                quoteEl.innerHTML = `"${randomQuote.text}"`;
                quoteEl.nextElementSibling.textContent = `‚Äî ${randomQuote.author}`;
            }
            
            // Render stamp grid
            const grid = document.getElementById('stampGrid');
            grid.innerHTML = '';
            for (let i = 0; i < 10; i++) {
                const slot = document.createElement('div');
                slot.className = 'stamp';
                if (i < st.stamps.length) {
                    slot.classList.add('filled');
                    slot.textContent = st.stamps[i].coffee;
                    const date = document.createElement('div');
                    date.className = 'stamp-date';
                    date.textContent = st.stamps[i].date;
                    slot.appendChild(date);
                } else {
                    slot.innerHTML = '<span style="opacity: 0.3; font-size: 20px;">‚òï</span>';
                }
                grid.appendChild(slot);
            }
            
            // Render history
            const list = document.getElementById('histList');
            list.innerHTML = '';
            st.history.slice(0, 5).forEach(e => {
                const item = document.createElement('div');
                item.className = 'history-item';
                item.innerHTML = `
                    <div class="history-date">${e.date}</div>
                    <div class="history-coffee">${e.coffee}</div>
                    <div class="history-emotions">${e.before} ${e.beforeT} ‚Üí ${e.after} ${e.afterT} <span style="margin-left:auto;">${e.dur}</span></div>
                    ${e.note ? '<div class="history-note">"' + e.note + '"</div>' : ''}
                    <div style="margin-top:8px;">${'‚òÖ'.repeat(e.rating)}${'‚òÜ'.repeat(5 - e.rating)}</div>
                `;
                list.appendChild(item);
            });
            document.getElementById('histCount').textContent = '(' + st.history.length + ' entries)';
        }

        function toggleHist() {
            const list = document.getElementById('histList');
            const toggle = document.querySelector('.history-toggle span');
            if (list.classList.contains('show')) {
                list.classList.remove('show');
                toggle.textContent = '‚ñº View Brewing History';
            } else {
                list.classList.add('show');
                toggle.textContent = '‚ñ≤ Hide Brewing History';
            }
        }

        function initJournal() {
            const thisWeek = document.getElementById('thisWeekList');
            const lastWeek = document.getElementById('lastWeekList');
            thisWeek.innerHTML = '';
            lastWeek.innerHTML = '';
            
            // Show journal entries first
            st.journalEntries.slice(0, 2).forEach((entry, idx) => {
                const item = document.createElement('div');
                item.className = 'timeline-item';
                item.innerHTML = `
                    <div class="card">
                        <div class="history-date">${entry.date}</div>
                        <div style="font-size: 14px; color: var(--text); line-height: 1.6; margin-top: 8px;">${entry.text}</div>
                    </div>
                `;
                if (idx === 0) thisWeek.appendChild(item);
                else lastWeek.appendChild(item);
            });
            
            st.history.slice(0, 2).forEach(e => {
                const item = document.createElement('div');
                item.className = 'timeline-item';
                item.innerHTML = `
                    <div class="card">
                        <div class="history-date">${e.date}</div>
                        <div class="history-coffee">${e.coffee}</div>
                        <div class="history-emotions">${e.before} ${e.beforeT} ‚Üí ${e.after} ${e.afterT}</div>
                        ${e.note ? '<div class="history-note" style="margin-top:8px;">"' + e.note + '"</div>' : ''}
                        <div style="margin-top:8px;">${'‚òÖ'.repeat(e.rating)}${'‚òÜ'.repeat(5 - e.rating)}</div>
                    </div>
                `;
                thisWeek.appendChild(item);
            });
            st.history.slice(2, 4).forEach(e => {
                const item = document.createElement('div');
                item.className = 'timeline-item';
                item.innerHTML = `
                    <div class="card">
                        <div class="history-date">${e.date}</div>
                        <div class="history-coffee">${e.coffee}</div>
                        <div class="history-emotions">${e.before} ${e.beforeT} ‚Üí ${e.after} ${e.afterT}</div>
                    </div>
                `;
                lastWeek.appendChild(item);
            });
            const cal = document.getElementById('calGrid');
            cal.innerHTML = '';
            for (let i = 1; i <= 30; i++) {
                const day = document.createElement('div');
                day.className = 'calendar-day';
                day.textContent = i;
                if ([20, 21, 22, 24].includes(i)) {
                    day.classList.add('has-brew');
                    const icon = document.createElement('div');
                    icon.className = 'calendar-icon';
                    icon.textContent = '‚òï';
                    day.appendChild(icon);
                }
                cal.appendChild(day);
            }
            
            // Add character counter
            const textarea = document.getElementById('journalEntry');
            if (textarea) {
                textarea.addEventListener('input', function() {
                    document.getElementById('journalCharCount').textContent = this.value.length + '/300';
                });
            }
        }
        
        function saveJournalEntry() {
            const textarea = document.getElementById('journalEntry');
            const text = textarea.value.trim();
            if (!text) {
                showToast('Please write something first', 'error');
                return;
            }
            
            // Save to localStorage via DB
            userData = DB.addJournalEntry(text);
            st.journalEntries = userData.journalEntries;
            
            textarea.value = '';
            document.getElementById('journalCharCount').textContent = '0/300';
            initJournal();
            showToast('Entry saved to your journal! üìñ');
        }

        function switchTab(tab) {
            document.querySelectorAll('.journal-tab').forEach(t => t.classList.remove('active'));
            event.target.classList.add('active');
            if (tab === 'timeline') {
                document.getElementById('timelineView').style.display = 'block';
                document.getElementById('calendarView').style.display = 'none';
            } else {
                document.getElementById('timelineView').style.display = 'none';
                document.getElementById('calendarView').style.display = 'block';
            }
        }

        initStamps();
        
        // Live Stats Animation for Community Stats
        function updateLiveStats() {
            const liveBrews = document.getElementById('liveBrews');
            const todayBrews = document.getElementById('todayBrews');
            if (liveBrews && todayBrews) {
                // Random fluctuation for "brewing now"
                let current = parseInt(liveBrews.textContent.replace(/,/g, ''));
                let change = Math.floor(Math.random() * 20) - 8;
                let newVal = Math.max(800, Math.min(2000, current + change));
                liveBrews.textContent = newVal.toLocaleString();
                
                // Slowly increase today's brews
                let today = parseInt(todayBrews.textContent.replace(/,/g, ''));
                today += Math.floor(Math.random() * 3);
                todayBrews.textContent = today.toLocaleString();
            }
        }
        setInterval(updateLiveStats, 3000);

        // ========== SETTINGS & PREFERENCES ==========
        const appSettings = {
            darkMode: false,
            sound: true,
            vibration: true,
            dailyReminder: true,
            streakAlerts: true,
            weeklySummary: false,
            reminderTime: '9:00 AM',
            language: 'en'
        };

        // Load settings from localStorage
        function loadSettings() {
            const saved = localStorage.getItem('breathCafeSettings');
            if (saved) {
                Object.assign(appSettings, JSON.parse(saved));
            }
            applySettings();
        }

        // Save settings to localStorage
        function saveSettings() {
            localStorage.setItem('breathCafeSettings', JSON.stringify(appSettings));
        }

        // Apply settings to UI
        function applySettings() {
            // Update toggle switches
            const toggleMap = {
                'toggleDarkMode': 'darkMode',
                'toggleSound': 'sound',
                'toggleVibration': 'vibration',
                'toggleDailyReminder': 'dailyReminder',
                'toggleStreakAlerts': 'streakAlerts',
                'toggleWeeklySummary': 'weeklySummary'
            };
            
            for (const [id, setting] of Object.entries(toggleMap)) {
                const toggle = document.getElementById(id);
                if (toggle) {
                    toggle.classList.toggle('active', appSettings[setting]);
                }
            }
            
            // Update reminder time display
            const timeDisplay = document.getElementById('reminderTimeDisplay');
            if (timeDisplay) {
                timeDisplay.textContent = appSettings.reminderTime;
            }
        }

        // Toggle setting
        function toggleSetting(setting) {
            appSettings[setting] = !appSettings[setting];
            saveSettings();
            applySettings();
            showToast(appSettings[setting] ? 'Enabled' : 'Disabled');
        }

        // ========== EXPERIENCE MODE FUNCTIONS ==========
        let experienceMode = localStorage.getItem('breathCafeMode') || 'gamified';
        
        function setExperienceMode(mode) {
            experienceMode = mode;
            localStorage.setItem('breathCafeMode', mode);
            
            // Update UI
            document.getElementById('pureModeOption').classList.toggle('active', mode === 'pure');
            document.getElementById('gamifiedModeOption').classList.toggle('active', mode === 'gamified');
            
            // Apply mode to body
            if (mode === 'pure') {
                document.body.classList.add('pure-mode');
                showToast('Pure Mode: Just you and your breath');
            } else {
                document.body.classList.remove('pure-mode');
                showToast('Gamified Mode: Observe how this affects you');
            }
            
            // Hide/show gamification elements
            applyExperienceMode();
        }
        
        function applyExperienceMode() {
            const gamifiedElements = document.querySelectorAll('.gamified-only');
            const isPure = experienceMode === 'pure';
            
            gamifiedElements.forEach(el => {
                el.style.display = isPure ? 'none' : '';
            });
            
            // Also hide streak badge in header
            const streakBadge = document.querySelector('.streak-badge');
            if (streakBadge) {
                streakBadge.style.display = isPure ? 'none' : '';
            }
        }
        
        function initExperienceMode() {
            const savedMode = localStorage.getItem('breathCafeMode') || 'gamified';
            experienceMode = savedMode;
            
            if (savedMode === 'pure') {
                document.body.classList.add('pure-mode');
                document.getElementById('pureModeOption')?.classList.add('active');
                document.getElementById('gamifiedModeOption')?.classList.remove('active');
            } else {
                document.getElementById('gamifiedModeOption')?.classList.add('active');
                document.getElementById('pureModeOption')?.classList.remove('active');
            }
            
            applyExperienceMode();
        }

        // ========== RESEARCH REFLECTION FUNCTIONS ==========
        let researchData = JSON.parse(localStorage.getItem('breathCafeResearch')) || {
            timePerception: { longer: 0, same: 0, shorter: 0 },
            paceControl: { interface: 0, me: 0, together: 0 },
            gamificationEffect: { yes: 0, no: 0, pressure: 0 },
            observations: []
        };
        
        function selectResearchAnswer(question, answer) {
            // Save to research data
            if (question === 'time') {
                researchData.timePerception[answer]++;
            } else if (question === 'control') {
                researchData.paceControl[answer]++;
            } else if (question === 'gamification') {
                researchData.gamificationEffect[answer]++;
            }
            
            localStorage.setItem('breathCafeResearch', JSON.stringify(researchData));
        }
        
        function saveObservation() {
            const input = document.querySelector('.final-input');
            const text = input.value.trim();
            
            if (!text) {
                showToast('Please write your reflection', 'error');
                return;
            }
            
            researchData.observations.push({
                text: text,
                date: new Date().toISOString(),
                mode: experienceMode
            });
            
            localStorage.setItem('breathCafeResearch', JSON.stringify(researchData));
            input.value = '';
            showToast('Reflection saved!');
        }
        
        function updateExperimentDuration() {
            // Calculate duration based on breath data
            if (st.breathData) {
                const cycleTime = st.breathData.inhale + st.breathData.hold + st.breathData.exhale;
                const totalTime = cycleTime * st.totalCycles;
                const minutes = Math.floor(totalTime / 60);
                const seconds = totalTime % 60;
                const durationEl = document.getElementById('expDuration');
                if (durationEl) {
                    durationEl.textContent = `${minutes} min ${seconds} sec`;
                }
            }
        }

        // ========== MODAL FUNCTIONS ==========
        function openModal(modalId) {
            document.getElementById(modalId).classList.add('active');
            document.body.style.overflow = 'hidden';
        }

        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('active');
            document.body.style.overflow = '';
        }

        function closeModalOnOverlay(event) {
            if (event.target.classList.contains('modal-overlay')) {
                event.target.classList.remove('active');
                document.body.style.overflow = '';
            }
        }

        function openLanguageModal() {
            openModal('languageModal');
        }

        function openTimePickerModal() {
            openModal('timePickerModal');
        }

        // ========== PROFILE FUNCTIONS ==========
        function saveProfile() {
            const name = document.getElementById('editName').value.trim();
            const email = document.getElementById('editEmail').value.trim();
            
            if (!name) {
                showToast('Please enter a name', 'error');
                return;
            }
            
            // Save to localStorage
            const profile = { name, email };
            localStorage.setItem('breathCafeProfile', JSON.stringify(profile));
            
            // Update UI
            document.getElementById('accountUserName').textContent = name;
            document.getElementById('accountUserEmail').textContent = email;
            
            closeModal('editProfileModal');
            showToast('Profile updated!');
        }

        function loadProfile() {
            const saved = localStorage.getItem('breathCafeProfile');
            if (saved) {
                const profile = JSON.parse(saved);
                document.getElementById('editName').value = profile.name;
                document.getElementById('editEmail').value = profile.email;
                document.getElementById('accountUserName').textContent = profile.name;
                document.getElementById('accountUserEmail').textContent = profile.email;
            }
        }

        function changePassword() {
            const current = document.getElementById('currentPassword').value;
            const newPass = document.getElementById('newPassword').value;
            const confirm = document.getElementById('confirmPassword').value;
            
            if (!current || !newPass || !confirm) {
                showToast('Please fill all fields', 'error');
                return;
            }
            
            if (newPass !== confirm) {
                showToast('Passwords do not match', 'error');
                return;
            }
            
            if (newPass.length < 6) {
                showToast('Password must be at least 6 characters', 'error');
                return;
            }
            
            // Clear fields
            document.getElementById('currentPassword').value = '';
            document.getElementById('newPassword').value = '';
            document.getElementById('confirmPassword').value = '';
            
            closeModal('changePasswordModal');
            showToast('Password updated!');
        }

        function connectAccount(provider) {
            showToast(`${provider.charAt(0).toUpperCase() + provider.slice(1)} connection coming soon!`);
        }

        function confirmLogout() {
            if (confirm('Are you sure you want to log out?')) {
                showToast('Logged out successfully');
                // In a real app, this would clear session and redirect
                setTimeout(() => {
                    goTo('welcome');
                }, 1000);
            }
        }

        // ========== LANGUAGE FUNCTIONS ==========
        function selectLanguage(lang, element) {
            document.querySelectorAll('.language-option').forEach(opt => opt.classList.remove('selected'));
            element.classList.add('selected');
            appSettings.language = lang;
            saveSettings();
            closeModal('languageModal');
            showToast('Language updated!');
        }

        // ========== TIME PICKER FUNCTIONS ==========
        function saveReminderTime() {
            const hour = document.getElementById('reminderHour').value;
            const minute = document.getElementById('reminderMinute').value;
            const period = document.getElementById('reminderPeriod').value;
            
            appSettings.reminderTime = `${hour}:${minute} ${period}`;
            saveSettings();
            applySettings();
            closeModal('timePickerModal');
            showToast('Reminder time saved!');
        }

        // ========== CALENDAR FUNCTIONS ==========
        let currentCalendarDate = new Date();

        function changeMonth(delta) {
            currentCalendarDate.setMonth(currentCalendarDate.getMonth() + delta);
            renderCalendar();
        }

        function renderCalendar() {
            const monthNames = ['January', 'February', 'March', 'April', 'May', 'June', 
                              'July', 'August', 'September', 'October', 'November', 'December'];
            
            const year = currentCalendarDate.getFullYear();
            const month = currentCalendarDate.getMonth();
            
            // Update month display
            document.getElementById('calendarMonth').textContent = `${monthNames[month]} ${year}`;
            
            // Get first day of month and number of days
            const firstDay = new Date(year, month, 1).getDay();
            const daysInMonth = new Date(year, month + 1, 0).getDate();
            
            // Get brew dates from history
            const brewDates = st.history.map(h => {
                const d = new Date(h.timestamp || h.date);
                if (d.getMonth() === month && d.getFullYear() === year) {
                    return d.getDate();
                }
                return null;
            }).filter(d => d !== null);
            
            // Render calendar
            const cal = document.getElementById('calGrid');
            cal.innerHTML = '';
            
            // Empty cells for days before first day of month
            for (let i = 0; i < firstDay; i++) {
                const empty = document.createElement('div');
                empty.className = 'calendar-day';
                empty.style.opacity = '0.3';
                cal.appendChild(empty);
            }
            
            // Days of month
            for (let i = 1; i <= daysInMonth; i++) {
                const day = document.createElement('div');
                day.className = 'calendar-day';
                day.textContent = i;
                
                // Check if this day has a brew
                if (brewDates.includes(i)) {
                    day.classList.add('has-brew');
                    const icon = document.createElement('div');
                    icon.className = 'calendar-icon';
                    icon.textContent = '‚òï';
                    day.appendChild(icon);
                }
                
                // Highlight today
                const today = new Date();
                if (i === today.getDate() && month === today.getMonth() && year === today.getFullYear()) {
                    day.style.border = '2px solid var(--coffee-medium)';
                    day.style.fontWeight = '700';
                }
                
                cal.appendChild(day);
            }
        }

        // ========== ACCORDION FUNCTIONS ==========
        function toggleAccordion(header) {
            const accordion = header.parentElement;
            accordion.classList.toggle('open');
        }

        // ========== TOAST NOTIFICATION ==========
        function showToast(message, type = 'success') {
            const toast = document.getElementById('toast');
            const toastMessage = document.getElementById('toastMessage');
            const toastIcon = toast.querySelector('.toast-icon');
            
            toastMessage.textContent = message;
            toastIcon.textContent = type === 'success' ? '‚úì' : '!';
            toastIcon.style.background = type === 'success' ? '#4CAF50' : '#f44336';
            
            toast.classList.add('show');
            
            setTimeout(() => {
                toast.classList.remove('show');
            }, 2500);
        }

        // ========== UPDATE ACCOUNT PAGE ==========
        function updateAccountPage() {
            userData = DB.load();
            document.getElementById('accountTotalBrews').textContent = userData.stats.totalBrews;
            document.getElementById('accountStreak').textContent = userData.stats.streak;
            document.getElementById('accountStamps').textContent = userData.stamps.length;
            
            const level = userData.user.level;
            let memberStatus = 'Bronze';
            if (level >= 10) memberStatus = 'Diamond';
            else if (level >= 7) memberStatus = 'Gold';
            else if (level >= 4) memberStatus = 'Silver';
            
            document.getElementById('accountUserLevel').textContent = `Level ${level} ¬∑ ${memberStatus} Member`;
        }

        // ========== CALENDAR PAGE FUNCTIONS ==========
        let calendarPageMonth = new Date().getMonth();
        let calendarPageYear = new Date().getFullYear();
        
        // Sample brew data for demo - Updated to December 2025 with research data
        const sampleBrewData = {
            '2025-12-01': [{ 
                type: 'mocha', icon: 'ü´ñ', before: 'üò∞', after: 'üòå', time: '9:30 AM',
                duration: '2m 16s',
                timePerception: 'longer',
                paceControl: 'together',
                note: 'Monday morning anxiety. The slow breathing helped.',
                beforeLabel: 'Anxious', afterLabel: 'Calm'
            }],
            '2025-12-02': [{ 
                type: 'latte', icon: 'ü•õ', before: 'üò¥', after: 'üòä', time: '10:15 AM',
                duration: '1m 52s',
                timePerception: 'shorter',
                paceControl: 'interface',
                note: 'Needed energy, got more than expected.',
                beforeLabel: 'Tired', afterLabel: 'Joy'
            }],
            '2025-12-03': [
                { type: 'americano', icon: '‚òï', before: 'üò§', after: 'üòå', time: '8:00 AM',
                  duration: '2m 00s', timePerception: 'longer', paceControl: 'me',
                  note: 'Frustrated with work. Took control of my pace.', beforeLabel: 'Angry', afterLabel: 'Calm' },
                { type: 'mocha', icon: 'ü´ñ', before: 'üò∞', after: 'üòå', time: '3:30 PM',
                  duration: '2m 16s', timePerception: 'same', paceControl: 'together',
                  note: 'Afternoon slump. Second brew of the day.', beforeLabel: 'Anxious', afterLabel: 'Calm' }
            ],
            '2025-12-04': [{ 
                type: 'coldbrew', icon: 'üßä', before: 'üò§', after: 'üòå', time: '2:00 PM',
                duration: '2m 24s',
                timePerception: 'longer',
                paceControl: 'together',
                note: 'The cold brew pattern really cooled me down.',
                beforeLabel: 'Angry', afterLabel: 'Calm'
            }],
            '2025-12-05': [{ 
                type: 'caramel', icon: 'üçØ', before: 'üòä', after: 'üòä', time: '11:00 AM',
                duration: '1m 48s',
                timePerception: 'shorter',
                paceControl: 'me',
                note: 'Already happy, just wanted to pause and appreciate.',
                beforeLabel: 'Joy', afterLabel: 'Joy'
            }],
            '2025-12-06': [{ 
                type: 'latte', icon: 'ü•õ', before: 'üò¢', after: 'üòå', time: '9:00 AM',
                duration: '2m 08s',
                timePerception: 'longer',
                paceControl: 'interface',
                note: 'Sad morning. Let the interface guide me.',
                beforeLabel: 'Sad', afterLabel: 'Calm'
            }],
            '2025-12-07': [{ 
                type: 'mocha', icon: 'ü´ñ', before: 'üò∞', after: 'üòå', time: '10:30 AM',
                duration: '2m 16s',
                timePerception: 'longer',
                paceControl: 'together',
                note: 'Sunday reset. Preparing for the week.',
                beforeLabel: 'Anxious', afterLabel: 'Calm'
            }],
            '2025-12-08': [
                { type: 'americano', icon: '‚òï', before: 'üò¥', after: 'üòä', time: '7:30 AM',
                  duration: '2m 00s', timePerception: 'same', paceControl: 'me',
                  note: 'Early start. Needed clarity.', beforeLabel: 'Tired', afterLabel: 'Joy' },
                { type: 'latte', icon: 'ü•õ', before: 'üò∞', after: 'üòå', time: '4:00 PM',
                  duration: '2m 08s', timePerception: 'longer', paceControl: 'together',
                  note: 'Pre-presentation nerves. This helped.', beforeLabel: 'Anxious', afterLabel: 'Calm' }
            ],
            '2025-12-09': [{ 
                type: 'mocha', icon: 'ü´ñ', before: 'üò∞', after: 'üòå', time: '9:30 AM',
                duration: '2m 16s',
                timePerception: 'longer',
                paceControl: 'together',
                note: 'Open studio tomorrow. Finding my center.',
                beforeLabel: 'Anxious', afterLabel: 'Calm'
            }],
            '2025-12-10': [{ 
                type: 'americano', icon: '‚òï', before: 'üò∞', after: 'üòå', time: '8:00 AM',
                duration: '2m 00s',
                timePerception: 'longer',
                paceControl: 'me',
                note: 'Open studio day. I chose my own pace today.',
                beforeLabel: 'Anxious', afterLabel: 'Calm'
            }]
        };
        
        function changeCalendarMonth(delta) {
            calendarPageMonth += delta;
            if (calendarPageMonth > 11) {
                calendarPageMonth = 0;
                calendarPageYear++;
            } else if (calendarPageMonth < 0) {
                calendarPageMonth = 11;
                calendarPageYear--;
            }
            renderCalendarPage();
        }
        
        function renderCalendarPage() {
            const monthNames = ['January', 'February', 'March', 'April', 'May', 'June',
                               'July', 'August', 'September', 'October', 'November', 'December'];
            
            // Update month title
            const monthTitle = document.getElementById('calendarPageMonth');
            if (monthTitle) {
                monthTitle.textContent = `${monthNames[calendarPageMonth]} ${calendarPageYear}`;
            }
            
            // Render calendar grid
            const grid = document.getElementById('calendarPageGrid');
            if (!grid) return;
            
            grid.innerHTML = '';
            
            const firstDay = new Date(calendarPageYear, calendarPageMonth, 1).getDay();
            const daysInMonth = new Date(calendarPageYear, calendarPageMonth + 1, 0).getDate();
            const today = new Date();
            
            // Empty cells for days before the 1st
            for (let i = 0; i < firstDay; i++) {
                const emptyCell = document.createElement('div');
                emptyCell.className = 'calendar-day-cell';
                emptyCell.style.opacity = '0.3';
                emptyCell.style.pointerEvents = 'none';
                grid.appendChild(emptyCell);
            }
            
            // Days of the month
            let monthBrews = 0;
            for (let day = 1; day <= daysInMonth; day++) {
                const cell = document.createElement('div');
                cell.className = 'calendar-day-cell';
                
                const dateStr = `${calendarPageYear}-${String(calendarPageMonth + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
                const brews = sampleBrewData[dateStr];
                
                // Check if today
                if (day === today.getDate() && 
                    calendarPageMonth === today.getMonth() && 
                    calendarPageYear === today.getFullYear()) {
                    cell.classList.add('today');
                }
                
                // Check if future
                const cellDate = new Date(calendarPageYear, calendarPageMonth, day);
                if (cellDate > today) {
                    cell.classList.add('future');
                }
                
                // Check if has brews
                if (brews && brews.length > 0) {
                    cell.classList.add('has-brew');
                    monthBrews += brews.length;
                }
                
                // Day number
                const dayNum = document.createElement('div');
                dayNum.className = 'calendar-day-num';
                dayNum.textContent = day;
                cell.appendChild(dayNum);
                
                // Emotion indicator if has brew
                if (brews && brews.length > 0) {
                    const emotion = document.createElement('div');
                    emotion.className = 'calendar-day-emotion';
                    emotion.textContent = brews[brews.length - 1].after; // Show last emotion
                    cell.appendChild(emotion);
                }
                
                // Click handler
                cell.onclick = () => showDayDetail(dateStr, day);
                
                grid.appendChild(cell);
            }
            
            // Update stats
            const monthBrewsEl = document.getElementById('calMonthBrews');
            if (monthBrewsEl) monthBrewsEl.textContent = monthBrews;
        }
        
        function showDayDetail(dateStr, day) {
            const brews = sampleBrewData[dateStr];
            const detailContainer = document.getElementById('calendarDayBrews');
            const detailCard = document.getElementById('calendarDayDetail');
            
            if (!detailContainer || !detailCard) return;
            
            // Update title
            const monthNames = ['January', 'February', 'March', 'April', 'May', 'June',
                               'July', 'August', 'September', 'October', 'November', 'December'];
            const titleEl = detailCard.querySelector('.calendar-detail-title');
            if (titleEl) {
                titleEl.innerHTML = `<span>üìÖ</span> ${monthNames[calendarPageMonth]} ${day}, ${calendarPageYear}`;
            }
            
            if (!brews || brews.length === 0) {
                detailContainer.innerHTML = `
                    <div style="text-align: center; padding: 32px; color: var(--text-light);">
                        <div style="font-size: 48px; margin-bottom: 12px;">üçÉ</div>
                        <div style="font-size: 16px; margin-bottom: 8px;">No brewing sessions</div>
                        <div style="font-size: 13px; color: #999;">This day is waiting for a mindful moment</div>
                        <button class="btn btn-primary" style="margin-top: 20px; padding: 12px 24px;" onclick="goTo('emotion')">
                            Start Brewing ‚òï
                        </button>
                    </div>
                `;
            } else {
                const timePerceptionLabels = {
                    'longer': '‚è±Ô∏è Time felt longer than usual',
                    'shorter': '‚è±Ô∏è Time felt shorter than usual', 
                    'same': '‚è±Ô∏è Time felt about the same'
                };
                const paceControlLabels = {
                    'interface': 'üéÆ The interface led the pace',
                    'me': 'üéÆ I controlled the pace',
                    'together': 'üéÆ We moved together'
                };
                
                detailContainer.innerHTML = brews.map((brew, index) => `
                    <div style="background: white; border-radius: 16px; padding: 20px; margin-bottom: ${index < brews.length - 1 ? '16px' : '0'}; border: 1px solid var(--border);">
                        <!-- Header: Coffee Type & Time -->
                        <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 16px; padding-bottom: 12px; border-bottom: 1px solid var(--border);">
                            <div style="display: flex; align-items: center; gap: 12px;">
                                <div style="font-size: 32px;">${brew.icon}</div>
                                <div>
                                    <div style="font-weight: 700; font-size: 18px; color: var(--coffee-dark);">${brew.type.charAt(0).toUpperCase() + brew.type.slice(1)}</div>
                                    <div style="font-size: 13px; color: var(--text-light);">${brew.time} ¬∑ ${brew.duration || '2m 16s'}</div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Emotion Transition -->
                        <div style="background: linear-gradient(135deg, #f5f0e8, #e8dcc7); border-radius: 12px; padding: 16px; margin-bottom: 16px;">
                            <div style="font-size: 11px; color: var(--text-light); margin-bottom: 8px; font-weight: 600;">EMOTIONAL JOURNEY</div>
                            <div style="display: flex; align-items: center; justify-content: center; gap: 16px;">
                                <div style="text-align: center;">
                                    <div style="font-size: 36px; margin-bottom: 4px;">${brew.before}</div>
                                    <div style="font-size: 12px; color: var(--text-light);">${brew.beforeLabel || 'Before'}</div>
                                </div>
                                <div style="font-size: 24px; color: var(--coffee-light);">‚Üí</div>
                                <div style="text-align: center;">
                                    <div style="font-size: 36px; margin-bottom: 4px;">${brew.after}</div>
                                    <div style="font-size: 12px; color: var(--text-light);">${brew.afterLabel || 'After'}</div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Research Data -->
                        <div style="background: #fafafa; border-radius: 12px; padding: 16px; margin-bottom: 16px;">
                            <div style="font-size: 11px; color: var(--text-light); margin-bottom: 12px; font-weight: 600;">üî¨ RESEARCH OBSERVATIONS</div>
                            <div style="display: flex; flex-direction: column; gap: 8px;">
                                <div style="display: flex; align-items: center; gap: 8px; font-size: 14px; color: var(--coffee-dark);">
                                    ${timePerceptionLabels[brew.timePerception] || '‚è±Ô∏è Time perception not recorded'}
                                </div>
                                <div style="display: flex; align-items: center; gap: 8px; font-size: 14px; color: var(--coffee-dark);">
                                    ${paceControlLabels[brew.paceControl] || 'üéÆ Pace control not recorded'}
                                </div>
                            </div>
                        </div>
                        
                        <!-- Personal Note -->
                        ${brew.note ? `
                        <div style="background: #fffdf8; border-left: 3px solid var(--coffee-medium); padding: 12px 16px; border-radius: 0 8px 8px 0;">
                            <div style="font-size: 11px; color: var(--text-light); margin-bottom: 6px; font-weight: 600;">‚úçÔ∏è YOUR NOTE</div>
                            <div style="font-family: 'Caveat', cursive; font-size: 17px; color: var(--coffee-dark); line-height: 1.5;">"${brew.note}"</div>
                        </div>
                        ` : ''}
                    </div>
                `).join('');
            }
            
            // Scroll to detail card
            detailCard.scrollIntoView({ behavior: 'smooth', block: 'center' });
        }
        
        function initCalendarPage() {
            renderCalendarPage();
        }
        
        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
            initStamps();
            initJournal();
            loadProfile();
            loadSettings();
            renderCalendar();
            initExperienceMode();
            initCalendarPage();
        });
    </script>
</body>
</html>
